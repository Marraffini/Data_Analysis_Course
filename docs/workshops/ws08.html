<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>161250 Data Analysis - Chapter 8 Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../workshops/ws07.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">161250 Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../studyguide/index.html" rel="" target="">
 <span class="menu-text">Study Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../workshops/ws01.html" rel="" target="" aria-current="page">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Extra Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-code">    
        <li>
    <a class="dropdown-item" href="../exercises/Chap2more.R" rel="" target="">
 <span class="dropdown-text">Ex2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap3more.R" rel="" target="">
 <span class="dropdown-text">Ex3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap4more.R" rel="" target="">
 <span class="dropdown-text">Ex4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap5more.R" rel="" target="">
 <span class="dropdown-text">Ex5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap6more.R" rel="" target="">
 <span class="dropdown-text">Ex6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap7more.R" rel="" target="">
 <span class="dropdown-text">Ex7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap8more.R" rel="" target="">
 <span class="dropdown-text">Ex8</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workshops/ws08.html">Chapter 8 Workshop</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started With R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws08.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 8 Workshop</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#insect-sprays-analysis-of-variance" id="toc-insect-sprays-analysis-of-variance" class="nav-link active" data-scroll-target="#insect-sprays-analysis-of-variance">Insect Sprays – Analysis of Variance</a>
  <ul class="collapse">
  <li><a href="#load-and-look-at-the-data" id="toc-load-and-look-at-the-data" class="nav-link" data-scroll-target="#load-and-look-at-the-data">Load and look at the data</a></li>
  <li><a href="#plotting-the-data" id="toc-plotting-the-data" class="nav-link" data-scroll-target="#plotting-the-data">Plotting the data</a></li>
  <li><a href="#fitting-an-anova-model" id="toc-fitting-an-anova-model" class="nav-link" data-scroll-target="#fitting-an-anova-model">Fitting an ANOVA model</a></li>
  <li><a href="#examining-the-assumptions-of-anova" id="toc-examining-the-assumptions-of-anova" class="nav-link" data-scroll-target="#examining-the-assumptions-of-anova">Examining the assumptions of ANOVA</a></li>
  <li><a href="#anova-for-transformed-counts" id="toc-anova-for-transformed-counts" class="nav-link" data-scroll-target="#anova-for-transformed-counts">ANOVA for transformed counts</a></li>
  <li><a href="#fitting-an-anova-to-the-transformed-data" id="toc-fitting-an-anova-to-the-transformed-data" class="nav-link" data-scroll-target="#fitting-an-anova-to-the-transformed-data">Fitting an ANOVA to the transformed data</a></li>
  <li><a href="#post-hoc-multiple-comparisons" id="toc-post-hoc-multiple-comparisons" class="nav-link" data-scroll-target="#post-hoc-multiple-comparisons">Post-hoc multiple comparisons</a></li>
  </ul></li>
  <li><a href="#oyster-growth-two-way-anova" id="toc-oyster-growth-two-way-anova" class="nav-link" data-scroll-target="#oyster-growth-two-way-anova">Oyster growth – two-way ANOVA</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#ordering-factors" id="toc-ordering-factors" class="nav-link" data-scroll-target="#ordering-factors">Ordering factors</a></li>
  <li><a href="#one-way-anovas" id="toc-one-way-anovas" class="nav-link" data-scroll-target="#one-way-anovas">One-way ANOVAs</a></li>
  <li><a href="#interaction-plots" id="toc-interaction-plots" class="nav-link" data-scroll-target="#interaction-plots">Interaction plots</a></li>
  <li><a href="#two-way-anova" id="toc-two-way-anova" class="nav-link" data-scroll-target="#two-way-anova">Two-way ANOVA</a></li>
  <li><a href="#interaction" id="toc-interaction" class="nav-link" data-scroll-target="#interaction">Interaction</a></li>
  <li><a href="#post-hoc-group-comparisons" id="toc-post-hoc-group-comparisons" class="nav-link" data-scroll-target="#post-hoc-group-comparisons">Post-hoc group comparisons</a></li>
  </ul></li>
  <li><a href="#goats-analysis-of-covariance" id="toc-goats-analysis-of-covariance" class="nav-link" data-scroll-target="#goats-analysis-of-covariance">Goats – Analysis of <strong>Co</strong>variance</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#fitting-treatment-only" id="toc-fitting-treatment-only" class="nav-link" data-scroll-target="#fitting-treatment-only">Fitting treatment only</a></li>
  <li><a href="#fitting-initial-weight-only" id="toc-fitting-initial-weight-only" class="nav-link" data-scroll-target="#fitting-initial-weight-only">Fitting Initial Weight only</a></li>
  <li><a href="#fitting-both-anova" id="toc-fitting-both-anova" class="nav-link" data-scroll-target="#fitting-both-anova">Fitting both… ANOVA!</a></li>
  <li><a href="#plotting-the-model" id="toc-plotting-the-model" class="nav-link" data-scroll-target="#plotting-the-model">Plotting the model</a></li>
  </ul></li>
  <li><a href="#dataset-alfalfa" id="toc-dataset-alfalfa" class="nav-link" data-scroll-target="#dataset-alfalfa">Dataset <strong><code>alfalfa</code></strong></a>
  <ul class="collapse">
  <li><a href="#exercise-8.1" id="toc-exercise-8.1" class="nav-link" data-scroll-target="#exercise-8.1">Exercise 8.1</a></li>
  <li><a href="#exercise-8.2" id="toc-exercise-8.2" class="nav-link" data-scroll-target="#exercise-8.2">Exercise 8.2</a></li>
  <li><a href="#exercise-8.3" id="toc-exercise-8.3" class="nav-link" data-scroll-target="#exercise-8.3">Exercise 8.3</a></li>
  <li><a href="#exercise-8.4" id="toc-exercise-8.4" class="nav-link" data-scroll-target="#exercise-8.4">Exercise 8.4</a></li>
  <li><a href="#exercise-8.5" id="toc-exercise-8.5" class="nav-link" data-scroll-target="#exercise-8.5">Exercise 8.5</a></li>
  <li><a href="#non-parametric-anova" id="toc-non-parametric-anova" class="nav-link" data-scroll-target="#non-parametric-anova">Non-parametric ANOVA</a></li>
  <li><a href="#return-to-the-insect-data" id="toc-return-to-the-insect-data" class="nav-link" data-scroll-target="#return-to-the-insect-data">Return to the Insect Data</a></li>
  <li><a href="#return-to-the-oyster-data" id="toc-return-to-the-oyster-data" class="nav-link" data-scroll-target="#return-to-the-oyster-data">Return to the Oyster Data</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ws08.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 8 Workshop</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="insect-sprays-analysis-of-variance" class="level1">
<h1>Insect Sprays – Analysis of Variance</h1>
<p>For this ANOVA tutorial, we will use the <code>InsectSprays</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> dataset provided in R, which gives the results of an experiment that examined the effects of six types of insecticide spray on the numbers of insects.</p>
<section id="load-and-look-at-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-look-at-the-data">Load and look at the data</h2>
<p>Load and examine the dataset.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(InsectSprays)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(InsectSprays)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   72 obs. of  2 variables:
 $ count: num  10 7 20 14 14 12 10 23 17 20 ...
 $ spray: Factor w/ 6 levels "A","B","C","D",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(InsectSprays)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  count spray
1    10     A
2     7     A
3    20     A
4    14     A
5    14     A
6    12     A</code></pre>
</div>
</div>
<p>You can read a bit about it here: <code>help(InsectSprays)</code>.</p>
<p>There are two variables. <code>count</code> is the response variable and represents the number of insects found in a plot, and <code>spray</code> is the predictor variable which indicates the type of insecticide used. Modelling a quantitative response variable with a categorical factor should make you immediately think of ANOVA!</p>
<p>Let’s give the dataset a shorter name, so we don’t have to write out InsectSprays whenever we want to use it.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">=</span> InsectSprays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the number of replicates (data points) for each group.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>spray)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 A  B  C  D  E  F 
12 12 12 12 12 12 </code></pre>
</div>
</div>
<p>This shows that there are 12 replicates in each group. Because n is the same for each level, we can say that this is a balanced design.</p>
</section>
<section id="plotting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-data">Plotting the data</h2>
<p>Let’s plot the data using a boxplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What are your first impressions? Does it look like there is much difference among the groups?</p>
<p>Boxplots are useful, but for small datasets it can be revealing to plot the actual data.</p>
<p>We can use a dotplot with violins.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dvp <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> <span class="co"># display the violins</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="co"># add the points, with a little jitter so they do not overlap </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>dvp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Do you think the dot/violinplot is more or less informative than the boxplot?</p>
<p>Analysis of variance compares the variation among groups (group means from the overall mean) with the variation within groups (data points from their group means). Recall that, while useful, boxplots do not actually show us the means. So, to help with our visual impression of these data in the context of ANOVA, we’ll now add the means to the dotplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>meanIS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">mean</span>(count))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dvp <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="co"># adds a line for the mean value</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> meanIS,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"darkorange"</span> ,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"|"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Though I do like boxplots, I think this is probably a more useful and revealing plot in this case, especially since we’re about to do an ANOVA, which tests for differences among means.</p>
</section>
<section id="fitting-an-anova-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-an-anova-model">Fitting an ANOVA model</h2>
<p>An ANOVA model is fit in R using the function <code>aov()</code>. There is a function <code>anova()</code>, but this instead can be used to produce an ANOVA table from an existing model (we saw use of this in Chapter 7).</p>
<p>Let’s do it.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data =</span> IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
   aov(formula = count ~ spray, data = IS)

Terms:
                   spray Residuals
Sum of Squares  2668.833  1015.167
Deg. of Freedom        5        66

Residual standard error: 3.921902
Estimated effects may be unbalanced</code></pre>
</div>
</div>
<p>This shows the among-groups (<code>spray</code>) and within-groups (<code>Residuals</code>) sum of squares, and degrees of freedom. The <code>Residual standard error</code> is the square root of the error variance (<span class="math inline">\(\sigma_\varepsilon^2\)</span>). It is the expected (average) absolute deviation from the individual data points to their respective group means. If required, you can remind yourself what these values represent from the lecture slides.</p>
<p>We can get the full ANOVA table by commanding a <code>summary()</code> of an <code>aov</code> object. (Note, a very similar output can be achieved by applying the <code>anova()</code> function to an <code>aov</code> object.)</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
spray        5   2669   533.8    34.7 &lt;2e-16 ***
Residuals   66   1015    15.4                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The full ANOVA table also gives us the Mean Squares (the SS divided by their respective df), the F value (the ratio of the within-to-among-groups Mean Squares), and the P-value.</p>
<p>The null hypothesis tested here is that there is no difference between the group means in the population.</p>
<p><span class="math display">\[H_0 : \mu_1 = \mu_2 = ... = \mu_g\]</span></p>
<p>The alternative hypothesis is that at least one of the groups is different to the others.</p>
<p>Remember that we assume that we have taken a sample of data at random from a population. The P-value is the proportion of equivalent samples in which we would obtain the observed test statistic or greater <strong>if the null hypothesis is true</strong> (i.e.&nbsp;no difference among groups). In other words, how likely is it that the observed differences among means have occurred just through chance? Here, the F ratio is high and P-value is tiny (&lt; 0.0000000000000002). So, there is extremely strong evidence against the null hypothesis and we can conclude that there is indeed a difference among the group means—plants subjected to different types of spray have, on average, different numbers of insects on them.</p>
<p>This, in itself, is not immensely informative. Naturally, we wish to examine which groups (spray types) are different from one another.</p>
<p>But, first, we need to examine our assumptions.</p>
</section>
<section id="examining-the-assumptions-of-anova" class="level2">
<h2 class="anchored" data-anchor-id="examining-the-assumptions-of-anova">Examining the assumptions of ANOVA</h2>
<p>Like for regression, diagnostic plots are the first step for examining how well the assumptions of ANOVA are met by our model. If these assumptions are not met, then the F-ratio might not behave as it should (i.e.&nbsp;follow an F-distribution) with repeated sampling under a true null hypothesis.</p>
<p>Those assumptions are:</p>
<ol type="1">
<li>Appropriateness of an additive linear model</li>
<li>Independent errors</li>
<li>Normally distributed errors</li>
<li>Homogeneity of errors</li>
</ol>
<p>We will focus on 3 and 4 because 1 and 2 cannot really be checked at this stage of the analysis.</p>
<p>Let’s make the plots.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is cause for concern here. As is often the case with counts, there seems to be some heteroscedasticity in the residuals. That is, the residual variance does not appear constant, but rather increases with the fitted value. In an ANOVA context, this means that the groups with high means have greater within-group variation. Let’s have a look at the standard deviations of the groups.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  spray    sd
  &lt;fct&gt; &lt;dbl&gt;
1 A      4.72
2 B      4.27
3 C      1.98
4 D      2.50
5 E      1.73
6 F      6.21</code></pre>
</div>
</div>
<p>Indeed, there is a huge difference between the largest and smallest standard deviation (roughly 3.5-fold).</p>
<p>We can use a Levene’s test to explicitly test for evidence of heterogeneous variances. The function <code>leveneTest()</code> in the <code>car</code> package does this. Remember, the null hypothesis is that the average absolute deviations are the same in all groups.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value   Pr(&gt;F)   
group  5  3.8214 0.004223 **
      66                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The low P-value here indicates that the null hypothesis is rejected and our suspicions were correct—there are significant differences in the variations among groups.</p>
<p>The assumption of normality also seems suspect here, according to the fact that many data do not fall along the dotted line in the Q-Q plot. This is probably part of the same problem.</p>
<p>We can try transforming the response variable <code>count</code> and see if that helps.</p>
</section>
<section id="anova-for-transformed-counts" class="level2">
<h2 class="anchored" data-anchor-id="anova-for-transformed-counts">ANOVA for transformed counts</h2>
<p>We will try a log(x+1) transformation. We add the constant 1 because there are some (two) zeros in the dataset.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1  2  3  4  5  6  7  9 10 11 12 13 14 15 16 17 19 20 21 22 23 24 26 
 2  6  4  8  4  7  3  3  1  3  3  2  4  4  2  2  4  1  2  2  1  1  1  2 </code></pre>
</div>
</div>
<p>Let’s test the assumption for the transformed data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> lcount <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  5  1.8821 0.1093
      66               </code></pre>
</div>
</div>
<p>The test is now non-significant, but 0.1 is still a fairly small P-value. Looking at the following boxplot, it seems like the log transformation might be too severe—the groups with smaller means now seem to have higher variance than those with larger means.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lcount, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now try instead a square-root transformation.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> sqrt_count <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  5  0.8836 0.4971
      66               </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> sqrt_count, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This looks like a better transformation for this model.</p>
</section>
<section id="fitting-an-anova-to-the-transformed-data" class="level2">
<h2 class="anchored" data-anchor-id="fitting-an-anova-to-the-transformed-data">Fitting an ANOVA to the transformed data</h2>
<p>Fit the model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) )</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
spray        5  88.44  17.688    44.8 &lt;2e-16 ***
Residuals   66  26.06   0.395                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Now show up the diagnostic plots for this model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Much better!</p>
<p>This clearly has not made a substantial impact on the result of the hypothesis test for a difference among group means, but we can be happier that the inference is correct.</p>
<p>Now let’s look at the differences among groups.</p>
</section>
<section id="post-hoc-multiple-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="post-hoc-multiple-comparisons">Post-hoc multiple comparisons</h2>
<p>Tukey’s Honest Significant Differences (HSD) are a method of adjusting for the fact that, in a post-hoc analysis such as this, there are simultaneously hypothesis tests being done. Across all these tests, the probability of erroneously finding a significant difference (i.e.&nbsp;making a Type I error) is greater than the nominated alpha value (usually 0.05). The HSD method makes each individual test slightly more conservative so that the family-wise error rate across all tests is conserved.</p>
<p>Tukey’s HSD can be implemented in R as follows.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = sqrt_count ~ spray, data = IS)

$spray
          diff        lwr        upr     p adj
B-A  0.1159530 -0.6369601  0.8688661 0.9975245
C-A -2.5158217 -3.2687349 -1.7629086 0.0000000
D-A -1.5963245 -2.3492377 -0.8434114 0.0000006
E-A -1.9512174 -2.7041305 -1.1983042 0.0000000
F-A  0.2579388 -0.4949744  1.0108519 0.9144964
C-B -2.6317747 -3.3846879 -1.8788616 0.0000000
D-B -1.7122775 -2.4651907 -0.9593644 0.0000001
E-B -2.0671704 -2.8200835 -1.3142572 0.0000000
F-B  0.1419858 -0.6109274  0.8948989 0.9935788
D-C  0.9194972  0.1665841  1.6724103 0.0080813
E-C  0.5646043 -0.1883088  1.3175175 0.2512638
F-C  2.7737605  2.0208474  3.5266736 0.0000000
E-D -0.3548928 -1.1078060  0.3980203 0.7366389
F-D  1.8542633  1.1013502  2.6071764 0.0000000
F-E  2.2091561  1.4562430  2.9620693 0.0000000</code></pre>
</div>
</div>
<p>This table above has each possible pairwise comparison of groups. The number of comparisons is <span class="math inline">\(g(g – 1)/2 = 15\)</span> (where <span class="math inline">\(g\)</span> = the number of groups = 6).</p>
<p>For each pairwise comparison, the table gives the estimated difference (<code>diff</code>), the lower (<code>lwr</code>) and upper (<code>upr</code>) confidence intervals and the p-value (<code>p adj</code>) which tests whether the difference is statistically significant. The confidence intervals and the p-value are adjusted for the fact that multiple simultaneous comparisons are being made, and so are more conservative than if they were done separately. Out of the 15 comparisons, 10 have very low p-values.</p>
<p>Here are the intervals shown on a plot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TukeyHSD</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot provides a visual impression of the size and adjusted confidence intervals for each comparison. An interval that includes zero indicates that the difference between those groups is non-significant (i.e.&nbsp;the null hypothesis of no difference is retained). This was the case for <code>B-A</code>, <code>F-A</code>, <code>F-B</code>, <code>E-C</code>, and <code>E-D</code>. From the earlier plots, this makes sense. <code>A-B-F</code> seem to be quite similar, as do <code>E-C-D</code>.</p>
</section>
</section>
<section id="oyster-growth-two-way-anova" class="level1">
<h1>Oyster growth – two-way ANOVA</h1>
<p>We will analyse a dataset (which I invented) from an experiment that manipulated salinity and temperature and measured the growth of oysters in these different regimes.</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>oys <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/oystergrowth.csv"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(oys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [60 × 4] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ ...1       : num [1:60] 1 2 3 4 5 6 7 8 9 10 ...
 $ Growth     : num [1:60] 5.93 5.48 5.65 6.28 6.31 ...
 $ Salinity   : chr [1:60] "Low" "Low" "Low" "Low" ...
 $ Temperature: chr [1:60] "Low" "Low" "Low" "Low" ...
 - attr(*, "spec")=
  .. cols(
  ..   ...1 = col_double(),
  ..   Growth = col_double(),
  ..   Salinity = col_character(),
  ..   Temperature = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>The response variable is <code>Growth.</code></p>
<p>There are two factors:</p>
<p>Factor A: <code>Temperature</code>, a = 3 levels (<code>High</code>, <code>Medium</code>, and <code>Low</code>) Factor B: <code>Salinity</code>, b = 2 levels (<code>High</code> and <code>Low</code>),</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(oys<span class="sc">$</span>Salinity, oys<span class="sc">$</span>Temperature)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      
       High Low Med
  High   10  10  10
  Low    10  10  10</code></pre>
</div>
</div>
<p>The table above shows a count of 10 data points per combination of <code>Temperature</code> and <code>Salinity.</code> The equal number of observations among cells shows the experiment has a crossed and balanced design.</p>
</section>
<section id="ordering-factors" class="level2">
<h2 class="anchored" data-anchor-id="ordering-factors">Ordering factors</h2>
<p>The <code>Temperature</code> variable is ordinal, having a natural order. R does not know this automatically.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(oys<span class="sc">$</span>Temperature) <span class="sc">|&gt;</span> <span class="fu">levels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "High" "Low"  "Med" </code></pre>
</div>
</div>
<p>We can tell R the correct order of the factors by turning them into ordered factors.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>oys <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> <span class="fu">factor</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      Temperature, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"Med"</span>,<span class="st">"High"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Salinity =</span> <span class="fu">factor</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      Salinity, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"High"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will first examine separately the effects of <code>Temperature</code> and <code>Salinity</code> on <code>Growth</code>, first focusing on <code>Temperature.</code></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(oys) <span class="sc">+</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Growth, <span class="at">y =</span> Temperature) <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(oys) <span class="sc">+</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Growth, <span class="at">y =</span> Temperature) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="dv">0</span>, <span class="at">height=</span>.<span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="one-way-anovas" class="level2">
<h2 class="anchored" data-anchor-id="one-way-anovas">One-way ANOVAs</h2>
<p>What are your first impressions of these data? Do you think that <code>Temperature</code> has an effect on the <code>Growth</code> of oysters here? Do you think an ANOVA is an appropriate analysis to use? Would you expect the assumptions of ANOVA to be upheld?</p>
<p>Two things stand out. Firstly, it does not look like <code>Temperature</code> has a strong effect <code>Growth</code>—the variation within the groups looks to be much larger than the variation among groups. Run a one-way ANOVA to test this.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Secondly, the data seem to have different variances among the three groups. Use a Levene’s test to confirm this.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now make the same plots for <code>Salinity</code> and <code>Growth</code>.</p>
<p>The same general result was obtained for <code>Salinity</code> as it was for <code>Temperature</code>—there was not apparent effect of <code>Salinity</code> on <code>Growth</code>, and the dispersions among groups are significantly different (although only marginally so).</p>
</section>
<section id="interaction-plots" class="level2">
<h2 class="anchored" data-anchor-id="interaction-plots">Interaction plots</h2>
<p>Now we will examine <code>Growth</code> simultaneously in terms of both <code>Temperature</code> and <code>Salinity</code>.</p>
<p>Let’s make a plot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Temperature, <span class="at">y =</span> Growth, <span class="at">colour =</span> Salinity) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">4</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>g_oys_st</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s add the means to the plot above. First, let’s calculate the means of each combination of <code>Temperature</code> and <code>Salinity</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mean_growth <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Temperature, Salinity) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Growth =</span> <span class="fu">mean</span>(Growth))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>mean_growth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   Temperature [3]
  Temperature Salinity Growth
  &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt;
1 Low         Low        5.86
2 Low         High       8.12
3 Med         Low        7.10
4 Med         High       7.36
5 High        Low        8.87
6 High        High       6.04</code></pre>
</div>
</div>
<p>Now add the means as lines.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="sc">+</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mean_growth,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">group =</span> Salinity),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note, we can make this plot without pre-calculating the means, by way of the <code>stat_summary()</code> function.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="sc">+</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> Salinity), </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> mean, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom=</span><span class="st">"line"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So, our one-group analysis was unable to tell the real story in this dataset.</p>
<p>Before doing a formal two-way ANOVA, try to understand this graph.</p>
<p>Do you expect to find a significant interaction?</p>
<p>Why do you think there was no discernable pattern in the one-factor analyses?</p>
<p>Will differing dispersions among groups still be a problem?</p>
</section>
<section id="two-way-anova" class="level2">
<h2 class="anchored" data-anchor-id="two-way-anova">Two-way ANOVA</h2>
<p>OK, let’s take a look at an ANOVA model with both factors included, plus the interaction. For this, you can write the full formula: <code>Temperature + Salinity + Temperature:Salinity</code>. In R, <code>Temperature:Salinity</code> is syntax for the interaction between <code>Temperature</code> and <code>Salinity.</code> Alternatively, this formula can be specified using this syntax: <code>Temperature*Salinity</code>. This is equivalent to writing the full formula explicitly. Both factors, and their interaction, are included.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth <span class="sc">~</span> Temperature <span class="sc">*</span> Salinity, <span class="at">data =</span> oys) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     Df Sum Sq Mean Sq F value Pr(&gt;F)    
Temperature           2   2.18    1.09   4.388 0.0171 *  
Salinity              1   0.16    0.16   0.660 0.4200    
Temperature:Salinity  2  65.54   32.77 132.148 &lt;2e-16 ***
Residuals            54  13.39    0.25                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="interaction" class="level2">
<h2 class="anchored" data-anchor-id="interaction">Interaction</h2>
<p>First, we look at the interaction <code>Temperature:Salinity</code>. It is highly significant and the most important source of explained variation in the model. This was abundantly clear when we plotted <code>Growth</code> according to <em>both</em> factors simultaneously. The mean lines on the plot were not parallel, which is indicative of an interaction.</p>
<p><code>Temperature</code> and <code>Salinity</code> have an effect on <code>Growth</code> but they are no independent. The effect of <code>Temperature</code> on <code>Growth</code> depends on <code>Salinity</code>, and the effect of <code>Salinity</code> on <code>Growth</code> depends on <code>Temperature</code>.</p>
<p>Without taking <code>Salinity</code> into account, <code>Temperature</code> has no apparent effect. For low <code>Salinity</code> environments, growth increases with increasing <code>Temperature</code>. For high <code>Salinity</code>, the opposite is true: <code>Growth</code> decreases with increasing <code>Temperature</code>.</p>
<p>There is an important lesson to be learned here. A variable that is important for explaining variation in the response, but not included in the model, can obfuscate the relationship between the response and the variables that you have included, particularly when interactions are present.</p>
<p>So-called ‘latent’ variables cause problems in science. This highlights the importance of knowing all the important causes of variation in a measured response. Two strategies may then be employed. You can hold a variable constant (e.g., examine temperature in medium salinity environments) but this restricts the inference space of your conclusions (they would only be valid for medium salinity). Alternatively, you can include a variable in the design (or measure it if it is not easily manipulated), ensuring that it is accounted for in any analyses.</p>
<p>Another potential consequence of an unknown latent variable is excess dispersion in some groups. This resulted in a significant departure from group homogeneity in the Levene’s test for both <code>Salinity</code> and <code>Temperature</code> when the other was left out.</p>
<p>Another thing to note is that, when the interaction is significant, we don’t need to worry about the main effects of the two factors.</p>
</section>
<section id="post-hoc-group-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="post-hoc-group-comparisons">Post-hoc group comparisons</h2>
<p>The next step in the analysis is to test which levels of the factors differ from each other, using a multiple comparisons procedure, such as Tukey’s Honest Significant Differences. Because the interaction is significant, it is the comparison within the interaction term that will be of most interest. There are six cells (3×2), so the number of comparisons within the interaction term will be six-choose-two:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">choose</span>(<span class="dv">6</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
<p>Run a Tukey analysis.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity<span class="sc">*</span>Temperature, <span class="at">data=</span>oys) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Growth ~ Salinity * Temperature, data = oys)

$Salinity
               diff        lwr       upr     p adj
High-Low -0.1044926 -0.3622801 0.1532949 0.4199781

$Temperature
              diff         lwr       upr     p adj
Med-Low  0.2424207 -0.13709813 0.6219396 0.2808614
High-Low 0.4664160  0.08689709 0.8459349 0.0124178
High-Med 0.2239952 -0.15552366 0.6035141 0.3366941

$`Salinity:Temperature`
                         diff         lwr         upr     p adj
High:Low-Low:Low    2.2550543  1.59707046  2.91303820 0.0000000
Low:Med-Low:Low     1.2409233  0.58293938  1.89890712 0.0000118
High:Med-Low:Low    1.4989726  0.84098870  2.15695644 0.0000002
Low:High-Low:Low    3.0072339  2.34925004  3.66521778 0.0000000
High:High-Low:Low   0.1806524 -0.47733150  0.83863624 0.9642520
Low:Med-High:Low   -1.0141311 -1.67211494 -0.35614720 0.0004194
High:Med-High:Low  -0.7560818 -1.41406562 -0.09809788 0.0155079
Low:High-High:Low   0.7521796  0.09419571  1.41016345 0.0162888
High:High-High:Low -2.0744020 -2.73238583 -1.41641809 0.0000000
High:Med-Low:Med    0.2580493 -0.39993455  0.91603319 0.8541174
Low:High-Low:Med    1.7663107  1.10832678  2.42429452 0.0000000
High:High-Low:Med  -1.0602709 -1.71825476 -0.40228702 0.0002074
Low:High-High:Med   1.5082613  0.85027746  2.16624520 0.0000001
High:High-High:Med -1.3183202 -1.97630408 -0.66033634 0.0000033
High:High-Low:High -2.8265815 -3.48456541 -2.16859767 0.0000000</code></pre>
</div>
</div>
<p>First, in the single-factor comparisons (ignoring the other factor), only one comparison is significant—between high and low temperatures. The difference is only 0.46, however, and we know that this comparison does not represent the real effects of temperature on growth. It is marginalised over salinity, whereas we now know that the most important effects of temperature are, in fact, conditional on salinity.</p>
<p>For the interaction comparisons, 13 out of 15 are significantly different. You should refer to the interaction plot on the previous page (or on your screen) to make some sense of which of the comparisons are large or small. For example, the first line gives the comparison between the low-salinity-low-temperature group and the high-salinity-low-temperature group (i.e.&nbsp;the two groups to the left of the interaction plot above). It is one of the largest absolute differences and is highly significant. The greatest difference is on the ninth line of the interaction comparisons: low-salinity-high-temperature vs low-salinity-low-temperature (i.e., those at opposite ends of the low-salinity line on the interaction plot).</p>
<p>We can also plot the comparisons and corresponding Tukey intervals. The <code>which</code> argument allows you to restrict the output to particular terms (here, the interaction).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tuk <span class="ot">&lt;-</span> <span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity<span class="sc">*</span>Temperature, <span class="at">data=</span>oys) <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">TukeyHSD</span>(<span class="at">which =</span> <span class="st">"Salinity:Temperature"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">1</span>)) <span class="co"># adjust the margins so you can read the labels</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tuk, <span class="at">las =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
<section id="goats-analysis-of-covariance" class="level1">
<h1>Goats – Analysis of <strong>Co</strong>variance</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/goat.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A goat</figcaption>
</figure>
</div>
<p>Here, we will use a dataset<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> containing the weights of 40 goats before and after an experiment where 20 were given a standard drenching treatment and 20 were given a more intensive drenching treatment. There are three columns corresponding to the treatment (<code>Tmt</code>), the gain in weight over the experiment (<code>WtGain</code>, kg), and the initial weight at the start of the experiment (<code>InitialWt</code>, kg).</p>
<p><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Source: Saville DJ, Wood GR (1991) <em>Statistical Methods: The Geometric Approach</em>. Springer, New York.</p>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>goat <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/goats.txt"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(goat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [40 × 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Tmt      : chr [1:40] "standard" "standard" "standard" "standard" ...
 $ WtGain   : num [1:40] 5 3 8 7 6 4 8 6 7 5 ...
 $ InitialWt: num [1:40] 21 24 21 22 23 26 22 23 24 20 ...
 - attr(*, "spec")=
  .. cols(
  ..   Tmt = col_character(),
  ..   WtGain = col_double(),
  ..   InitialWt = col_double()
  .. )</code></pre>
</div>
</div>
<p>The initial weight is included because of commonly observed biological phenomenon known as “regression to the norm”, where lighter animals even the ledger by gaining more weight than the heavier animals. By using an ANCOVA model that incorporates the initial weight as a covariate can therefore give us more power to detect an effect of the treatment.</p>
</section>
<section id="fitting-treatment-only" class="level2">
<h2 class="anchored" data-anchor-id="fitting-treatment-only">Fitting treatment only</h2>
<p>Let’s start with a boxplot of the response variable by reference to the predictor of interest, treatment.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> WtGain, <span class="at">y =</span> Tmt) <span class="sc">+</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There seems to be a reasonable effect of treatment. Fit a one-way ANOVA showing this.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sure enough, effect of the treatment is significant, though it is marginally so. The effect size can be viewed in a linear model summary.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From here, we can see that the estimated difference between the treatments is 1.3 kg—the mean for intensive is 6.85 kg and the mean for standard is 5.55 kg.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Tmt) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(WtGain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Tmt        mean
  &lt;chr&gt;     &lt;dbl&gt;
1 intensive  6.85
2 standard   5.55</code></pre>
</div>
</div>
<p>The fitted model explains only 10% of the variation in the data. The average difference between the fitted means and the observations is 2.023, which is greater than the estimated difference in means. So, all in all, there is a significant effect but it is not large. We can estimate a 95% confidence interval for this difference using <span class="math inline">\(\hat d + t_{df,[0.025,0.975]} \times \text{SE}(\hat d)\)</span>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.3</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="dv">38</span>) <span class="sc">*</span> <span class="fl">0.6397</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.595004947 -0.004995053</code></pre>
</div>
</div>
<p>So, the confidence interval for the difference is {0.005 , 2.595}.</p>
</section>
<section id="fitting-initial-weight-only" class="level2">
<h2 class="anchored" data-anchor-id="fitting-initial-weight-only">Fitting Initial Weight only</h2>
<p>Now we will look at the effect of the covariate, <code>InitialWt</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that there is a relationship between the initial weight of the goats and the gain in weight, in that the goats that were lighter at the start of the experiment gained more weight.</p>
<p>Look at a linear model using this predictor alone.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WtGain ~ InitialWt, data = goat)

Residuals:
   Min     1Q Median     3Q    Max 
-3.607 -1.206  0.163  1.054  3.871 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.39581    1.85047   7.780 2.22e-09 ***
InitialWt   -0.35403    0.07906  -4.478 6.68e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.723 on 38 degrees of freedom
Multiple R-squared:  0.3454,    Adjusted R-squared:  0.3282 
F-statistic: 20.05 on 1 and 38 DF,  p-value: 6.681e-05</code></pre>
</div>
</div>
<p>For every extra kilogram of weight at the start, the goat is expected to gain 354 g less over the course of the experiment. The effect is highly significant, and explains 35% of the variation in weight gain. We are not interested in this effect though, per se, because it has been demonstrated many times before. We are most interested in the effect of the treatment.</p>
</section>
<section id="fitting-both-anova" class="level2">
<h2 class="anchored" data-anchor-id="fitting-both-anova">Fitting both… ANOVA!</h2>
<p>Now we will look at the effect of the <code>Tmt</code> in the context of the covariate, <code>InitialWt.</code></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ggoat <span class="ot">&lt;-</span> goat <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain, <span class="at">colour =</span> Tmt) <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>ggoat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This shows the effects of both predictors simultaneously. We can envisage two lines on this graph—one through the Intensive points and one through the Standard points. The difference in the heights of these lines is the effect of treatment, the slope of the lines is the effect of the initial weight, and any difference in the slopes of the lines is the interaction between the two predictors.</p>
<p>Now fit a model including both these predictors simultaneously, including any interaction.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Df Sum Sq Mean Sq F value  Pr(&gt;F)    
InitialWt      1  59.55   59.55  22.211 3.6e-05 ***
Tmt            1  16.00   16.00   5.966  0.0196 *  
InitialWt:Tmt  1   0.34    0.34   0.128  0.7230    
Residuals     36  96.51    2.68                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The first thing is to check for a significant interaction. There is not, so we can assume that there is no difference in the slope of the lines for Intensive and Standard treatments. Thus, there is no evidence that the effect of the initial weight varies among the two treatments, or that the treatment effect varies according to the initial weight.</p>
<p>Applying the <code>drop1()</code> function supports that the more parsimonious model is that without the interaction.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">drop1</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
WtGain ~ InitialWt * Tmt
              Df Sum of Sq    RSS    AIC
&lt;none&gt;                     96.514 43.232
InitialWt:Tmt  1   0.34225 96.857 41.374</code></pre>
</div>
</div>
<p>Now we can confidently fit the model with just the two main effects.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
InitialWt    1  59.55   59.55   22.75 2.87e-05 ***
Tmt          1  16.00   16.00    6.11   0.0182 *  
Residuals   37  96.86    2.62                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>I have put the treatment in the model after the initial weight, so we effectively obtain the Type II sum of squares for treatment, i.e., the variation that is attributable to treatment only, after all the variation attributable to initial weight has been accounted for. This provides a more conservative test for our effect of interest. It matters little in this case, however. Review the table for when treatment alone is fit.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
Tmt          1   16.9  16.900    4.13 0.0492 *
Residuals   38  155.5   4.092                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The SS for treatment has decreased only slightly from the inclusion of initial weight, from 16.9 to 16.0.</p>
<p>More importantly, though, the F-ratio has increased by 50% and the P-value has decreased from 0.05 to 0.02! Just from including another (potentially competing) predictor in the model! Take a moment to consider how this might have happened.</p>
<p>The key here is the decrease in the residual SS from 156 to 97. The F-ratio is calculated from the treatment SS divided by the residual SS. Therefore, if you decrease the residual SS, you can increase the value of F. By attributing variation to a covariate, it is no longer considered to be part of the random, unexplained variation. Our ability to detect an effect of the treatment is therefore strengthened.</p>
<p>This is also apparent in the linear model summary.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WtGain ~ InitialWt + Tmt, data = goat)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.9716 -1.2419 -0.0338  0.9878  3.2231 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.96661    1.75261   8.540 2.82e-10 ***
InitialWt   -0.35137    0.07424  -4.733 3.21e-05 ***
Tmtstandard -1.26486    0.51169  -2.472   0.0182 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.618 on 37 degrees of freedom
Multiple R-squared:  0.4382,    Adjusted R-squared:  0.4078 
F-statistic: 14.43 on 2 and 37 DF,  p-value: 2.331e-05</code></pre>
</div>
</div>
<p>While the estimated effect of the treatment has reduced from a difference of 1.30 to 1.26, the standard error has reduced from 0.64 to 0.51. We can recalculate the confidence interval for the difference (we remove a degree of freedom for the fact that we are also estimating a regression slope).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.26</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>),<span class="dv">37</span>) <span class="sc">*</span> <span class="fl">0.51169</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.2967824 -0.2232176</code></pre>
</div>
</div>
<p>The interval for the difference {0.223 , 2.297} is quite a bit smaller than the one obtained earlier when fitting treatment alone {0.005 , 2.595}, and no longer brushes so close to zero.</p>
</section>
<section id="plotting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-model">Plotting the model</h2>
<p>We can get <code>ggplot</code> to fit two linear models (one for each treatment) on our scatterplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ggoat <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, notice that the slopes are different. In our model, the slopes are the same, because it doesn’t have an interaction between <code>InitialWt</code> and <code>Tmt</code>. This is where the <code>visreg</code> package is very useful!</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">xvar =</span> <span class="st">"InitialWt"</span>, <span class="at">by =</span> <span class="st">"Tmt"</span>, <span class="at">overlay =</span> <span class="cn">TRUE</span>, <span class="at">gg =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="dataset-alfalfa" class="level1">
<h1>Dataset <strong><code>alfalfa</code></strong></h1>
<p>This dataset is from the R package <code>faraway</code>. The alfalfa dataset frame has 25 rows and 4 columns. Data comes from an experiment to test the effects of seed inoculum, irrigation and shade on alfalfa yield.</p>
<p>This data frame contains the following columns:</p>
<p><code>shade</code>: Distance of location from tree line divided into 5 shade areas</p>
<p><code>irrigation</code>: Irrigation effect divided into 5 levels</p>
<p><code>inoculum</code>: Four types of seed incolum, A-D with E as control</p>
<p><code>yield</code>: Dry matter yield of alfalfa</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(alfalfa, <span class="at">package =</span> <span class="st">"faraway"</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(alfalfa, <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercise-8.1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.1">Exercise 8.1</h2>
<p>Obtain the main effects and interaction plots.</p>
<p>Old style Main effects plots:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>alfalfa)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(mod1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Old style Interaction effects plots:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> irrigation, <span class="at">data =</span> alfalfa) </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:irrigation'</span>, </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod =</span> mod1) <span class="sc">|&gt;</span> </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:inoculum'</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod2) <span class="sc">|&gt;</span> </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> irrigation <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'irrigation:inoculum'</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod3) <span class="sc">|&gt;</span> </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>ggplot2</code> can produce good main effects and interaction plots but the R codes for this task are not short. For main effects plot-</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of shade"</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> irrigation, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of irrigation"</span>)</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of inoculum"</span>)</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>plot1<span class="sc">+</span>plot2<span class="sc">+</span>plot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For interaction plot-</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Interactions Plot</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*irrigation interaction"</span>)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"inoculum*irrigation interaction"</span>)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>plot6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> inoculum, <span class="at">colour =</span> inoculum) <span class="sc">+</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*inoculum interaction"</span>)</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">/</span> plot5 <span class="sc">/</span> plot6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.2">Exercise 8.2</h2>
<p>Fit one-way ANOVA models to this dataset. One model for each predictor variable. Examine the summary and Tukey results.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.3">Exercise 8.3</h2>
<p>Fit a three-factor (additive) ANOVA model without interactions.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Examine the residuals using base R style four diagnostic plots.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.4" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.4">Exercise 8.4</h2>
<p>Fit the indicator variable regression model of <code>yield ~ inoculum</code></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>alfalfa <span class="ot">&lt;-</span> alfalfa <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.A =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"A"</span>),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.B =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"B"</span>),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.C =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"C"</span>),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.D =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"D"</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>indicator.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> I.A <span class="sc">+</span> I.B <span class="sc">+</span> I.C <span class="sc">+</span> I.D, </span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> alfalfa)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(indicator.reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that this regression allows the treatments to be compared with the control.</p>
</section>
<section id="exercise-8.5" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.5">Exercise 8.5</h2>
<p><code>shade</code> is a categorical variable of factor codes but let us (incorrectly) treat it as numerical (and if the actual distances are given, then the <code>distance</code> variable becomes a covariate). Fit ANCOVA of yield on the <code>inoculum</code> factor and <code>shade</code> covariate.</p>
<p><strong>R:</strong></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="non-parametric-anova" class="level2">
<h2 class="anchored" data-anchor-id="non-parametric-anova">Non-parametric ANOVA</h2>
<p>Mann-Whitney test: allows to compare 2 groups under the non-normality assumption.</p>
<p>Kruskal-Wallis test: allows to compare three or more groups</p>
</section>
<section id="return-to-the-insect-data" class="level2">
<h2 class="anchored" data-anchor-id="return-to-the-insect-data">Return to the Insect Data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
   aov(formula = count ~ spray, data = IS)

Terms:
                   spray Residuals
Sum of Squares  2668.833  1015.167
Deg. of Freedom        5        66

Residual standard error: 3.921902
Estimated effects may be unbalanced</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = count ~ spray, data = IS)

$spray
           diff        lwr       upr     p adj
B-A   0.8333333  -3.866075  5.532742 0.9951810
C-A -12.4166667 -17.116075 -7.717258 0.0000000
D-A  -9.5833333 -14.282742 -4.883925 0.0000014
E-A -11.0000000 -15.699409 -6.300591 0.0000000
F-A   2.1666667  -2.532742  6.866075 0.7542147
C-B -13.2500000 -17.949409 -8.550591 0.0000000
D-B -10.4166667 -15.116075 -5.717258 0.0000002
E-B -11.8333333 -16.532742 -7.133925 0.0000000
F-B   1.3333333  -3.366075  6.032742 0.9603075
D-C   2.8333333  -1.866075  7.532742 0.4920707
E-C   1.4166667  -3.282742  6.116075 0.9488669
F-C  14.5833333   9.883925 19.282742 0.0000000
E-D  -1.4166667  -6.116075  3.282742 0.9488669
F-D  11.7500000   7.050591 16.449409 0.0000000
F-E  13.1666667   8.467258 17.866075 0.0000000</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(IS<span class="sc">$</span>count<span class="sc">~</span>IS<span class="sc">$</span>spray)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  IS$count by IS$spray
Kruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10</code></pre>
</div>
</div>
</section>
<section id="return-to-the-oyster-data" class="level2">
<h2 class="anchored" data-anchor-id="return-to-the-oyster-data">Return to the Oyster Data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity, <span class="at">data =</span> oys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
   aov(formula = Growth ~ Salinity, data = oys)

Terms:
                Salinity Residuals
Sum of Squares   0.16378  81.11150
Deg. of Freedom        1        58

Residual standard error: 1.182571
Estimated effects may be unbalanced</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(oys<span class="sc">$</span>Growth<span class="sc">~</span>oys<span class="sc">$</span>Salinity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  oys$Growth by oys$Salinity
Kruskal-Wallis chi-squared = 0.013989, df = 1, p-value = 0.9058</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(oys<span class="sc">$</span>Growth<span class="sc">~</span>oys<span class="sc">$</span>Salinity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum exact test

data:  oys$Growth by oys$Salinity
W = 458, p-value = 0.9124
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<ul>
<li>More R code examples are <a href="../exercises/Chap8more.R">here</a></li>
</ul>


<!-- -->

</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../workshops/ws07.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Chapter 7 Workshop</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb109" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 8 Workshop"</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Insect Sprays – Analysis of Variance</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>For this ANOVA tutorial, we will use the <span class="in">`InsectSprays`</span><span class="ot">[^1]</span> dataset provided in R, which gives the results of an experiment that examined the effects of six types of insecticide spray on the numbers of insects.  </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Data originally sourced from Beall, G. 1942. *The transformation of data from entomological field experiments*. Biometrika 32:243.</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load and look at the data</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>Load and examine the dataset.</span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(InsectSprays)</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(InsectSprays)</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(InsectSprays)</span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>You can read a bit about it here: <span class="in">`help(InsectSprays)`</span>.</span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>There are two variables. <span class="in">`count`</span> is the response variable and represents the number of insects found in a plot, and <span class="in">`spray`</span> is the predictor variable which indicates the type of insecticide used. Modelling a quantitative response variable with a categorical factor should make you immediately think of ANOVA!</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>Let’s give the dataset a shorter name, so we don’t have to write out InsectSprays whenever we want to use it.</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">=</span> InsectSprays</span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>Check the number of replicates (data points) for each group. </span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-51"><a href="#cb109-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>spray)</span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>This shows that there are 12 replicates in each group. Because n is the same for each level, we can say that this is a balanced design.</span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the data</span></span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a>Let’s plot the data using a boxplot.</span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-63"><a href="#cb109-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-64"><a href="#cb109-64" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb109-65"><a href="#cb109-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb109-66"><a href="#cb109-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb109-67"><a href="#cb109-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb109-68"><a href="#cb109-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-69"><a href="#cb109-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-70"><a href="#cb109-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-71"><a href="#cb109-71" aria-hidden="true" tabindex="-1"></a>What are your first impressions? Does it look like there is much difference among the groups? </span>
<span id="cb109-72"><a href="#cb109-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-73"><a href="#cb109-73" aria-hidden="true" tabindex="-1"></a>Boxplots are useful, but for small datasets it can be revealing to plot the actual data.</span>
<span id="cb109-74"><a href="#cb109-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-75"><a href="#cb109-75" aria-hidden="true" tabindex="-1"></a>We can use a dotplot with violins.</span>
<span id="cb109-76"><a href="#cb109-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-79"><a href="#cb109-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-80"><a href="#cb109-80" aria-hidden="true" tabindex="-1"></a>dvp <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> </span>
<span id="cb109-81"><a href="#cb109-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb109-82"><a href="#cb109-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb109-83"><a href="#cb109-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> <span class="co"># display the violins</span></span>
<span id="cb109-84"><a href="#cb109-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="co"># add the points, with a little jitter so they do not overlap </span></span>
<span id="cb109-85"><a href="#cb109-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-86"><a href="#cb109-86" aria-hidden="true" tabindex="-1"></a>dvp</span>
<span id="cb109-87"><a href="#cb109-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-88"><a href="#cb109-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-89"><a href="#cb109-89" aria-hidden="true" tabindex="-1"></a>Do you think the dot/violinplot is more or less informative than the boxplot?</span>
<span id="cb109-90"><a href="#cb109-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-91"><a href="#cb109-91" aria-hidden="true" tabindex="-1"></a>Analysis of variance compares the variation among groups (group means from the overall mean) with the variation within groups (data points from their group means). Recall that, while useful, boxplots do not actually show us the means. So, to help with our visual impression of these data in the context of ANOVA, we’ll now add the means to the dotplot. </span>
<span id="cb109-92"><a href="#cb109-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-93"><a href="#cb109-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-94"><a href="#cb109-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-97"><a href="#cb109-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-98"><a href="#cb109-98" aria-hidden="true" tabindex="-1"></a>meanIS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">mean</span>(count))</span>
<span id="cb109-99"><a href="#cb109-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-100"><a href="#cb109-100" aria-hidden="true" tabindex="-1"></a>dvp <span class="sc">+</span> </span>
<span id="cb109-101"><a href="#cb109-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="co"># adds a line for the mean value</span></span>
<span id="cb109-102"><a href="#cb109-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> meanIS,</span>
<span id="cb109-103"><a href="#cb109-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"darkorange"</span> ,</span>
<span id="cb109-104"><a href="#cb109-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"|"</span>,</span>
<span id="cb109-105"><a href="#cb109-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb109-106"><a href="#cb109-106" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-107"><a href="#cb109-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-108"><a href="#cb109-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-109"><a href="#cb109-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-110"><a href="#cb109-110" aria-hidden="true" tabindex="-1"></a>Though I do like boxplots, I think this is probably a more useful and revealing plot in this case, especially since we’re about to do an ANOVA, which tests for differences among means. </span>
<span id="cb109-111"><a href="#cb109-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-112"><a href="#cb109-112" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting an ANOVA model</span></span>
<span id="cb109-113"><a href="#cb109-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-114"><a href="#cb109-114" aria-hidden="true" tabindex="-1"></a>An ANOVA model is fit in R using the function <span class="in">`aov()`</span>. There is a function <span class="in">`anova()`</span>, but this instead can be used to produce an ANOVA table from an existing model (we saw use of this in Chapter 7).</span>
<span id="cb109-115"><a href="#cb109-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-116"><a href="#cb109-116" aria-hidden="true" tabindex="-1"></a>Let’s do it. </span>
<span id="cb109-117"><a href="#cb109-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-120"><a href="#cb109-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-121"><a href="#cb109-121" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data =</span> IS)</span>
<span id="cb109-122"><a href="#cb109-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-123"><a href="#cb109-123" aria-hidden="true" tabindex="-1"></a>This shows the among-groups (<span class="in">`spray`</span>) and within-groups (<span class="in">`Residuals`</span>) sum of squares, and degrees of freedom. The <span class="in">`Residual standard error`</span> is the square root of the error variance ($\sigma_\varepsilon^2$). It is the expected (average) absolute deviation from the individual data points to their respective group means. If required, you can remind yourself what these values represent from the lecture slides.</span>
<span id="cb109-124"><a href="#cb109-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-125"><a href="#cb109-125" aria-hidden="true" tabindex="-1"></a>We can get the full ANOVA table by commanding a <span class="in">`summary()`</span> of an <span class="in">`aov`</span> object. (Note, a very similar output can be achieved by applying the <span class="in">`anova()`</span> function to an <span class="in">`aov`</span> object.)</span>
<span id="cb109-126"><a href="#cb109-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-129"><a href="#cb109-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-130"><a href="#cb109-130" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-131"><a href="#cb109-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-132"><a href="#cb109-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-133"><a href="#cb109-133" aria-hidden="true" tabindex="-1"></a>The full ANOVA table also gives us the Mean Squares (the SS divided by their respective df), the F value (the ratio of the within-to-among-groups Mean Squares), and the P-value. </span>
<span id="cb109-134"><a href="#cb109-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-135"><a href="#cb109-135" aria-hidden="true" tabindex="-1"></a>The null hypothesis tested here is that there is no difference between the group means in the population. </span>
<span id="cb109-136"><a href="#cb109-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-137"><a href="#cb109-137" aria-hidden="true" tabindex="-1"></a>$$H_0 : \mu_1 = \mu_2 = ... = \mu_g$$</span>
<span id="cb109-138"><a href="#cb109-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-139"><a href="#cb109-139" aria-hidden="true" tabindex="-1"></a>The alternative hypothesis is that at least one of the groups is different to the others. </span>
<span id="cb109-140"><a href="#cb109-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-141"><a href="#cb109-141" aria-hidden="true" tabindex="-1"></a>Remember that we assume that we have taken a sample of data at random from a population. The P-value is the proportion of equivalent samples in which we would obtain the observed test statistic or greater **if the null hypothesis is true** (i.e. no difference among groups). In other words, how likely is it that the observed differences among means have occurred just through chance? Here, the F ratio is high and P-value is tiny (&lt; 0.0000000000000002). So, there is extremely strong evidence against the null hypothesis and we can conclude that there is indeed a difference among the group means—plants subjected to different types of spray have, on average, different numbers of insects on them. </span>
<span id="cb109-142"><a href="#cb109-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-143"><a href="#cb109-143" aria-hidden="true" tabindex="-1"></a>This, in itself, is not immensely informative. Naturally, we wish to examine which groups (spray types) are different from one another.</span>
<span id="cb109-144"><a href="#cb109-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-145"><a href="#cb109-145" aria-hidden="true" tabindex="-1"></a>But, first, we need to examine our assumptions.</span>
<span id="cb109-146"><a href="#cb109-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-147"><a href="#cb109-147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examining the assumptions of ANOVA</span></span>
<span id="cb109-148"><a href="#cb109-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-149"><a href="#cb109-149" aria-hidden="true" tabindex="-1"></a>Like for regression, diagnostic plots are the first step for examining how well the assumptions of ANOVA are met by our model. If these assumptions are not met, then the F-ratio might not behave as it should (i.e. follow an F-distribution) with repeated sampling under a true null hypothesis. </span>
<span id="cb109-150"><a href="#cb109-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-151"><a href="#cb109-151" aria-hidden="true" tabindex="-1"></a>Those assumptions are:</span>
<span id="cb109-152"><a href="#cb109-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-153"><a href="#cb109-153" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Appropriateness of an additive linear model</span>
<span id="cb109-154"><a href="#cb109-154" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Independent errors</span>
<span id="cb109-155"><a href="#cb109-155" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Normally distributed errors</span>
<span id="cb109-156"><a href="#cb109-156" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Homogeneity of errors</span>
<span id="cb109-157"><a href="#cb109-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-158"><a href="#cb109-158" aria-hidden="true" tabindex="-1"></a>We will focus on 3 and 4 because 1 and 2 cannot really be checked at this stage of the analysis. </span>
<span id="cb109-159"><a href="#cb109-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-160"><a href="#cb109-160" aria-hidden="true" tabindex="-1"></a>Let’s make the plots.</span>
<span id="cb109-161"><a href="#cb109-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-164"><a href="#cb109-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-165"><a href="#cb109-165" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span>
<span id="cb109-166"><a href="#cb109-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-167"><a href="#cb109-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-168"><a href="#cb109-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-169"><a href="#cb109-169" aria-hidden="true" tabindex="-1"></a>There is cause for concern here. As is often the case with counts, there seems to be some heteroscedasticity in the residuals. That is, the residual variance does not appear constant, but rather increases with the fitted value. In an ANOVA context, this means that the groups with high means have greater within-group variation. Let’s have a look at the standard deviations of the groups.</span>
<span id="cb109-170"><a href="#cb109-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-173"><a href="#cb109-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-174"><a href="#cb109-174" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(count))</span>
<span id="cb109-175"><a href="#cb109-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-176"><a href="#cb109-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-177"><a href="#cb109-177" aria-hidden="true" tabindex="-1"></a>Indeed, there is a huge difference between the largest and smallest standard deviation (roughly 3.5-fold).</span>
<span id="cb109-178"><a href="#cb109-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-179"><a href="#cb109-179" aria-hidden="true" tabindex="-1"></a>We can use a Levene’s test to explicitly test for evidence of heterogeneous variances. The function <span class="in">`leveneTest()`</span> in the <span class="in">`car`</span> package does this. Remember, the null hypothesis is that the average absolute deviations are the same in all groups. </span>
<span id="cb109-180"><a href="#cb109-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-183"><a href="#cb109-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-184"><a href="#cb109-184" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span>
<span id="cb109-185"><a href="#cb109-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-186"><a href="#cb109-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-187"><a href="#cb109-187" aria-hidden="true" tabindex="-1"></a>The low P-value here indicates that the null hypothesis is rejected and our suspicions were correct—there are significant differences in the variations among groups. </span>
<span id="cb109-188"><a href="#cb109-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-189"><a href="#cb109-189" aria-hidden="true" tabindex="-1"></a>The assumption of normality also seems suspect here, according to the fact that many data do not fall along the dotted line in the Q-Q plot. This is probably part of the same problem. </span>
<span id="cb109-190"><a href="#cb109-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-191"><a href="#cb109-191" aria-hidden="true" tabindex="-1"></a>We can try transforming the response variable <span class="in">`count`</span> and see if that helps. </span>
<span id="cb109-192"><a href="#cb109-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-193"><a href="#cb109-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## ANOVA for transformed counts</span></span>
<span id="cb109-194"><a href="#cb109-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-195"><a href="#cb109-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-196"><a href="#cb109-196" aria-hidden="true" tabindex="-1"></a>We will try a log(x+1) transformation. We add the constant 1 because there are some (two) zeros in the dataset.</span>
<span id="cb109-197"><a href="#cb109-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-200"><a href="#cb109-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-201"><a href="#cb109-201" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>count)</span>
<span id="cb109-202"><a href="#cb109-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-203"><a href="#cb109-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-204"><a href="#cb109-204" aria-hidden="true" tabindex="-1"></a>Let’s test the assumption for the transformed data. </span>
<span id="cb109-205"><a href="#cb109-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-208"><a href="#cb109-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-209"><a href="#cb109-209" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb109-210"><a href="#cb109-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb109-211"><a href="#cb109-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb109-212"><a href="#cb109-212" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb109-213"><a href="#cb109-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> lcount <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb109-214"><a href="#cb109-214" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span>
<span id="cb109-215"><a href="#cb109-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-216"><a href="#cb109-216" aria-hidden="true" tabindex="-1"></a>The test is now non-significant, but 0.1 is still a fairly small P-value. Looking at the following boxplot, it seems like the log transformation might be too severe—the groups with smaller means now seem to have higher variance than those with larger means. </span>
<span id="cb109-217"><a href="#cb109-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-218"><a href="#cb109-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-221"><a href="#cb109-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-222"><a href="#cb109-222" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb109-223"><a href="#cb109-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb109-224"><a href="#cb109-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb109-225"><a href="#cb109-225" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb109-226"><a href="#cb109-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb109-227"><a href="#cb109-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lcount, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb109-228"><a href="#cb109-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb109-229"><a href="#cb109-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-230"><a href="#cb109-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-231"><a href="#cb109-231" aria-hidden="true" tabindex="-1"></a>Now try instead a square-root transformation.  </span>
<span id="cb109-232"><a href="#cb109-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-235"><a href="#cb109-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-236"><a href="#cb109-236" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb109-237"><a href="#cb109-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb109-238"><a href="#cb109-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb109-239"><a href="#cb109-239" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb109-240"><a href="#cb109-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> sqrt_count <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb109-241"><a href="#cb109-241" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span>
<span id="cb109-242"><a href="#cb109-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-243"><a href="#cb109-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-246"><a href="#cb109-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-247"><a href="#cb109-247" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb109-248"><a href="#cb109-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb109-249"><a href="#cb109-249" aria-hidden="true" tabindex="-1"></a> <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb109-250"><a href="#cb109-250" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb109-251"><a href="#cb109-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb109-252"><a href="#cb109-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> sqrt_count, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb109-253"><a href="#cb109-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb109-254"><a href="#cb109-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-255"><a href="#cb109-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-256"><a href="#cb109-256" aria-hidden="true" tabindex="-1"></a>This looks like a better transformation for this model.</span>
<span id="cb109-257"><a href="#cb109-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-258"><a href="#cb109-258" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting an ANOVA to the transformed data </span></span>
<span id="cb109-259"><a href="#cb109-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-260"><a href="#cb109-260" aria-hidden="true" tabindex="-1"></a>Fit the model.</span>
<span id="cb109-261"><a href="#cb109-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-264"><a href="#cb109-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-265"><a href="#cb109-265" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) )</span>
<span id="cb109-266"><a href="#cb109-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-267"><a href="#cb109-267" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-268"><a href="#cb109-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-269"><a href="#cb109-269" aria-hidden="true" tabindex="-1"></a>Now show up the diagnostic plots for this model.</span>
<span id="cb109-270"><a href="#cb109-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-273"><a href="#cb109-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-274"><a href="#cb109-274" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb109-275"><a href="#cb109-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-276"><a href="#cb109-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-277"><a href="#cb109-277" aria-hidden="true" tabindex="-1"></a>Much better!</span>
<span id="cb109-278"><a href="#cb109-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-279"><a href="#cb109-279" aria-hidden="true" tabindex="-1"></a>This clearly has not made a substantial impact on the result of the hypothesis test for a difference among group means, but we can be happier that the inference is correct.</span>
<span id="cb109-280"><a href="#cb109-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-281"><a href="#cb109-281" aria-hidden="true" tabindex="-1"></a>Now let’s look at the differences among groups. </span>
<span id="cb109-282"><a href="#cb109-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-283"><a href="#cb109-283" aria-hidden="true" tabindex="-1"></a><span class="fu">## Post-hoc multiple comparisons </span></span>
<span id="cb109-284"><a href="#cb109-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-285"><a href="#cb109-285" aria-hidden="true" tabindex="-1"></a>Tukey’s Honest Significant Differences (HSD) are a method of adjusting for the fact that, in a post-hoc analysis such as this, there are simultaneously hypothesis tests being done. Across all these tests, the probability of erroneously finding a significant difference (i.e. making a Type I error) is greater than the nominated alpha value (usually 0.05). The HSD method makes each individual test slightly more conservative so that the family-wise error rate across all tests is conserved. </span>
<span id="cb109-286"><a href="#cb109-286" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-287"><a href="#cb109-287" aria-hidden="true" tabindex="-1"></a>Tukey’s HSD can be implemented in R as follows. </span>
<span id="cb109-288"><a href="#cb109-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-291"><a href="#cb109-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-292"><a href="#cb109-292" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span>
<span id="cb109-293"><a href="#cb109-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-294"><a href="#cb109-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-295"><a href="#cb109-295" aria-hidden="true" tabindex="-1"></a>This table above has each possible pairwise comparison of groups. The number of comparisons is $g(g – 1)/2 = 15$ (where $g$ = the number of groups = 6). </span>
<span id="cb109-296"><a href="#cb109-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-297"><a href="#cb109-297" aria-hidden="true" tabindex="-1"></a>For each pairwise comparison, the table gives the estimated difference (<span class="in">`diff`</span>), the lower (<span class="in">`lwr`</span>) and upper (<span class="in">`upr`</span>) confidence intervals and the p-value (<span class="in">`p adj`</span>) which tests whether the difference is statistically significant. The confidence intervals and the p-value are adjusted for the fact that multiple simultaneous comparisons are being made, and so are more conservative than if they were done separately. Out of the 15 comparisons, 10 have very low p-values. </span>
<span id="cb109-298"><a href="#cb109-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-299"><a href="#cb109-299" aria-hidden="true" tabindex="-1"></a>Here are the intervals shown on a plot.</span>
<span id="cb109-300"><a href="#cb109-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-301"><a href="#cb109-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-304"><a href="#cb109-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-305"><a href="#cb109-305" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> </span>
<span id="cb109-306"><a href="#cb109-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TukeyHSD</span>() <span class="sc">|&gt;</span> </span>
<span id="cb109-307"><a href="#cb109-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb109-308"><a href="#cb109-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-309"><a href="#cb109-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-310"><a href="#cb109-310" aria-hidden="true" tabindex="-1"></a>This plot provides a visual impression of the size and adjusted confidence intervals for each comparison. An interval that includes zero indicates that the difference between those groups is non-significant (i.e. the null hypothesis of no difference is retained). This was the case for <span class="in">`B-A`</span>, <span class="in">`F-A`</span>, <span class="in">`F-B`</span>, <span class="in">`E-C`</span>, and <span class="in">`E-D`</span>. From the earlier plots, this makes sense. <span class="in">`A-B-F`</span> seem to be quite similar, as do <span class="in">`E-C-D`</span>. </span>
<span id="cb109-311"><a href="#cb109-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-312"><a href="#cb109-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-313"><a href="#cb109-313" aria-hidden="true" tabindex="-1"></a><span class="fu"># Oyster growth – two-way ANOVA</span></span>
<span id="cb109-314"><a href="#cb109-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-315"><a href="#cb109-315" aria-hidden="true" tabindex="-1"></a>We will analyse a dataset (which I invented) from an experiment that manipulated salinity and temperature and measured the growth of oysters in these different regimes. </span>
<span id="cb109-316"><a href="#cb109-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-317"><a href="#cb109-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb109-318"><a href="#cb109-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-321"><a href="#cb109-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-322"><a href="#cb109-322" aria-hidden="true" tabindex="-1"></a>oys <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/oystergrowth.csv"</span>)</span>
<span id="cb109-323"><a href="#cb109-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-324"><a href="#cb109-324" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(oys)</span>
<span id="cb109-325"><a href="#cb109-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-326"><a href="#cb109-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-327"><a href="#cb109-327" aria-hidden="true" tabindex="-1"></a>The response variable is <span class="in">`Growth.`</span> </span>
<span id="cb109-328"><a href="#cb109-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-329"><a href="#cb109-329" aria-hidden="true" tabindex="-1"></a>There are two factors:</span>
<span id="cb109-330"><a href="#cb109-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-331"><a href="#cb109-331" aria-hidden="true" tabindex="-1"></a>Factor A: <span class="in">`Temperature`</span>, a = 3 levels (<span class="in">`High`</span>, <span class="in">`Medium`</span>, and <span class="in">`Low`</span>)</span>
<span id="cb109-332"><a href="#cb109-332" aria-hidden="true" tabindex="-1"></a>Factor B: <span class="in">`Salinity`</span>, b = 2 levels (<span class="in">`High`</span> and <span class="in">`Low`</span>),</span>
<span id="cb109-333"><a href="#cb109-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-336"><a href="#cb109-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-337"><a href="#cb109-337" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(oys<span class="sc">$</span>Salinity, oys<span class="sc">$</span>Temperature)</span>
<span id="cb109-338"><a href="#cb109-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-339"><a href="#cb109-339" aria-hidden="true" tabindex="-1"></a>The table above shows a count of 10 data points per combination of <span class="in">`Temperature`</span> and <span class="in">`Salinity.`</span> The equal number of observations among cells shows the experiment has a crossed and balanced design. </span>
<span id="cb109-340"><a href="#cb109-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-341"><a href="#cb109-341" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ordering factors</span></span>
<span id="cb109-342"><a href="#cb109-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-343"><a href="#cb109-343" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Temperature`</span> variable is ordinal, having a natural order. R does not know this automatically. </span>
<span id="cb109-344"><a href="#cb109-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-347"><a href="#cb109-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-348"><a href="#cb109-348" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(oys<span class="sc">$</span>Temperature) <span class="sc">|&gt;</span> <span class="fu">levels</span>()</span>
<span id="cb109-349"><a href="#cb109-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-350"><a href="#cb109-350" aria-hidden="true" tabindex="-1"></a>We can tell R the correct order of the factors by turning them into ordered factors.</span>
<span id="cb109-351"><a href="#cb109-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-354"><a href="#cb109-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-355"><a href="#cb109-355" aria-hidden="true" tabindex="-1"></a>oys <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb109-356"><a href="#cb109-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb109-357"><a href="#cb109-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> <span class="fu">factor</span>(</span>
<span id="cb109-358"><a href="#cb109-358" aria-hidden="true" tabindex="-1"></a>      Temperature, </span>
<span id="cb109-359"><a href="#cb109-359" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"Med"</span>,<span class="st">"High"</span>)</span>
<span id="cb109-360"><a href="#cb109-360" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb109-361"><a href="#cb109-361" aria-hidden="true" tabindex="-1"></a>    <span class="at">Salinity =</span> <span class="fu">factor</span>(</span>
<span id="cb109-362"><a href="#cb109-362" aria-hidden="true" tabindex="-1"></a>      Salinity, </span>
<span id="cb109-363"><a href="#cb109-363" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"High"</span>)</span>
<span id="cb109-364"><a href="#cb109-364" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb109-365"><a href="#cb109-365" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-366"><a href="#cb109-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-367"><a href="#cb109-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-368"><a href="#cb109-368" aria-hidden="true" tabindex="-1"></a>We will first examine separately the effects of <span class="in">`Temperature`</span> and <span class="in">`Salinity`</span> on <span class="in">`Growth`</span>, first focusing on <span class="in">`Temperature.`</span></span>
<span id="cb109-369"><a href="#cb109-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-372"><a href="#cb109-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-373"><a href="#cb109-373" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(oys) <span class="sc">+</span> </span>
<span id="cb109-374"><a href="#cb109-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Growth, <span class="at">y =</span> Temperature) <span class="sc">+</span> </span>
<span id="cb109-375"><a href="#cb109-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb109-376"><a href="#cb109-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-377"><a href="#cb109-377" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(oys) <span class="sc">+</span> </span>
<span id="cb109-378"><a href="#cb109-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Growth, <span class="at">y =</span> Temperature) <span class="sc">+</span></span>
<span id="cb109-379"><a href="#cb109-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb109-380"><a href="#cb109-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="dv">0</span>, <span class="at">height=</span>.<span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) </span>
<span id="cb109-381"><a href="#cb109-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-382"><a href="#cb109-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-383"><a href="#cb109-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## One-way ANOVAs</span></span>
<span id="cb109-384"><a href="#cb109-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-385"><a href="#cb109-385" aria-hidden="true" tabindex="-1"></a>What are your first impressions of these data? Do you think that <span class="in">`Temperature`</span> has an effect on the <span class="in">`Growth`</span> of oysters here? Do you think an ANOVA is an appropriate analysis to use? Would you expect the assumptions of ANOVA to be upheld?</span>
<span id="cb109-386"><a href="#cb109-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-387"><a href="#cb109-387" aria-hidden="true" tabindex="-1"></a>Two things stand out. Firstly, it does not look like <span class="in">`Temperature`</span> has a strong effect <span class="in">`Growth`</span>—the variation within the groups looks to be much larger than the variation among groups. Run a one-way ANOVA to test this.</span>
<span id="cb109-388"><a href="#cb109-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-391"><a href="#cb109-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-392"><a href="#cb109-392" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-393"><a href="#cb109-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-394"><a href="#cb109-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-395"><a href="#cb109-395" aria-hidden="true" tabindex="-1"></a>Secondly, the data seem to have different variances among the three groups. Use a Levene’s test to confirm this.</span>
<span id="cb109-396"><a href="#cb109-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-399"><a href="#cb109-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-400"><a href="#cb109-400" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-401"><a href="#cb109-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-402"><a href="#cb109-402" aria-hidden="true" tabindex="-1"></a>Now make the same plots for <span class="in">`Salinity`</span> and <span class="in">`Growth`</span>.</span>
<span id="cb109-403"><a href="#cb109-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-404"><a href="#cb109-404" aria-hidden="true" tabindex="-1"></a>The same general result was obtained for <span class="in">`Salinity`</span> as it was for <span class="in">`Temperature`</span>—there was not apparent effect of <span class="in">`Salinity`</span> on <span class="in">`Growth`</span>, and the dispersions among groups are significantly different (although only marginally so). </span>
<span id="cb109-405"><a href="#cb109-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-406"><a href="#cb109-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction plots</span></span>
<span id="cb109-407"><a href="#cb109-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-408"><a href="#cb109-408" aria-hidden="true" tabindex="-1"></a>Now we will examine <span class="in">`Growth`</span> simultaneously in terms of both <span class="in">`Temperature`</span> and <span class="in">`Salinity`</span>.</span>
<span id="cb109-409"><a href="#cb109-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-410"><a href="#cb109-410" aria-hidden="true" tabindex="-1"></a>Let's make a plot.</span>
<span id="cb109-411"><a href="#cb109-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-414"><a href="#cb109-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-415"><a href="#cb109-415" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb109-416"><a href="#cb109-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb109-417"><a href="#cb109-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Temperature, <span class="at">y =</span> Growth, <span class="at">colour =</span> Salinity) <span class="sc">+</span> </span>
<span id="cb109-418"><a href="#cb109-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb109-419"><a href="#cb109-419" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">4</span>,</span>
<span id="cb109-420"><a href="#cb109-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb109-421"><a href="#cb109-421" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-422"><a href="#cb109-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-423"><a href="#cb109-423" aria-hidden="true" tabindex="-1"></a>g_oys_st</span>
<span id="cb109-424"><a href="#cb109-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-425"><a href="#cb109-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-426"><a href="#cb109-426" aria-hidden="true" tabindex="-1"></a>Let's add the means to the plot above. First, let's calculate the means of each combination of <span class="in">`Temperature`</span> and <span class="in">`Salinity`</span>.</span>
<span id="cb109-427"><a href="#cb109-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-430"><a href="#cb109-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-431"><a href="#cb109-431" aria-hidden="true" tabindex="-1"></a>mean_growth <span class="ot">&lt;-</span> oys <span class="sc">|&gt;</span> </span>
<span id="cb109-432"><a href="#cb109-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Temperature, Salinity) <span class="sc">|&gt;</span> </span>
<span id="cb109-433"><a href="#cb109-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Growth =</span> <span class="fu">mean</span>(Growth))</span>
<span id="cb109-434"><a href="#cb109-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-435"><a href="#cb109-435" aria-hidden="true" tabindex="-1"></a>mean_growth</span>
<span id="cb109-436"><a href="#cb109-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-437"><a href="#cb109-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-438"><a href="#cb109-438" aria-hidden="true" tabindex="-1"></a>Now add the means as lines.</span>
<span id="cb109-439"><a href="#cb109-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-442"><a href="#cb109-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-443"><a href="#cb109-443" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="sc">+</span> </span>
<span id="cb109-444"><a href="#cb109-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb109-445"><a href="#cb109-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mean_growth,</span>
<span id="cb109-446"><a href="#cb109-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">group =</span> Salinity),</span>
<span id="cb109-447"><a href="#cb109-447" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb109-448"><a href="#cb109-448" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-449"><a href="#cb109-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-450"><a href="#cb109-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-451"><a href="#cb109-451" aria-hidden="true" tabindex="-1"></a>Note, we can make this plot without pre-calculating the means, by way of the <span class="in">`stat_summary()`</span> function. </span>
<span id="cb109-452"><a href="#cb109-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-455"><a href="#cb109-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-456"><a href="#cb109-456" aria-hidden="true" tabindex="-1"></a>g_oys_st <span class="sc">+</span> </span>
<span id="cb109-457"><a href="#cb109-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb109-458"><a href="#cb109-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> Salinity), </span>
<span id="cb109-459"><a href="#cb109-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> mean, </span>
<span id="cb109-460"><a href="#cb109-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom=</span><span class="st">"line"</span>,</span>
<span id="cb109-461"><a href="#cb109-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb109-462"><a href="#cb109-462" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-463"><a href="#cb109-463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-464"><a href="#cb109-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-465"><a href="#cb109-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-466"><a href="#cb109-466" aria-hidden="true" tabindex="-1"></a>So, our one-group analysis was unable to tell the real story in this dataset. </span>
<span id="cb109-467"><a href="#cb109-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-468"><a href="#cb109-468" aria-hidden="true" tabindex="-1"></a>Before doing a formal two-way ANOVA, try to understand this graph. </span>
<span id="cb109-469"><a href="#cb109-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-470"><a href="#cb109-470" aria-hidden="true" tabindex="-1"></a>Do you expect to find a significant interaction? </span>
<span id="cb109-471"><a href="#cb109-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-472"><a href="#cb109-472" aria-hidden="true" tabindex="-1"></a>Why do you think there was no discernable pattern in the one-factor analyses?</span>
<span id="cb109-473"><a href="#cb109-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-474"><a href="#cb109-474" aria-hidden="true" tabindex="-1"></a>Will differing dispersions among groups still be a problem? </span>
<span id="cb109-475"><a href="#cb109-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-476"><a href="#cb109-476" aria-hidden="true" tabindex="-1"></a><span class="fu">## Two-way ANOVA</span></span>
<span id="cb109-477"><a href="#cb109-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-478"><a href="#cb109-478" aria-hidden="true" tabindex="-1"></a>OK, let’s take a look at an ANOVA model with both factors included, plus the interaction. For this, you can write the full formula: <span class="in">`Temperature + Salinity + Temperature:Salinity`</span>. In R, <span class="in">`Temperature:Salinity`</span> is syntax for the interaction between <span class="in">`Temperature`</span> and <span class="in">`Salinity.`</span> Alternatively, this formula can be specified using this syntax: <span class="in">`Temperature*Salinity`</span>. This is equivalent to writing the full formula explicitly. Both factors, and their interaction, are included. </span>
<span id="cb109-479"><a href="#cb109-479" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-482"><a href="#cb109-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-483"><a href="#cb109-483" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth <span class="sc">~</span> Temperature <span class="sc">*</span> Salinity, <span class="at">data =</span> oys) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-484"><a href="#cb109-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-485"><a href="#cb109-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-486"><a href="#cb109-486" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction</span></span>
<span id="cb109-487"><a href="#cb109-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-488"><a href="#cb109-488" aria-hidden="true" tabindex="-1"></a>First, we look at the interaction <span class="in">`Temperature:Salinity`</span>. It is highly significant and the most important source of explained variation in the model. This was abundantly clear when we plotted <span class="in">`Growth`</span> according to *both* factors simultaneously. The mean lines on the plot were not parallel, which is indicative of an interaction. </span>
<span id="cb109-489"><a href="#cb109-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-490"><a href="#cb109-490" aria-hidden="true" tabindex="-1"></a><span class="in">`Temperature`</span> and <span class="in">`Salinity`</span> have an effect on <span class="in">`Growth`</span> but they are no independent. The effect of <span class="in">`Temperature`</span> on <span class="in">`Growth`</span> depends on <span class="in">`Salinity`</span>, and the effect of <span class="in">`Salinity`</span> on <span class="in">`Growth`</span> depends on <span class="in">`Temperature`</span>.</span>
<span id="cb109-491"><a href="#cb109-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-492"><a href="#cb109-492" aria-hidden="true" tabindex="-1"></a>Without taking <span class="in">`Salinity`</span> into account, <span class="in">`Temperature`</span> has no apparent effect. For low <span class="in">`Salinity`</span> environments, growth increases with increasing <span class="in">`Temperature`</span>. For high <span class="in">`Salinity`</span>, the opposite is true: <span class="in">`Growth`</span> decreases with increasing <span class="in">`Temperature`</span>. </span>
<span id="cb109-493"><a href="#cb109-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-494"><a href="#cb109-494" aria-hidden="true" tabindex="-1"></a>There is an important lesson to be learned here. A variable that is important for explaining variation in the response, but not included in the model, can obfuscate the relationship between the response and the variables that you have included, particularly when interactions are present. </span>
<span id="cb109-495"><a href="#cb109-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-496"><a href="#cb109-496" aria-hidden="true" tabindex="-1"></a>So-called 'latent' variables cause problems in science. This highlights the importance of knowing all the important causes of variation in a measured response. Two strategies may then be employed. You can hold a variable constant (e.g., examine temperature in medium salinity environments) but this restricts the inference space of your conclusions (they would only be valid for medium salinity). Alternatively, you can include a variable in the design (or measure it if it is not easily manipulated), ensuring that it is accounted for in any analyses. </span>
<span id="cb109-497"><a href="#cb109-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-498"><a href="#cb109-498" aria-hidden="true" tabindex="-1"></a>Another potential consequence of an unknown latent variable is excess dispersion in some groups. This resulted in a significant departure from group homogeneity in the Levene’s test for both <span class="in">`Salinity`</span> and <span class="in">`Temperature`</span> when the other was left out. </span>
<span id="cb109-499"><a href="#cb109-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-500"><a href="#cb109-500" aria-hidden="true" tabindex="-1"></a>Another thing to note is that, when the interaction is significant, we don't need to worry about the main effects of the two factors. </span>
<span id="cb109-501"><a href="#cb109-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-502"><a href="#cb109-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Post-hoc group comparisons</span></span>
<span id="cb109-503"><a href="#cb109-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-504"><a href="#cb109-504" aria-hidden="true" tabindex="-1"></a>The next step in the analysis is to test which levels of the factors differ from each other, using a multiple comparisons procedure, such as Tukey’s Honest Significant Differences. Because the interaction is significant, it is the comparison within the interaction term that will be of most interest. There are six cells (3×2), so the number of comparisons within the interaction term will be six-choose-two:</span>
<span id="cb109-505"><a href="#cb109-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-508"><a href="#cb109-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-509"><a href="#cb109-509" aria-hidden="true" tabindex="-1"></a><span class="fu">choose</span>(<span class="dv">6</span>,<span class="dv">2</span>)</span>
<span id="cb109-510"><a href="#cb109-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-511"><a href="#cb109-511" aria-hidden="true" tabindex="-1"></a>Run a Tukey analysis.</span>
<span id="cb109-512"><a href="#cb109-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-515"><a href="#cb109-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-516"><a href="#cb109-516" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity<span class="sc">*</span>Temperature, <span class="at">data=</span>oys) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span>
<span id="cb109-517"><a href="#cb109-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-518"><a href="#cb109-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-519"><a href="#cb109-519" aria-hidden="true" tabindex="-1"></a>First, in the single-factor comparisons (ignoring the other factor), only one comparison is significant—between high and low temperatures. The difference is only 0.46, however, and we know that this comparison does not represent the real effects of temperature on growth. It is marginalised over salinity, whereas we now know that the most important effects of temperature are, in fact, conditional on salinity. </span>
<span id="cb109-520"><a href="#cb109-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-521"><a href="#cb109-521" aria-hidden="true" tabindex="-1"></a>For the interaction comparisons, 13 out of 15 are significantly different. You should refer to the interaction plot on the previous page (or on your screen) to make some sense of which of the comparisons are large or small. For example, the first line gives the comparison between the low-salinity-low-temperature group and the high-salinity-low-temperature group (i.e. the two groups to the left of the interaction plot above). It is one of the largest absolute differences and is highly significant. The greatest difference is on the ninth line of the interaction comparisons: low-salinity-high-temperature vs low-salinity-low-temperature (i.e., those at opposite ends of the low-salinity line on the interaction plot).</span>
<span id="cb109-522"><a href="#cb109-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-523"><a href="#cb109-523" aria-hidden="true" tabindex="-1"></a>We can also plot the comparisons and corresponding Tukey intervals. The <span class="in">`which`</span> argument allows you to restrict the output to particular terms (here, the interaction). </span>
<span id="cb109-524"><a href="#cb109-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-527"><a href="#cb109-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-528"><a href="#cb109-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb109-529"><a href="#cb109-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb109-530"><a href="#cb109-530" aria-hidden="true" tabindex="-1"></a>tuk <span class="ot">&lt;-</span> <span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity<span class="sc">*</span>Temperature, <span class="at">data=</span>oys) <span class="sc">|&gt;</span> </span>
<span id="cb109-531"><a href="#cb109-531" aria-hidden="true" tabindex="-1"></a>    <span class="fu">TukeyHSD</span>(<span class="at">which =</span> <span class="st">"Salinity:Temperature"</span>)</span>
<span id="cb109-532"><a href="#cb109-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-533"><a href="#cb109-533" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">1</span>)) <span class="co"># adjust the margins so you can read the labels</span></span>
<span id="cb109-534"><a href="#cb109-534" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tuk, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb109-535"><a href="#cb109-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-536"><a href="#cb109-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-537"><a href="#cb109-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-538"><a href="#cb109-538" aria-hidden="true" tabindex="-1"></a><span class="fu"># Goats – Analysis of **Co**variance</span></span>
<span id="cb109-539"><a href="#cb109-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-540"><a href="#cb109-540" aria-hidden="true" tabindex="-1"></a><span class="al">![A goat](../img/goat.jpg)</span> </span>
<span id="cb109-541"><a href="#cb109-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-542"><a href="#cb109-542" aria-hidden="true" tabindex="-1"></a>Here, we will use a dataset<span class="ot">[^1]</span> containing the weights of 40 goats before and after an experiment where 20 were given a standard drenching treatment and 20 were given a more intensive drenching treatment. There are three columns corresponding to the treatment (<span class="in">`Tmt`</span>), the gain in weight over the experiment (<span class="in">`WtGain`</span>, kg), and the initial weight at the start of the experiment (<span class="in">`InitialWt`</span>, kg). </span>
<span id="cb109-543"><a href="#cb109-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-544"><a href="#cb109-544" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]</span> Source: Saville DJ, Wood GR (1991) *Statistical Methods: The Geometric Approach*. Springer, New York.</span>
<span id="cb109-545"><a href="#cb109-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-546"><a href="#cb109-546" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the data</span></span>
<span id="cb109-547"><a href="#cb109-547" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-550"><a href="#cb109-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-551"><a href="#cb109-551" aria-hidden="true" tabindex="-1"></a>goat <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/goats.txt"</span>)</span>
<span id="cb109-552"><a href="#cb109-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-553"><a href="#cb109-553" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(goat)</span>
<span id="cb109-554"><a href="#cb109-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-555"><a href="#cb109-555" aria-hidden="true" tabindex="-1"></a>The initial weight is included because of commonly observed biological phenomenon known as "regression to the norm", where lighter animals even the ledger by gaining more weight than the heavier animals. By using an ANCOVA model that incorporates the initial weight as a covariate can therefore give us more power to detect an effect of the treatment. </span>
<span id="cb109-556"><a href="#cb109-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-557"><a href="#cb109-557" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting treatment only </span></span>
<span id="cb109-558"><a href="#cb109-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-559"><a href="#cb109-559" aria-hidden="true" tabindex="-1"></a>Let’s start with a boxplot of the response variable by reference to the predictor of interest, treatment.</span>
<span id="cb109-560"><a href="#cb109-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-563"><a href="#cb109-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-564"><a href="#cb109-564" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb109-565"><a href="#cb109-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb109-566"><a href="#cb109-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> WtGain, <span class="at">y =</span> Tmt) <span class="sc">+</span> </span>
<span id="cb109-567"><a href="#cb109-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb109-568"><a href="#cb109-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-569"><a href="#cb109-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-570"><a href="#cb109-570" aria-hidden="true" tabindex="-1"></a>There seems to be a reasonable effect of treatment. Fit a one-way ANOVA showing this.</span>
<span id="cb109-571"><a href="#cb109-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-574"><a href="#cb109-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-575"><a href="#cb109-575" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-576"><a href="#cb109-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-577"><a href="#cb109-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-578"><a href="#cb109-578" aria-hidden="true" tabindex="-1"></a>Sure enough, effect of the treatment is significant, though it is marginally so. The effect size can be viewed in a linear model summary.</span>
<span id="cb109-579"><a href="#cb109-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-582"><a href="#cb109-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-583"><a href="#cb109-583" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-584"><a href="#cb109-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-585"><a href="#cb109-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-586"><a href="#cb109-586" aria-hidden="true" tabindex="-1"></a>From here, we can see that the estimated difference between the treatments is 1.3 kg—the mean for intensive is 6.85 kg and the mean for standard is 5.55 kg. </span>
<span id="cb109-587"><a href="#cb109-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-590"><a href="#cb109-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-591"><a href="#cb109-591" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Tmt) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(WtGain))</span>
<span id="cb109-592"><a href="#cb109-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-593"><a href="#cb109-593" aria-hidden="true" tabindex="-1"></a>The fitted model explains only 10% of the variation in the data. The average difference between the fitted means and the observations is 2.023, which is greater than the estimated difference in means. So, all in all, there is a significant effect but it is not large. We can estimate a 95% confidence interval for this difference using $\hat d + t_{df,<span class="co">[</span><span class="ot">0.025,0.975</span><span class="co">]</span>} \times \text{SE}(\hat d)$. </span>
<span id="cb109-594"><a href="#cb109-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-597"><a href="#cb109-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-598"><a href="#cb109-598" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.3</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="dv">38</span>) <span class="sc">*</span> <span class="fl">0.6397</span></span>
<span id="cb109-599"><a href="#cb109-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-600"><a href="#cb109-600" aria-hidden="true" tabindex="-1"></a>So, the confidence interval for the difference is <span class="sc">\{</span>0.005 , 2.595<span class="sc">\}</span>.</span>
<span id="cb109-601"><a href="#cb109-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-602"><a href="#cb109-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting Initial Weight only</span></span>
<span id="cb109-603"><a href="#cb109-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-604"><a href="#cb109-604" aria-hidden="true" tabindex="-1"></a>Now we will look at the effect of the covariate, <span class="in">`InitialWt`</span>. </span>
<span id="cb109-605"><a href="#cb109-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-608"><a href="#cb109-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-609"><a href="#cb109-609" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb109-610"><a href="#cb109-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb109-611"><a href="#cb109-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain) <span class="sc">+</span></span>
<span id="cb109-612"><a href="#cb109-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb109-613"><a href="#cb109-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-614"><a href="#cb109-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-615"><a href="#cb109-615" aria-hidden="true" tabindex="-1"></a>We can see that there is a relationship between the initial weight of the goats and the gain in weight, in that the goats that were lighter at the start of the experiment gained more weight. </span>
<span id="cb109-616"><a href="#cb109-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-617"><a href="#cb109-617" aria-hidden="true" tabindex="-1"></a>Look at a linear model using this predictor alone.</span>
<span id="cb109-618"><a href="#cb109-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-621"><a href="#cb109-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-622"><a href="#cb109-622" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-623"><a href="#cb109-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-624"><a href="#cb109-624" aria-hidden="true" tabindex="-1"></a>For every extra kilogram of weight at the start, the goat is expected to gain 354 g less over the course of the experiment. The effect is highly significant, and explains 35% of the variation in weight gain. We are not interested in this effect though, per se, because it has been demonstrated many times before. We are most interested in the effect of the treatment.</span>
<span id="cb109-625"><a href="#cb109-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-626"><a href="#cb109-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting both... ANOVA!</span></span>
<span id="cb109-627"><a href="#cb109-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-628"><a href="#cb109-628" aria-hidden="true" tabindex="-1"></a>Now we will look at the effect of the <span class="in">`Tmt`</span> in the context of the covariate, <span class="in">`InitialWt.`</span> </span>
<span id="cb109-629"><a href="#cb109-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-632"><a href="#cb109-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-633"><a href="#cb109-633" aria-hidden="true" tabindex="-1"></a>ggoat <span class="ot">&lt;-</span> goat <span class="sc">|&gt;</span> </span>
<span id="cb109-634"><a href="#cb109-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb109-635"><a href="#cb109-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain, <span class="at">colour =</span> Tmt) <span class="sc">+</span></span>
<span id="cb109-636"><a href="#cb109-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb109-637"><a href="#cb109-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-638"><a href="#cb109-638" aria-hidden="true" tabindex="-1"></a>ggoat</span>
<span id="cb109-639"><a href="#cb109-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-640"><a href="#cb109-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-641"><a href="#cb109-641" aria-hidden="true" tabindex="-1"></a>This shows the effects of both predictors simultaneously. We can envisage two lines on this graph—one through the Intensive points and one through the Standard points. The difference in the heights of these lines is the effect of treatment, the slope of the lines is the effect of the initial weight, and any difference in the slopes of the lines is the interaction between the two predictors. </span>
<span id="cb109-642"><a href="#cb109-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-643"><a href="#cb109-643" aria-hidden="true" tabindex="-1"></a>Now fit a model including both these predictors simultaneously, including any interaction. </span>
<span id="cb109-644"><a href="#cb109-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-647"><a href="#cb109-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-648"><a href="#cb109-648" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-649"><a href="#cb109-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-650"><a href="#cb109-650" aria-hidden="true" tabindex="-1"></a>The first thing is to check for a significant interaction. There is not, so we can assume that there is no difference in the slope of the lines for Intensive and Standard treatments. Thus, there is no evidence that the effect of the initial weight varies among the two treatments, or that the treatment effect varies according to the initial weight. </span>
<span id="cb109-651"><a href="#cb109-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-652"><a href="#cb109-652" aria-hidden="true" tabindex="-1"></a>Applying the <span class="in">`drop1()`</span> function supports that the more parsimonious model is that without the interaction.</span>
<span id="cb109-653"><a href="#cb109-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-656"><a href="#cb109-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-657"><a href="#cb109-657" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">drop1</span>()</span>
<span id="cb109-658"><a href="#cb109-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-659"><a href="#cb109-659" aria-hidden="true" tabindex="-1"></a>Now we can confidently fit the model with just the two main effects. </span>
<span id="cb109-660"><a href="#cb109-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-663"><a href="#cb109-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-664"><a href="#cb109-664" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-665"><a href="#cb109-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-666"><a href="#cb109-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-667"><a href="#cb109-667" aria-hidden="true" tabindex="-1"></a>I have put the treatment in the model after the initial weight, so we effectively obtain the Type II sum of squares for treatment, i.e., the variation that is attributable to treatment only, after all the variation attributable to initial weight has been accounted for. This provides a more conservative test for our effect of interest. It matters little in this case, however. Review the table for when treatment alone is fit.</span>
<span id="cb109-668"><a href="#cb109-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-671"><a href="#cb109-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-672"><a href="#cb109-672" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-673"><a href="#cb109-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-674"><a href="#cb109-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-675"><a href="#cb109-675" aria-hidden="true" tabindex="-1"></a>The SS for treatment has decreased only slightly from the inclusion of initial weight, from 16.9 to 16.0. </span>
<span id="cb109-676"><a href="#cb109-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-677"><a href="#cb109-677" aria-hidden="true" tabindex="-1"></a>More importantly, though, the F-ratio has increased by 50% and the P-value has decreased from 0.05 to 0.02! Just from including another (potentially competing) predictor in the model! Take a moment to consider how this might have happened.</span>
<span id="cb109-678"><a href="#cb109-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-679"><a href="#cb109-679" aria-hidden="true" tabindex="-1"></a>The key here is the decrease in the residual SS from 156 to 97. The F-ratio is calculated from the treatment SS divided by the residual SS. Therefore, if you decrease the residual SS, you can increase the value of F. By attributing variation to a covariate, it is no longer considered to be part of the random, unexplained variation. Our ability to detect an effect of the treatment is therefore strengthened. </span>
<span id="cb109-680"><a href="#cb109-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-681"><a href="#cb109-681" aria-hidden="true" tabindex="-1"></a>This is also apparent in the linear model summary.</span>
<span id="cb109-682"><a href="#cb109-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-685"><a href="#cb109-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-686"><a href="#cb109-686" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb109-687"><a href="#cb109-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-688"><a href="#cb109-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-689"><a href="#cb109-689" aria-hidden="true" tabindex="-1"></a>While the estimated effect of the treatment has reduced from a difference of 1.30 to 1.26, the standard error has reduced from 0.64 to 0.51. We can recalculate the confidence interval for the difference (we remove a degree of freedom for the fact that we are also estimating a regression slope).</span>
<span id="cb109-690"><a href="#cb109-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-693"><a href="#cb109-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-694"><a href="#cb109-694" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.26</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>),<span class="dv">37</span>) <span class="sc">*</span> <span class="fl">0.51169</span></span>
<span id="cb109-695"><a href="#cb109-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-696"><a href="#cb109-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-697"><a href="#cb109-697" aria-hidden="true" tabindex="-1"></a>The interval for the difference <span class="sc">\{</span>0.223 , 2.297<span class="sc">\}</span> is quite a bit smaller than the one obtained earlier when fitting treatment alone <span class="sc">\{</span>0.005 , 2.595<span class="sc">\}</span>, and no longer brushes so close to zero.</span>
<span id="cb109-698"><a href="#cb109-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-699"><a href="#cb109-699" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the model</span></span>
<span id="cb109-700"><a href="#cb109-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-701"><a href="#cb109-701" aria-hidden="true" tabindex="-1"></a>We can get <span class="in">`ggplot`</span> to fit two linear models (one for each treatment) on our scatterplot. </span>
<span id="cb109-702"><a href="#cb109-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-705"><a href="#cb109-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-706"><a href="#cb109-706" aria-hidden="true" tabindex="-1"></a>ggoat <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb109-707"><a href="#cb109-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-708"><a href="#cb109-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-709"><a href="#cb109-709" aria-hidden="true" tabindex="-1"></a>However, notice that the slopes are different. In our model, the slopes are the same, because it doesn't have an interaction between <span class="in">`InitialWt`</span> and <span class="in">`Tmt`</span>. This is where the <span class="in">`visreg`</span> package is very useful!</span>
<span id="cb109-710"><a href="#cb109-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-713"><a href="#cb109-713" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-714"><a href="#cb109-714" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb109-715"><a href="#cb109-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-716"><a href="#cb109-716" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> </span>
<span id="cb109-717"><a href="#cb109-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">xvar =</span> <span class="st">"InitialWt"</span>, <span class="at">by =</span> <span class="st">"Tmt"</span>, <span class="at">overlay =</span> <span class="cn">TRUE</span>, <span class="at">gg =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-718"><a href="#cb109-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-719"><a href="#cb109-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-720"><a href="#cb109-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-721"><a href="#cb109-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-722"><a href="#cb109-722" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset **`alfalfa`**</span></span>
<span id="cb109-723"><a href="#cb109-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-724"><a href="#cb109-724" aria-hidden="true" tabindex="-1"></a>This dataset is from the R package <span class="in">`faraway`</span>. The alfalfa dataset frame has 25 rows and 4 columns. Data comes from an experiment to test the effects of seed inoculum, irrigation and shade on alfalfa yield. </span>
<span id="cb109-725"><a href="#cb109-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-726"><a href="#cb109-726" aria-hidden="true" tabindex="-1"></a>This data frame contains the following columns:</span>
<span id="cb109-727"><a href="#cb109-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-728"><a href="#cb109-728" aria-hidden="true" tabindex="-1"></a><span class="in">`shade`</span>: Distance of location from tree line divided into 5 shade areas</span>
<span id="cb109-729"><a href="#cb109-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-730"><a href="#cb109-730" aria-hidden="true" tabindex="-1"></a><span class="in">`irrigation`</span>: Irrigation effect divided into 5 levels</span>
<span id="cb109-731"><a href="#cb109-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-732"><a href="#cb109-732" aria-hidden="true" tabindex="-1"></a><span class="in">`inoculum`</span>: Four types of seed incolum, A-D with E as control</span>
<span id="cb109-733"><a href="#cb109-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-734"><a href="#cb109-734" aria-hidden="true" tabindex="-1"></a><span class="in">`yield`</span>: Dry matter yield of alfalfa</span>
<span id="cb109-735"><a href="#cb109-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-736"><a href="#cb109-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide'}</span></span>
<span id="cb109-737"><a href="#cb109-737" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-738"><a href="#cb109-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-739"><a href="#cb109-739" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(alfalfa, <span class="at">package =</span> <span class="st">"faraway"</span>)</span>
<span id="cb109-740"><a href="#cb109-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-741"><a href="#cb109-741" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(alfalfa, <span class="dv">25</span>)</span>
<span id="cb109-742"><a href="#cb109-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-743"><a href="#cb109-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-744"><a href="#cb109-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-745"><a href="#cb109-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-746"><a href="#cb109-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-747"><a href="#cb109-747" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.1 {-}</span></span>
<span id="cb109-748"><a href="#cb109-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-749"><a href="#cb109-749" aria-hidden="true" tabindex="-1"></a>Obtain the main effects and interaction plots.</span>
<span id="cb109-750"><a href="#cb109-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-751"><a href="#cb109-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-752"><a href="#cb109-752" aria-hidden="true" tabindex="-1"></a>Old style Main effects plots:</span>
<span id="cb109-753"><a href="#cb109-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-754"><a href="#cb109-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-755"><a href="#cb109-755" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum, </span>
<span id="cb109-756"><a href="#cb109-756" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>alfalfa)</span>
<span id="cb109-757"><a href="#cb109-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-758"><a href="#cb109-758" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb109-759"><a href="#cb109-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-760"><a href="#cb109-760" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(mod1))</span>
<span id="cb109-761"><a href="#cb109-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-762"><a href="#cb109-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-763"><a href="#cb109-763" aria-hidden="true" tabindex="-1"></a>Old style Interaction effects plots:</span>
<span id="cb109-764"><a href="#cb109-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-765"><a href="#cb109-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-766"><a href="#cb109-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-767"><a href="#cb109-767" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb109-768"><a href="#cb109-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-769"><a href="#cb109-769" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> irrigation, <span class="at">data =</span> alfalfa) </span>
<span id="cb109-770"><a href="#cb109-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-771"><a href="#cb109-771" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:irrigation'</span>, </span>
<span id="cb109-772"><a href="#cb109-772" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod =</span> mod1) <span class="sc">|&gt;</span> </span>
<span id="cb109-773"><a href="#cb109-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-774"><a href="#cb109-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-775"><a href="#cb109-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-776"><a href="#cb109-776" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb109-777"><a href="#cb109-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-778"><a href="#cb109-778" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:inoculum'</span>,</span>
<span id="cb109-779"><a href="#cb109-779" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod2) <span class="sc">|&gt;</span> </span>
<span id="cb109-780"><a href="#cb109-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span>
<span id="cb109-781"><a href="#cb109-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-782"><a href="#cb109-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-783"><a href="#cb109-783" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> irrigation <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb109-784"><a href="#cb109-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-785"><a href="#cb109-785" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'irrigation:inoculum'</span>,</span>
<span id="cb109-786"><a href="#cb109-786" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod3) <span class="sc">|&gt;</span> </span>
<span id="cb109-787"><a href="#cb109-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span>
<span id="cb109-788"><a href="#cb109-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-789"><a href="#cb109-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-790"><a href="#cb109-790" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span> can produce good main effects and interaction plots but the R codes for this task are not short. For main effects plot-</span>
<span id="cb109-791"><a href="#cb109-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-792"><a href="#cb109-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-793"><a href="#cb109-793" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb109-794"><a href="#cb109-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-795"><a href="#cb109-795" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span> </span>
<span id="cb109-796"><a href="#cb109-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb109-797"><a href="#cb109-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb109-798"><a href="#cb109-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb109-799"><a href="#cb109-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-800"><a href="#cb109-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of shade"</span>)</span>
<span id="cb109-801"><a href="#cb109-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-802"><a href="#cb109-802" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb109-803"><a href="#cb109-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> irrigation, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb109-804"><a href="#cb109-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb109-805"><a href="#cb109-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb109-806"><a href="#cb109-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-807"><a href="#cb109-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of irrigation"</span>)</span>
<span id="cb109-808"><a href="#cb109-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-809"><a href="#cb109-809" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb109-810"><a href="#cb109-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb109-811"><a href="#cb109-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb109-812"><a href="#cb109-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb109-813"><a href="#cb109-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-814"><a href="#cb109-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of inoculum"</span>)</span>
<span id="cb109-815"><a href="#cb109-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-816"><a href="#cb109-816" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb109-817"><a href="#cb109-817" aria-hidden="true" tabindex="-1"></a>plot1<span class="sc">+</span>plot2<span class="sc">+</span>plot3</span>
<span id="cb109-818"><a href="#cb109-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-819"><a href="#cb109-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-820"><a href="#cb109-820" aria-hidden="true" tabindex="-1"></a>For interaction plot-</span>
<span id="cb109-821"><a href="#cb109-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-822"><a href="#cb109-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-823"><a href="#cb109-823" aria-hidden="true" tabindex="-1"></a><span class="co">#Interactions Plot</span></span>
<span id="cb109-824"><a href="#cb109-824" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb109-825"><a href="#cb109-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb109-826"><a href="#cb109-826" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb109-827"><a href="#cb109-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb109-828"><a href="#cb109-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb109-829"><a href="#cb109-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-830"><a href="#cb109-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*irrigation interaction"</span>)</span>
<span id="cb109-831"><a href="#cb109-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-832"><a href="#cb109-832" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb109-833"><a href="#cb109-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield,</span>
<span id="cb109-834"><a href="#cb109-834" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb109-835"><a href="#cb109-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb109-836"><a href="#cb109-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb109-837"><a href="#cb109-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-838"><a href="#cb109-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"inoculum*irrigation interaction"</span>)</span>
<span id="cb109-839"><a href="#cb109-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-840"><a href="#cb109-840" aria-hidden="true" tabindex="-1"></a>plot6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb109-841"><a href="#cb109-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb109-842"><a href="#cb109-842" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> inoculum, <span class="at">colour =</span> inoculum) <span class="sc">+</span></span>
<span id="cb109-843"><a href="#cb109-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb109-844"><a href="#cb109-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb109-845"><a href="#cb109-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb109-846"><a href="#cb109-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*inoculum interaction"</span>)</span>
<span id="cb109-847"><a href="#cb109-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-848"><a href="#cb109-848" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">/</span> plot5 <span class="sc">/</span> plot6</span>
<span id="cb109-849"><a href="#cb109-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-850"><a href="#cb109-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-851"><a href="#cb109-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-852"><a href="#cb109-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-853"><a href="#cb109-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-854"><a href="#cb109-854" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.2 {-}</span></span>
<span id="cb109-855"><a href="#cb109-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-856"><a href="#cb109-856" aria-hidden="true" tabindex="-1"></a>Fit one-way ANOVA models to this dataset. One model for each predictor variable. Examine the summary and Tukey results.</span>
<span id="cb109-857"><a href="#cb109-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-858"><a href="#cb109-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-859"><a href="#cb109-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-860"><a href="#cb109-860" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-861"><a href="#cb109-861" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-862"><a href="#cb109-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-863"><a href="#cb109-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-864"><a href="#cb109-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-865"><a href="#cb109-865" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.3 {-}</span></span>
<span id="cb109-866"><a href="#cb109-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-867"><a href="#cb109-867" aria-hidden="true" tabindex="-1"></a>Fit a three-factor (additive) ANOVA model without interactions.</span>
<span id="cb109-868"><a href="#cb109-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-869"><a href="#cb109-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-870"><a href="#cb109-870" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-871"><a href="#cb109-871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-872"><a href="#cb109-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-873"><a href="#cb109-873" aria-hidden="true" tabindex="-1"></a>Examine the residuals using base R style four diagnostic plots.  </span>
<span id="cb109-874"><a href="#cb109-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-877"><a href="#cb109-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-878"><a href="#cb109-878" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb109-879"><a href="#cb109-879" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-880"><a href="#cb109-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-881"><a href="#cb109-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-882"><a href="#cb109-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-883"><a href="#cb109-883" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.4 {-}</span></span>
<span id="cb109-884"><a href="#cb109-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-885"><a href="#cb109-885" aria-hidden="true" tabindex="-1"></a>Fit the indicator variable regression model of <span class="in">`yield ~ inoculum`</span></span>
<span id="cb109-886"><a href="#cb109-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-887"><a href="#cb109-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-888"><a href="#cb109-888" aria-hidden="true" tabindex="-1"></a>alfalfa <span class="ot">&lt;-</span> alfalfa <span class="sc">|&gt;</span> </span>
<span id="cb109-889"><a href="#cb109-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb109-890"><a href="#cb109-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.A =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"A"</span>),</span>
<span id="cb109-891"><a href="#cb109-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.B =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"B"</span>),</span>
<span id="cb109-892"><a href="#cb109-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.C =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"C"</span>),</span>
<span id="cb109-893"><a href="#cb109-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.D =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"D"</span>)</span>
<span id="cb109-894"><a href="#cb109-894" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb109-895"><a href="#cb109-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-896"><a href="#cb109-896" aria-hidden="true" tabindex="-1"></a>indicator.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> I.A <span class="sc">+</span> I.B <span class="sc">+</span> I.C <span class="sc">+</span> I.D, </span>
<span id="cb109-897"><a href="#cb109-897" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> alfalfa)</span>
<span id="cb109-898"><a href="#cb109-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-899"><a href="#cb109-899" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(indicator.reg)</span>
<span id="cb109-900"><a href="#cb109-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-901"><a href="#cb109-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-902"><a href="#cb109-902" aria-hidden="true" tabindex="-1"></a>Note that this regression allows the treatments to be compared with the control.</span>
<span id="cb109-903"><a href="#cb109-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-904"><a href="#cb109-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-905"><a href="#cb109-905" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.5 {-}</span></span>
<span id="cb109-906"><a href="#cb109-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-907"><a href="#cb109-907" aria-hidden="true" tabindex="-1"></a><span class="in">`shade`</span> is a categorical variable of factor codes but let us (incorrectly) treat it as numerical (and if the actual distances are given, then the <span class="in">`distance`</span> variable becomes a covariate). Fit ANCOVA of yield on the <span class="in">`inoculum`</span> factor and <span class="in">`shade`</span> covariate.</span>
<span id="cb109-908"><a href="#cb109-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-909"><a href="#cb109-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-910"><a href="#cb109-910" aria-hidden="true" tabindex="-1"></a>**R:**</span>
<span id="cb109-911"><a href="#cb109-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb109-912"><a href="#cb109-912" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb109-913"><a href="#cb109-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-914"><a href="#cb109-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-915"><a href="#cb109-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-916"><a href="#cb109-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-917"><a href="#cb109-917" aria-hidden="true" tabindex="-1"></a><span class="fu">## Non-parametric ANOVA</span></span>
<span id="cb109-918"><a href="#cb109-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-919"><a href="#cb109-919" aria-hidden="true" tabindex="-1"></a>Mann-Whitney test: allows to compare 2 groups under the non-normality assumption.</span>
<span id="cb109-920"><a href="#cb109-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-921"><a href="#cb109-921" aria-hidden="true" tabindex="-1"></a>Kruskal-Wallis test: allows to compare three or more groups</span>
<span id="cb109-922"><a href="#cb109-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-923"><a href="#cb109-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-924"><a href="#cb109-924" aria-hidden="true" tabindex="-1"></a><span class="fu">## Return to the Insect Data</span></span>
<span id="cb109-925"><a href="#cb109-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-928"><a href="#cb109-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-929"><a href="#cb109-929" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS)</span>
<span id="cb109-930"><a href="#cb109-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-931"><a href="#cb109-931" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span>
<span id="cb109-932"><a href="#cb109-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-933"><a href="#cb109-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-936"><a href="#cb109-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-937"><a href="#cb109-937" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(IS<span class="sc">$</span>count<span class="sc">~</span>IS<span class="sc">$</span>spray)</span>
<span id="cb109-938"><a href="#cb109-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-939"><a href="#cb109-939" aria-hidden="true" tabindex="-1"></a><span class="fu">## Return to the Oyster Data</span></span>
<span id="cb109-940"><a href="#cb109-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-943"><a href="#cb109-943" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-944"><a href="#cb109-944" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(Growth<span class="sc">~</span>Salinity, <span class="at">data =</span> oys)</span>
<span id="cb109-945"><a href="#cb109-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-946"><a href="#cb109-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-949"><a href="#cb109-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-950"><a href="#cb109-950" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(oys<span class="sc">$</span>Growth<span class="sc">~</span>oys<span class="sc">$</span>Salinity)</span>
<span id="cb109-951"><a href="#cb109-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-952"><a href="#cb109-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-955"><a href="#cb109-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-956"><a href="#cb109-956" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(oys<span class="sc">$</span>Growth<span class="sc">~</span>oys<span class="sc">$</span>Salinity)</span>
<span id="cb109-957"><a href="#cb109-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-958"><a href="#cb109-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-959"><a href="#cb109-959" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>More R code examples are <span class="co">[</span><span class="ot">here</span><span class="co">](../exercises/Chap8more.R)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>