<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>161250 Data Analysis - Tabulated Counts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../workshops/ws06.html" rel="next">
<link href="../workshops/ws04.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">161250 Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../studyguide/index.html" rel="" target="">
 <span class="menu-text">Study Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../workshops/ws01.html" rel="" target="" aria-current="page">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data/" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Extra Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-code">    
        <li>
    <a class="dropdown-item" href="../exercises/Chap2more.R" rel="" target="">
 <span class="dropdown-text">Ex2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap3more.R" rel="" target="">
 <span class="dropdown-text">Ex3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap4more.R" rel="" target="">
 <span class="dropdown-text">Ex4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap5more.R" rel="" target="">
 <span class="dropdown-text">Ex5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap6more.R" rel="" target="">
 <span class="dropdown-text">Ex6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap7more.R" rel="" target="">
 <span class="dropdown-text">Ex7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap8more.R" rel="" target="">
 <span class="dropdown-text">Ex8</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workshops/ws05.html">Tabulated Counts</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started With R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws01_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidy data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability Concepts and Distributions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Inference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws05.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tabulated Counts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models with a singular predictor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models with Multiple Predictors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA and ANCOVA</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summarising-data" id="toc-summarising-data" class="nav-link active" data-scroll-target="#summarising-data">Summarising data</a>
  <ul class="collapse">
  <li><a href="#exercise-5.1" id="toc-exercise-5.1" class="nav-link" data-scroll-target="#exercise-5.1">Exercise 5.1</a></li>
  <li><a href="#exercise-5.2" id="toc-exercise-5.2" class="nav-link" data-scroll-target="#exercise-5.2">Exercise 5.2</a></li>
  <li><a href="#exercise-5.3" id="toc-exercise-5.3" class="nav-link" data-scroll-target="#exercise-5.3">Exercise 5.3</a></li>
  <li><a href="#exercise-5.4" id="toc-exercise-5.4" class="nav-link" data-scroll-target="#exercise-5.4">Exercise 5.4</a></li>
  </ul></li>
  <li><a href="#tidying-data" id="toc-tidying-data" class="nav-link" data-scroll-target="#tidying-data">Tidying data</a>
  <ul class="collapse">
  <li><a href="#exercise-5.5" id="toc-exercise-5.5" class="nav-link" data-scroll-target="#exercise-5.5">Exercise 5.5</a></li>
  </ul></li>
  <li><a href="#combining-datasets" id="toc-combining-datasets" class="nav-link" data-scroll-target="#combining-datasets">Combining datasets</a>
  <ul class="collapse">
  <li><a href="#types-of-join" id="toc-types-of-join" class="nav-link" data-scroll-target="#types-of-join">Types of join</a></li>
  <li><a href="#we-will-illustrate-them-using-a-simple-example" id="toc-we-will-illustrate-them-using-a-simple-example" class="nav-link" data-scroll-target="#we-will-illustrate-them-using-a-simple-example">We will illustrate them using a simple example:</a></li>
  <li><a href="#joining-data-example" id="toc-joining-data-example" class="nav-link" data-scroll-target="#joining-data-example">Joining data: Example</a></li>
  <li><a href="#specifying-join-keys" id="toc-specifying-join-keys" class="nav-link" data-scroll-target="#specifying-join-keys">Specifying join keys</a></li>
  <li><a href="#exercise-5.6" id="toc-exercise-5.6" class="nav-link" data-scroll-target="#exercise-5.6">Exercise 5.6</a></li>
  <li><a href="#exercise-5.7" id="toc-exercise-5.7" class="nav-link" data-scroll-target="#exercise-5.7">Exercise 5.7</a></li>
  </ul></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when">case_when()</a>
  <ul class="collapse">
  <li><a href="#exercise-5.8" id="toc-exercise-5.8" class="nav-link" data-scroll-target="#exercise-5.8">Exercise 5.8</a></li>
  </ul></li>
  <li><a href="#dataset-toxaemia" id="toc-dataset-toxaemia" class="nav-link" data-scroll-target="#dataset-toxaemia">Dataset <code>Toxaemia</code></a>
  <ul class="collapse">
  <li><a href="#exercise-5.9" id="toc-exercise-5.9" class="nav-link" data-scroll-target="#exercise-5.9">Exercise 5.9</a></li>
  <li><a href="#exercise-5.10" id="toc-exercise-5.10" class="nav-link" data-scroll-target="#exercise-5.10">Exercise 5.10</a></li>
  </ul></li>
  <li><a href="#data-diamonds" id="toc-data-diamonds" class="nav-link" data-scroll-target="#data-diamonds">Data <code>diamonds</code></a>
  <ul class="collapse">
  <li><a href="#exercise-5.11" id="toc-exercise-5.11" class="nav-link" data-scroll-target="#exercise-5.11">Exercise 5.11</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ws05.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tabulated Counts</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summarising-data" class="level1">
<h1>Summarising data</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>my.tv.data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"../data/tv.csv"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="st">"nfcc"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The argument <code>col_types = "nfcc"</code> stands for {<code>numeric</code>, <code>factor</code>, <code>character</code>, <code>character</code>}, to match the order of the columns.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my.tv.data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 46 × 4
   TELETIME SEX   SCHOOL STANDARD
      &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;  &lt;chr&gt;   
 1     1482 1     1      4       
 2     2018 1     1      4       
 3     1849 1     1      4       
 4      857 1     1      4       
 5     2027 2     1      4       
 6     2368 2     1      4       
 7     1783 2     1      4       
 8     1769 2     1      4       
 9     2534 1     1      3       
10     2366 1     1      3       
# ℹ 36 more rows</code></pre>
</div>
</div>
<p>We often do a summary of a numerical variable for a given categorical variable. For example, we like to see obtain the summary statistics of TV viewing times for various schools. The commands</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(my.tv.data<span class="sc">$</span>TELETIME, my.tv.data<span class="sc">$</span>SCHOOL, summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We employed the <code>by()</code> command above and instead, we may also use <code>tapply()</code> <code>aggregate()</code> functions:</p>
<p><code>tapply(my.data$TELETIME, my.data$SCHOOL, summary)</code></p>
<p><code>aggregate(my.data$TELETIME, list(my.data$SCHOOL), summary)</code></p>
<p>A tabulated summary of categorical data is obtained using the <code>table()</code> command. You can also use the tidyverse employing functions like filter, group_by, and summarise.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rangitikei <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"../data/rangitikei.csv"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="dv">1</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>wind <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> <span class="fu">pull</span>(wind)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>river <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> <span class="fu">pull</span>(river)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wind, river)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercise-5.1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.1">Exercise 5.1</h2>
<p>Describe the table generated above. What does it tell you?</p>
<div id="answer">

</div>
</section>
<section id="exercise-5.2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.2">Exercise 5.2</h2>
<p>Generate a table that summarizes the mean number of vehicles at each level of wind and temperature. What does this table tell you about the data?</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="exercise-5.3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.3">Exercise 5.3</h2>
<p>Now repeat this for the average people observed. What does this tell you about the data?</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="exercise-5.4" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.4">Exercise 5.4</h2>
<p>Given the two tables you produced describe patterns of people and vehicles at Rangitikei rivers.</p>
<div id="answer">

</div>
</section>
</section>
<section id="tidying-data" class="level1">
<h1>Tidying data</h1>
<p>Most real analyses will require at least a little tidying. You’ll begin by figuring out what the underlying variables and observations are. Sometimes this is easy; other times you’ll need to consult with the people who originally generated the data. Next, you’ll pivot your data into a tidy form, with variables in the columns and observations in the rows.</p>
<p>The <code>billboard</code> dataset records the billboard rank of songs in the year 2000:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>billboard</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 79
   artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
   &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
 2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
 3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
 4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
 5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
 6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
 7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
 8 Aaliyah    I Do… 2000-01-29      84    62    51    41    38    35    35    38
 9 Aaliyah    Try … 2000-03-18      59    53    38    28    21    18    16    14
10 Adams, Yo… Open… 2000-08-26      76    76    74    69    68    67    61    58
# ℹ 307 more rows
# ℹ 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
#   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
#   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
#   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
#   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
#   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>In this dataset, each observation is a song. The first three columns (artist, track and date.entered) are variables that describe the song. Then we have 76 columns (wk1-wk76) that describe the rank of the song in each week. Here, the column names are one variable (the week) and the cell values are another (the rank).</p>
<p>We can use the <code>dplyr</code> function <code>pivot_longer()</code> to change this data into <code>long format</code>.</p>
<p>The command <code>pivot_wider()</code> does the opposite to <code>pivot_longer()</code></p>
<section id="exercise-5.5" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.5">Exercise 5.5</h2>
<p>Use <code>pivot_longer()</code> to tidy this data</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="combining-datasets" class="level1">
<h1>Combining datasets</h1>
<p>Sometimes you may want to analyse information that is in multiple tables.</p>
<p>We will introduce a series of functions for joining tables together.</p>
<p>Two tables can be connected through a pair of keys, within each table.</p>
<p>Every join involves a pair of keys: a primary key and a foreign key. A primary key is a variable or set of variables that uniquely identifies each observation. When more than one variable is needed, the key is called a compound key.</p>
<section id="types-of-join" class="level2">
<h2 class="anchored" data-anchor-id="types-of-join">Types of join</h2>
<p>There are four types of mutating join, which differ in their behaviour when a match is not found.</p>
<ul>
<li><p><code>inner_join(x, y)</code> only includes observations that match in both x and y.</p></li>
<li><p><code>left_join(x, y)</code> includes all observations in <code>x</code>, regardless of whether they match or not. This is the most commonly used join because it ensures that you don’t lose observations from your primary table.</p></li>
<li><p><code>right_join(x, y)</code> includes all observations in <code>y</code>. It’s equivalent to <code>left_join(y, x)</code>, but the columns and rows will be ordered differently.</p></li>
<li><p><code>full_join()</code> includes all observations from x and y.</p></li>
</ul>
<p>The left, right and full joins are collectively know as outer joins. When a row doesn’t match in an outer join, the new variables are filled in with missing values.</p>
</section>
<section id="we-will-illustrate-them-using-a-simple-example" class="level2">
<h2 class="anchored" data-anchor-id="we-will-illustrate-them-using-a-simple-example">We will illustrate them using a simple example:</h2>
<p>First lets make some data:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
      x     y
  &lt;dbl&gt; &lt;int&gt;
1     1     2
2     2     1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">a =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="st">"a"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
      x     a b    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     3    10 a    
2     1    10 a    </code></pre>
</div>
</div>
<p>Now join the two datasets using the different join functions:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(df2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 a    </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 a    
2     2     1    NA &lt;NA&gt; </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 a    
2     3    NA    10 a    </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      x     a b         y
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
1     3    10 a        NA
2     1    10 a         2</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 a    
2     2     1    NA &lt;NA&gt; 
3     3    NA    10 a    </code></pre>
</div>
</div>
<p>What are the differences between the join functions?</p>
</section>
<section id="joining-data-example" class="level2">
<h2 class="anchored" data-anchor-id="joining-data-example">Joining data: Example</h2>
<p>For another example, consider the flights and airlines data from the nycflights13 package.</p>
<p>In one table we have flight information with an abbreviation for carrier, and in another we have a mapping between abbreviations and full names.</p>
<p>You can use a join to add the carrier names to the flight data:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unimportant variables so it's easier to understand the join results.</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(year<span class="sc">:</span>day, hour, origin, dest, tailnum, carrier)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airlines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>As well as x and y, each mutating join takes an argument <code>by</code> that controls which variables are used to match observations in the two tables.</p>
</section>
<section id="specifying-join-keys" class="level2">
<h2 class="anchored" data-anchor-id="specifying-join-keys">Specifying join keys</h2>
<p>By default, left_join() will use all variables that appear in both data frames as the join key, but it doesn’t always work.</p>
<p>For example lets look at some airline data:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, time_hour, origin, dest, tailnum, carrier)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>flights2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 6
    year time_hour           origin dest  tailnum carrier
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA     
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA     
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA     
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6     
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL     
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA     
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6     
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV     
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6     
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA     
# ℹ 336,766 more rows</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>planes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,322 × 9
   tailnum  year type              manufacturer model engines seats speed engine
   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
 1 N10156   2004 Fixed wing multi… EMBRAER      EMB-…       2    55    NA Turbo…
 2 N102UW   1998 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 3 N103US   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 4 N104UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 5 N10575   2002 Fixed wing multi… EMBRAER      EMB-…       2    55    NA Turbo…
 6 N105UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 7 N107US   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 8 N108UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
 9 N109UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
10 N110UW   1999 Fixed wing multi… AIRBUS INDU… A320…       2   182    NA Turbo…
# ℹ 3,312 more rows</code></pre>
</div>
</div>
<p>We are going to try to going flight data to data about types of planes</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 13
    year time_hour           origin dest  tailnum carrier type  manufacturer
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;       
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      &lt;NA&gt;  &lt;NA&gt;        
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      &lt;NA&gt;  &lt;NA&gt;        
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      &lt;NA&gt;  &lt;NA&gt;        
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;  &lt;NA&gt;        
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      &lt;NA&gt;  &lt;NA&gt;        
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      &lt;NA&gt;  &lt;NA&gt;        
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      &lt;NA&gt;  &lt;NA&gt;        
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      &lt;NA&gt;  &lt;NA&gt;        
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      &lt;NA&gt;  &lt;NA&gt;        
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;  &lt;NA&gt;        
# ℹ 336,766 more rows
# ℹ 5 more variables: model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;,
#   engine &lt;chr&gt;</code></pre>
</div>
</div>
<p>We get a lot of missing matches because our join is trying to use tailnum and year as a compound key. Both flights and planes have a year column but they mean different things: <code>flights$year</code> is the year the flight occurred and <code>planes$year</code> is the year the plane was built.</p>
<p>Since these represent different types of data and we might want to keep both, we can be explicit about how to join the two data tables:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes, <span class="fu">join_by</span>(tailnum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 14
   year.x time_hour           origin dest  tailnum carrier year.y type          
    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;         
 1   2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA        1999 Fixed wing mu…
 2   2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA        1998 Fixed wing mu…
 3   2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA        1990 Fixed wing mu…
 4   2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6        2012 Fixed wing mu…
 5   2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL        1991 Fixed wing mu…
 6   2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA        2012 Fixed wing mu…
 7   2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6        2000 Fixed wing mu…
 8   2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV        1998 Fixed wing mu…
 9   2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6        2004 Fixed wing mu…
10   2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA          NA &lt;NA&gt;          
# ℹ 336,766 more rows
# ℹ 6 more variables: manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;,
#   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>
<p>Now by default there is a year.x and year.y coming from the flights and planes data respectively. You can change this using the <code>suffix</code> argument in join or by renaming the columns after the join.</p>
</section>
<section id="exercise-5.6" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.6">Exercise 5.6</h2>
<p>Imagine you’ve found the top 10 most popular destinations using this code:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>top_dest <span class="ot">&lt;-</span> flights2 <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How can you find all flights to those destinations?</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="exercise-5.7" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.7">Exercise 5.7</h2>
<p>What do the tail numbers that don’t have a matching record in planes have in common? (Hint: one variable explains ~90% of the problems.)</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="case_when" class="level1">
<h1>case_when()</h1>
<p>Sometimes you want to add a new variable to your data based on existing variables.</p>
<p>dplyr’s case_when() is inspired by SQL’s CASE statement and provides a flexible way of performing different computations for different conditions. It has a special syntax that unfortunately looks like nothing else you’ll use in the tidyverse. It takes pairs that look like condition ~ output. condition must be a logical vector; when it’s TRUE, output will be used.</p>
<p>This can take the place of if_else() statements.</p>
<p>For example:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>( <span class="co"># make a new variable status based on the flights arrival delay</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(arr_delay)      <span class="sc">~</span> <span class="st">"cancelled"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">30</span>       <span class="sc">~</span> <span class="st">"very early"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">15</span>       <span class="sc">~</span> <span class="st">"early"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;=</span> <span class="dv">15</span>  <span class="sc">~</span> <span class="st">"on time"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="dv">60</span>        <span class="sc">~</span> <span class="st">"late"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="cn">Inf</span>       <span class="sc">~</span> <span class="st">"very late"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 2
   arr_delay status 
       &lt;dbl&gt; &lt;chr&gt;  
 1        11 on time
 2        20 late   
 3        33 late   
 4       -18 early  
 5       -25 early  
 6        12 on time
 7        19 late   
 8       -14 on time
 9        -8 on time
10         8 on time
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<section id="exercise-5.8" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.8">Exercise 5.8</h2>
<p>Write a case_when() statement that uses the month and day columns from flights to label a selection of important US holidays (e.g., New Years Day, 4th of July, Thanksgiving, and Christmas). First create a logical column that is either TRUE or FALSE, and then create a character column that either gives the name of the holiday or is NA.</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="dataset-toxaemia" class="level1">
<h1>Dataset <code>Toxaemia</code></h1>
<p>This dataset is from the <code>vcdExtra</code> package. Two signs of <em>toxaemia</em>, an abnormal condition during pregnancy characterized by high blood pressure (hypertension) and high levels of protein in the urine. If untreated, both the mother and baby are at risk of complications or death. The dataset <code>Toxaemia</code> represents 13384 expectant mothers in Bradford, England in their first pregnancy, who were also classified according to social class and the number of cigarettes smoked per day.</p>
<p>The dataset is a 5 x 3 x 2 x 2 contingency table, with 60 observations on the following 5 variables:</p>
<p><code>class</code> - Social class of mother, a factor with levels: 1, 2, 3, 4, 5</p>
<p><code>smoke</code> - Cigarettes smoked per day during pregnancy, a factor with levels: 0, 1-19, 20+</p>
<p><code>hyper</code> - Hypertension level, a factor with levels: Low, High</p>
<p><code>urea</code> - Protein urea level, a factor with levels: Low, High</p>
<p><code>Freq</code> - frequency in each cell, a numeric vector</p>
<section id="exercise-5.9" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.9">Exercise 5.9</h2>
<p>Obtain relevant graphical displays for this dataset.</p>
<p>Bar charts-</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Toxaemia)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">'identity'</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(urea <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Mosaic type charts</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>tab.data <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> smoke <span class="sc">+</span> hyper <span class="sc">+</span> urea, <span class="at">data=</span>Toxaemia)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tab.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab.data, <span class="at">shade=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(tab.data, <span class="at">shade=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strucplot</span>(tab.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(tab.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The full dataset is a 5 x 3 x 2 x 2 contingency table, with 60 observations on the following 5 variables. For this question we will focus on two categorical variables from this dataset, <code>hyper</code> and <code>urea</code>. This forms a 2 x 2 contingency table since these variables each have two levels.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the data</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tox_2 <span class="ot">&lt;-</span> Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(hyper, urea, Freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the tidyverse way</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>tox_display <span class="ot">&lt;-</span> tox_2 <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> urea, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Freq,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fn =</span> sum) <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>( <span class="at">var =</span> <span class="st">"hyper"</span>) <span class="co"># make values of hyper column row names</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>tox_display</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     High  Low
High  665 2715
Low   589 9415</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># xtabs() </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Two signs of <em>toxaemia</em>, are high blood pressure (hypertension) and high levels of protein in the urine. We want to ask if in our sample of expectant mothers in Bradford, England, is high blood pressure related to high protein levels? If these two variables are associated this may indicate the presence of toxaemia in the sample, if they are independent toxaemia may not be present.</p>
<p>We can test this question using a Chi-squared test.</p>
<p>The null hypothesis of the chi-squared these is that the two variables are independent and the alternative hypothesis is that the two variables are not independent.</p>
<p>Our null hypothesis is that Hypertension level and the Protein urea level in expectant mothers in Bradford, England are independent.</p>
<p>Our alternative hypothesis that Hypertension level and the Protein urea level in expectant mothers in Bradford, England are <em>not</em> independent.</p>
<p>Set our alpha = 0.05</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tox_display)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  tox_display
X-squared = 563.9, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Since our p-value is less than our alpha level we reject the null hypothesis and conclude that the two variables (hyper &amp; urea) are not independent. We found evidence of an association between hypertension levels and protein in urine levels in our sample of expectant mothers in in Bradford, England.</p>
<p>We can see the expected counts</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tox_display)<span class="sc">$</span>expected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         High      Low
High 316.6856 3063.314
Low  937.3144 9066.686</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compared to our observed</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>tox_display</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     High  Low
High  665 2715
Low   589 9415</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total counts 13384</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-5.10" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.10">Exercise 5.10</h2>
<p>The genetic information of an organism is stored in its Deoxyribonucleic acid (DNA). DNA is a double stranded helix made up of four different nucleotides. These nucleotides differ in which of the four bases Adenine (A), Guanine (G), Cytosine (C), or Thymine (T) they contain. Nucleotides combine to form amino acids which are the building blocks of proteins. Simply put, three nucleotides form an amino acid and the specific order of a combination dictates what amino acid is formed. A simple pattern that we may want to detect in a DNA sequence is that of the nucleotide at position <code>i+1</code> based on the nucleotide at position <code>i</code>. The nucleotide positional data collected by a researcher in a particular case is given in the following table:</p>
<table class="table">
<thead>
<tr class="header">
<th><code>i\(i+1)</code></th>
<th>A</th>
<th>C</th>
<th>G</th>
<th>T</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>622</td>
<td>316</td>
<td>328</td>
<td>536</td>
</tr>
<tr class="even">
<td>C</td>
<td>428</td>
<td>262</td>
<td>204</td>
<td>306</td>
</tr>
<tr class="odd">
<td>G</td>
<td>354</td>
<td>294</td>
<td>174</td>
<td>266</td>
</tr>
<tr class="even">
<td>T</td>
<td>396</td>
<td>330</td>
<td>382</td>
<td>648</td>
</tr>
</tbody>
</table>
<p>Perform a test of association and then obtain the symmetric plot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>tabledata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">622</span>, <span class="dv">428</span>, <span class="dv">354</span>, <span class="dv">396</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">316</span>, <span class="dv">262</span>, <span class="dv">294</span>, <span class="dv">330</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">c</span>(<span class="dv">328</span>, <span class="dv">204</span>, <span class="dv">174</span>, <span class="dv">382</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> <span class="fu">c</span>(<span class="dv">536</span>, <span class="dv">306</span>, <span class="dv">266</span>, <span class="dv">648</span>), </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata)<span class="sc">$</span>exp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         A        C        G        T
A 554.8409 370.5104 335.3705 541.2781
C 369.4834 246.7328 223.3322 360.4516
G 334.9983 223.7044 202.4879 326.8094
T 540.6774 361.0523 326.8094 527.4608</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tabledata
X-squared = 153.21, df = 9, p-value &lt; 2.2e-16</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata, <span class="at">simulate.p.value =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with simulated p-value (based on 2000
    replicates)

data:  tabledata
X-squared = 153.21, df = NA, p-value = 0.0004998</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if there is an association we can examine patterns </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corresp</span>(tabledata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>First canonical correlation(s): 0.1443355 

 Row scores:
         A          C          G          T 
-0.1921802 -0.8894387 -1.0334109  1.4453224 

 Column scores:
         A          C          G          T 
-1.1304512 -0.6952989  0.8139424  1.1304056 </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">corresp</span>(tabledata, <span class="at">nf=</span><span class="dv">2</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#or</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">CA</span>(tabledata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>**Results of the Correspondence Analysis (CA)**
The row variable has  4  categories; the column variable has 4 categories
The chi square of independence between the two variables is equal to 153.2146 (p-value =  1.902013e-28 ).
*The results are available in the following objects:

   name              description                   
1  "$eig"            "eigenvalues"                 
2  "$col"            "results for the columns"     
3  "$col$coord"      "coord. for the columns"      
4  "$col$cos2"       "cos2 for the columns"        
5  "$col$contrib"    "contributions of the columns"
6  "$row"            "results for the rows"        
7  "$row$coord"      "coord. for the rows"         
8  "$row$cos2"       "cos2 for the rows"           
9  "$row$contrib"    "contributions of the rows"   
10 "$call"           "summary called parameters"   
11 "$call$marge.col" "weights of the columns"      
12 "$call$marge.row" "weights of the rows"         </code></pre>
</div>
</div>
</section>
</section>
<section id="data-diamonds" class="level1">
<h1>Data <code>diamonds</code></h1>
<p>The <code>diamonds</code> dataset contains the prices and other attributes of almost 54,000 diamonds. Use <code>?diamonds</code> to see information for each variable.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"diamonds"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "carat"   "cut"     "color"   "clarity" "depth"   "table"   "price"  
 [8] "x"       "y"       "z"      </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Some EDA plots</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>cut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>cut))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>cut))<span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>clarity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercise-5.11" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-5.11">Exercise 5.11</h2>
<p>We are interested in whether there is an association between cut and color. Perform a test of association and then obtain the symmetric plot. Write your hypotheses, perform the test, make a decision based on the results of the test, and report a conclusion in context.</p>
<div id="answer">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<ul>
<li>More R code examples are <a href="../exercises/Chap5more.R">here</a></li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../workshops/ws04.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Statistical Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../workshops/ws06.html" class="pagination-link">
        <span class="nav-page-text">Models with a singular predictor</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb78" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tabulated Counts"</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">fig.show=</span><span class="st">"hide"</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summarising data</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>my.tv.data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"../data/tv.csv"</span>, </span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="st">"nfcc"</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`col_types = "nfcc"`</span> stands for <span class="sc">\{</span><span class="in">`numeric`</span>, <span class="in">`factor`</span>, <span class="in">`character`</span>, <span class="in">`character`</span><span class="sc">\}</span>, to match the order of the columns.</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>my.tv.data</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>We often do a summary of a numerical variable for a given categorical variable. For example, we like to see obtain the summary statistics of TV viewing times for various schools. The commands</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show="hide", results='hide'}</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(my.tv.data<span class="sc">$</span>TELETIME, my.tv.data<span class="sc">$</span>SCHOOL, summary)</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>We employed the <span class="in">`by()`</span> command above and instead, we may also use</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a><span class="in">`tapply()`</span> <span class="in">`aggregate()`</span> functions:</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="in">`tapply(my.data$TELETIME, my.data$SCHOOL, summary)`</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a><span class="in">`aggregate(my.data$TELETIME, list(my.data$SCHOOL), summary)`</span></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>A tabulated summary of categorical data is obtained using the <span class="in">`table()`</span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>command. You can also use the tidyverse employing functions like filter, group_by, and summarise.</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show="hide", results='hide'}</span></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>rangitikei <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"../data/rangitikei.csv"</span>,</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="dv">1</span></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>wind <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> <span class="fu">pull</span>(wind)</span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>river <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> <span class="fu">pull</span>(river)</span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wind, river)</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.1 {-}</span></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>Describe the table generated above. What does it tell you?</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.2 {-}</span></span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>Generate a table that summarizes the mean number of vehicles at each level of wind and temperature.</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>What does this table tell you about the data?</span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.3 {-}</span></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>Now repeat this for the average people observed. What does this tell you about the data? </span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-92"><a href="#cb78-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.4 {-}</span></span>
<span id="cb78-93"><a href="#cb78-93" aria-hidden="true" tabindex="-1"></a>Given the two tables you produced describe patterns of people and vehicles at Rangitikei rivers.</span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-98"><a href="#cb78-98" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-99"><a href="#cb78-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-100"><a href="#cb78-100" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tidying data</span></span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>Most real analyses will require at least a little tidying. You’ll begin by figuring out what the underlying variables and observations are. Sometimes this is easy; other times you’ll need to consult with the people who originally generated the data. Next, you’ll pivot your data into a tidy form, with variables in the columns and observations in the rows.</span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a>The <span class="in">`billboard`</span> dataset records the billboard rank of songs in the year 2000:</span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a>billboard</span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-112"><a href="#cb78-112" aria-hidden="true" tabindex="-1"></a>In this dataset, each observation is a song. The first three columns (artist, track and date.entered) are variables that describe the song. Then we have 76 columns (wk1-wk76) that describe the rank of the song in each week. Here, the column names are one variable (the week) and the cell values are another (the rank).</span>
<span id="cb78-113"><a href="#cb78-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-114"><a href="#cb78-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-115"><a href="#cb78-115" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`dplyr`</span> function <span class="in">`pivot_longer()`</span> to change this data into <span class="in">`long format`</span>. </span>
<span id="cb78-116"><a href="#cb78-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-117"><a href="#cb78-117" aria-hidden="true" tabindex="-1"></a>The command <span class="in">`pivot_wider()`</span> does the opposite to <span class="in">`pivot_longer()`</span></span>
<span id="cb78-118"><a href="#cb78-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-119"><a href="#cb78-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.5 {-}</span></span>
<span id="cb78-120"><a href="#cb78-120" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`pivot_longer()`</span> to tidy this data</span>
<span id="cb78-121"><a href="#cb78-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-122"><a href="#cb78-122" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-123"><a href="#cb78-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-126"><a href="#cb78-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-127"><a href="#cb78-127" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-128"><a href="#cb78-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-129"><a href="#cb78-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-130"><a href="#cb78-130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-131"><a href="#cb78-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-132"><a href="#cb78-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-133"><a href="#cb78-133" aria-hidden="true" tabindex="-1"></a><span class="fu"># Combining datasets</span></span>
<span id="cb78-134"><a href="#cb78-134" aria-hidden="true" tabindex="-1"></a>Sometimes you may want to analyse information that is in multiple tables.</span>
<span id="cb78-135"><a href="#cb78-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-136"><a href="#cb78-136" aria-hidden="true" tabindex="-1"></a>We will introduce a series of functions for joining tables together.</span>
<span id="cb78-137"><a href="#cb78-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-138"><a href="#cb78-138" aria-hidden="true" tabindex="-1"></a>Two tables can be connected through a pair of keys, within each table.</span>
<span id="cb78-139"><a href="#cb78-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-140"><a href="#cb78-140" aria-hidden="true" tabindex="-1"></a>Every join involves a pair of keys: a primary key and a foreign key. A primary key is a variable or set of variables that uniquely identifies each observation. When more than one variable is needed, the key is called a compound key. </span>
<span id="cb78-141"><a href="#cb78-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-142"><a href="#cb78-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-143"><a href="#cb78-143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Types of join</span></span>
<span id="cb78-144"><a href="#cb78-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-145"><a href="#cb78-145" aria-hidden="true" tabindex="-1"></a>There are four types of mutating join, which differ in their behaviour when a match is not found.</span>
<span id="cb78-146"><a href="#cb78-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-147"><a href="#cb78-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`inner_join(x, y)`</span> only includes observations that match in both x and y.</span>
<span id="cb78-148"><a href="#cb78-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-149"><a href="#cb78-149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`left_join(x, y)`</span> includes all observations in <span class="in">`x`</span>, regardless of whether they match or not. This is the most commonly used join because it ensures that you don’t lose observations from your primary table.</span>
<span id="cb78-150"><a href="#cb78-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-151"><a href="#cb78-151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`right_join(x, y)`</span> includes all observations in <span class="in">`y`</span>. It’s equivalent to <span class="in">`left_join(y, x)`</span>, but the columns and rows will be ordered differently.</span>
<span id="cb78-152"><a href="#cb78-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-153"><a href="#cb78-153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`full_join()`</span> includes all observations from x and y.</span>
<span id="cb78-154"><a href="#cb78-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-155"><a href="#cb78-155" aria-hidden="true" tabindex="-1"></a>The left, right and full joins are collectively know as outer joins. When a row doesn’t match in an outer join, the new variables are filled in with missing values.</span>
<span id="cb78-156"><a href="#cb78-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-157"><a href="#cb78-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## We will illustrate them using a simple example:</span></span>
<span id="cb78-158"><a href="#cb78-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-159"><a href="#cb78-159" aria-hidden="true" tabindex="-1"></a>First lets make some data:</span>
<span id="cb78-162"><a href="#cb78-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-163"><a href="#cb78-163" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb78-164"><a href="#cb78-164" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb78-165"><a href="#cb78-165" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">a =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="st">"a"</span>)</span>
<span id="cb78-166"><a href="#cb78-166" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb78-167"><a href="#cb78-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-168"><a href="#cb78-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-169"><a href="#cb78-169" aria-hidden="true" tabindex="-1"></a>Now join the two datasets using the different join functions:</span>
<span id="cb78-170"><a href="#cb78-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-173"><a href="#cb78-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-174"><a href="#cb78-174" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(df2) </span>
<span id="cb78-175"><a href="#cb78-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-176"><a href="#cb78-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-179"><a href="#cb78-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-180"><a href="#cb78-180" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df2)</span>
<span id="cb78-181"><a href="#cb78-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-182"><a href="#cb78-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-185"><a href="#cb78-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-186"><a href="#cb78-186" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(df2)</span>
<span id="cb78-187"><a href="#cb78-187" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df1)</span>
<span id="cb78-188"><a href="#cb78-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-189"><a href="#cb78-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-192"><a href="#cb78-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-193"><a href="#cb78-193" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(df2)</span>
<span id="cb78-194"><a href="#cb78-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-195"><a href="#cb78-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-196"><a href="#cb78-196" aria-hidden="true" tabindex="-1"></a>What are the differences between the join functions?</span>
<span id="cb78-197"><a href="#cb78-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-198"><a href="#cb78-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joining data: Example</span></span>
<span id="cb78-199"><a href="#cb78-199" aria-hidden="true" tabindex="-1"></a>For another example, consider the flights and airlines data from the nycflights13 package. </span>
<span id="cb78-200"><a href="#cb78-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-201"><a href="#cb78-201" aria-hidden="true" tabindex="-1"></a>In one table we have flight information with an abbreviation for carrier, and in another we have a mapping between abbreviations and full names. </span>
<span id="cb78-202"><a href="#cb78-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-203"><a href="#cb78-203" aria-hidden="true" tabindex="-1"></a>You can use a join to add the carrier names to the flight data:</span>
<span id="cb78-204"><a href="#cb78-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-205"><a href="#cb78-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb78-206"><a href="#cb78-206" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb78-207"><a href="#cb78-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unimportant variables so it's easier to understand the join results.</span></span>
<span id="cb78-208"><a href="#cb78-208" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(year<span class="sc">:</span>day, hour, origin, dest, tailnum, carrier)</span>
<span id="cb78-209"><a href="#cb78-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-210"><a href="#cb78-210" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> </span>
<span id="cb78-211"><a href="#cb78-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airlines)</span>
<span id="cb78-212"><a href="#cb78-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-213"><a href="#cb78-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-214"><a href="#cb78-214" aria-hidden="true" tabindex="-1"></a>As well as x and y, each mutating join takes an argument <span class="in">`by`</span> that controls which variables are used to match observations in the two tables. </span>
<span id="cb78-215"><a href="#cb78-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-216"><a href="#cb78-216" aria-hidden="true" tabindex="-1"></a><span class="fu">## Specifying join keys</span></span>
<span id="cb78-217"><a href="#cb78-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-218"><a href="#cb78-218" aria-hidden="true" tabindex="-1"></a>By default, left_join() will use all variables that appear in both data frames as the join key, but it doesn’t always work.</span>
<span id="cb78-219"><a href="#cb78-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-220"><a href="#cb78-220" aria-hidden="true" tabindex="-1"></a>For example lets look at some airline data:</span>
<span id="cb78-221"><a href="#cb78-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-224"><a href="#cb78-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-225"><a href="#cb78-225" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<span id="cb78-226"><a href="#cb78-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, time_hour, origin, dest, tailnum, carrier)</span>
<span id="cb78-227"><a href="#cb78-227" aria-hidden="true" tabindex="-1"></a>flights2</span>
<span id="cb78-228"><a href="#cb78-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-229"><a href="#cb78-229" aria-hidden="true" tabindex="-1"></a>planes</span>
<span id="cb78-230"><a href="#cb78-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-231"><a href="#cb78-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-232"><a href="#cb78-232" aria-hidden="true" tabindex="-1"></a>We are going to try to going flight data to data about types of planes</span>
<span id="cb78-233"><a href="#cb78-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-236"><a href="#cb78-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-237"><a href="#cb78-237" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<span id="cb78-238"><a href="#cb78-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes)</span>
<span id="cb78-239"><a href="#cb78-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-240"><a href="#cb78-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-241"><a href="#cb78-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-242"><a href="#cb78-242" aria-hidden="true" tabindex="-1"></a>We get a lot of missing matches because our join is trying to use tailnum and year as a compound key. Both flights and planes have a year column but they mean different things: <span class="in">`flights$year`</span> is the year the flight occurred and <span class="in">`planes$year`</span> is the year the plane was built.</span>
<span id="cb78-243"><a href="#cb78-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-244"><a href="#cb78-244" aria-hidden="true" tabindex="-1"></a>Since these represent different types of data and we might want to keep both, we can be explicit about how to join the two data tables:</span>
<span id="cb78-245"><a href="#cb78-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-248"><a href="#cb78-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-249"><a href="#cb78-249" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<span id="cb78-250"><a href="#cb78-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes, <span class="fu">join_by</span>(tailnum))</span>
<span id="cb78-251"><a href="#cb78-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-252"><a href="#cb78-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-253"><a href="#cb78-253" aria-hidden="true" tabindex="-1"></a>Now by default there is a year.x and year.y coming from the flights and planes data respectively. You can change this using the <span class="in">`suffix`</span> argument in join or by renaming the columns after the join.</span>
<span id="cb78-254"><a href="#cb78-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-255"><a href="#cb78-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.6 {-}</span></span>
<span id="cb78-256"><a href="#cb78-256" aria-hidden="true" tabindex="-1"></a>Imagine you’ve found the top 10 most popular destinations using this code:</span>
<span id="cb78-259"><a href="#cb78-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-260"><a href="#cb78-260" aria-hidden="true" tabindex="-1"></a>top_dest <span class="ot">&lt;-</span> flights2 <span class="sc">|&gt;</span></span>
<span id="cb78-261"><a href="#cb78-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-262"><a href="#cb78-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb78-263"><a href="#cb78-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-264"><a href="#cb78-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-265"><a href="#cb78-265" aria-hidden="true" tabindex="-1"></a>How can you find all flights to those destinations?</span>
<span id="cb78-266"><a href="#cb78-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-267"><a href="#cb78-267" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-268"><a href="#cb78-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-271"><a href="#cb78-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-272"><a href="#cb78-272" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-273"><a href="#cb78-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-274"><a href="#cb78-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-275"><a href="#cb78-275" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-276"><a href="#cb78-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-277"><a href="#cb78-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.7 {-}</span></span>
<span id="cb78-278"><a href="#cb78-278" aria-hidden="true" tabindex="-1"></a>What do the tail numbers that don’t have a matching record in planes have in common? (Hint: one variable explains ~90% of the problems.)</span>
<span id="cb78-279"><a href="#cb78-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-280"><a href="#cb78-280" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-281"><a href="#cb78-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-284"><a href="#cb78-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-285"><a href="#cb78-285" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-286"><a href="#cb78-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-287"><a href="#cb78-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-288"><a href="#cb78-288" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-289"><a href="#cb78-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-290"><a href="#cb78-290" aria-hidden="true" tabindex="-1"></a><span class="fu"># case_when()</span></span>
<span id="cb78-291"><a href="#cb78-291" aria-hidden="true" tabindex="-1"></a>Sometimes you want to add a new variable to your data based on existing variables. </span>
<span id="cb78-292"><a href="#cb78-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-293"><a href="#cb78-293" aria-hidden="true" tabindex="-1"></a>dplyr’s case_when() is inspired by SQL’s CASE statement and provides a flexible way of performing different computations for different conditions. It has a special syntax that unfortunately looks like nothing else you’ll use in the tidyverse. It takes pairs that look like condition ~ output. condition must be a logical vector; when it’s TRUE, output will be used.</span>
<span id="cb78-294"><a href="#cb78-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-295"><a href="#cb78-295" aria-hidden="true" tabindex="-1"></a>This can take the place of if_else() statements.</span>
<span id="cb78-296"><a href="#cb78-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-297"><a href="#cb78-297" aria-hidden="true" tabindex="-1"></a>For example:</span>
<span id="cb78-300"><a href="#cb78-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-301"><a href="#cb78-301" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb78-302"><a href="#cb78-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb78-303"><a href="#cb78-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>( <span class="co"># make a new variable status based on the flights arrival delay</span></span>
<span id="cb78-304"><a href="#cb78-304" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(arr_delay)      <span class="sc">~</span> <span class="st">"cancelled"</span>,</span>
<span id="cb78-305"><a href="#cb78-305" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">30</span>       <span class="sc">~</span> <span class="st">"very early"</span>,</span>
<span id="cb78-306"><a href="#cb78-306" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">15</span>       <span class="sc">~</span> <span class="st">"early"</span>,</span>
<span id="cb78-307"><a href="#cb78-307" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;=</span> <span class="dv">15</span>  <span class="sc">~</span> <span class="st">"on time"</span>,</span>
<span id="cb78-308"><a href="#cb78-308" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="dv">60</span>        <span class="sc">~</span> <span class="st">"late"</span>,</span>
<span id="cb78-309"><a href="#cb78-309" aria-hidden="true" tabindex="-1"></a>      arr_delay <span class="sc">&lt;</span> <span class="cn">Inf</span>       <span class="sc">~</span> <span class="st">"very late"</span>,</span>
<span id="cb78-310"><a href="#cb78-310" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb78-311"><a href="#cb78-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb78-312"><a href="#cb78-312" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-313"><a href="#cb78-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-314"><a href="#cb78-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-315"><a href="#cb78-315" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.8 {-}</span></span>
<span id="cb78-316"><a href="#cb78-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-317"><a href="#cb78-317" aria-hidden="true" tabindex="-1"></a>Write a case_when() statement that uses the month and day columns from flights to label a selection of important US holidays (e.g., New Years Day, 4th of July, Thanksgiving, and Christmas). First create a logical column that is either TRUE or FALSE, and then create a character column that either gives the name of the holiday or is NA.</span>
<span id="cb78-318"><a href="#cb78-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-319"><a href="#cb78-319" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-320"><a href="#cb78-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-323"><a href="#cb78-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-324"><a href="#cb78-324" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-325"><a href="#cb78-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-326"><a href="#cb78-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-327"><a href="#cb78-327" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-328"><a href="#cb78-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-329"><a href="#cb78-329" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset `Toxaemia`</span></span>
<span id="cb78-330"><a href="#cb78-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-331"><a href="#cb78-331" aria-hidden="true" tabindex="-1"></a>This dataset is from the <span class="in">`vcdExtra`</span> package. Two signs of *toxaemia*, an abnormal condition during pregnancy characterized by high blood pressure (hypertension) and high levels of protein in the urine. If untreated, both the mother and baby are at risk of complications or death. The dataset <span class="in">`Toxaemia`</span> represents 13384 expectant mothers in Bradford, England in their first pregnancy, who were also classified according to social class and the number of cigarettes smoked per day.</span>
<span id="cb78-332"><a href="#cb78-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-333"><a href="#cb78-333" aria-hidden="true" tabindex="-1"></a>The dataset is a 5 x 3 x 2 x 2 contingency table, with 60 observations on the following 5 variables:</span>
<span id="cb78-334"><a href="#cb78-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-335"><a href="#cb78-335" aria-hidden="true" tabindex="-1"></a><span class="in">`class`</span> - Social class of mother, a factor with levels: 1, 2, 3, 4, 5</span>
<span id="cb78-336"><a href="#cb78-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-337"><a href="#cb78-337" aria-hidden="true" tabindex="-1"></a><span class="in">`smoke`</span> - Cigarettes smoked per day during pregnancy, a factor with levels: 0, 1-19, 20+</span>
<span id="cb78-338"><a href="#cb78-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-339"><a href="#cb78-339" aria-hidden="true" tabindex="-1"></a><span class="in">`hyper`</span> - Hypertension level, a factor with levels: Low, High</span>
<span id="cb78-340"><a href="#cb78-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-341"><a href="#cb78-341" aria-hidden="true" tabindex="-1"></a><span class="in">`urea`</span> - Protein urea level, a factor with levels: Low, High</span>
<span id="cb78-342"><a href="#cb78-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-343"><a href="#cb78-343" aria-hidden="true" tabindex="-1"></a><span class="in">`Freq`</span> - frequency in each cell, a numeric vector</span>
<span id="cb78-344"><a href="#cb78-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-345"><a href="#cb78-345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.9 {-}</span></span>
<span id="cb78-346"><a href="#cb78-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-347"><a href="#cb78-347" aria-hidden="true" tabindex="-1"></a>Obtain relevant graphical displays for this dataset.</span>
<span id="cb78-348"><a href="#cb78-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-349"><a href="#cb78-349" aria-hidden="true" tabindex="-1"></a>Bar charts-</span>
<span id="cb78-350"><a href="#cb78-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-353"><a href="#cb78-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-354"><a href="#cb78-354" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb78-355"><a href="#cb78-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-356"><a href="#cb78-356" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb78-357"><a href="#cb78-357" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Toxaemia)</span>
<span id="cb78-358"><a href="#cb78-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-359"><a href="#cb78-359" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb78-360"><a href="#cb78-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb78-361"><a href="#cb78-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb78-362"><a href="#cb78-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>)</span>
<span id="cb78-363"><a href="#cb78-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-364"><a href="#cb78-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-367"><a href="#cb78-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-368"><a href="#cb78-368" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb78-369"><a href="#cb78-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb78-370"><a href="#cb78-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb78-371"><a href="#cb78-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>, </span>
<span id="cb78-372"><a href="#cb78-372" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span></span>
<span id="cb78-373"><a href="#cb78-373" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb78-374"><a href="#cb78-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-375"><a href="#cb78-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-376"><a href="#cb78-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-379"><a href="#cb78-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-380"><a href="#cb78-380" aria-hidden="true" tabindex="-1"></a>Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb78-381"><a href="#cb78-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb78-382"><a href="#cb78-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>smoke, <span class="at">y=</span>Freq, <span class="at">fill=</span>hyper) <span class="sc">+</span> </span>
<span id="cb78-383"><a href="#cb78-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">'identity'</span>, </span>
<span id="cb78-384"><a href="#cb78-384" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb78-385"><a href="#cb78-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(urea <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb78-386"><a href="#cb78-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-387"><a href="#cb78-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-388"><a href="#cb78-388" aria-hidden="true" tabindex="-1"></a>Mosaic type charts</span>
<span id="cb78-389"><a href="#cb78-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-390"><a href="#cb78-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show='hide', results='hide'}</span></span>
<span id="cb78-391"><a href="#cb78-391" aria-hidden="true" tabindex="-1"></a>tab.data <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> smoke <span class="sc">+</span> hyper <span class="sc">+</span> urea, <span class="at">data=</span>Toxaemia)</span>
<span id="cb78-392"><a href="#cb78-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-393"><a href="#cb78-393" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tab.data)</span>
<span id="cb78-394"><a href="#cb78-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-395"><a href="#cb78-395" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab.data, <span class="at">shade=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-396"><a href="#cb78-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-397"><a href="#cb78-397" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(tab.data, <span class="at">shade=</span><span class="cn">TRUE</span>) </span>
<span id="cb78-398"><a href="#cb78-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-399"><a href="#cb78-399" aria-hidden="true" tabindex="-1"></a><span class="fu">strucplot</span>(tab.data)</span>
<span id="cb78-400"><a href="#cb78-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-401"><a href="#cb78-401" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(tab.data)</span>
<span id="cb78-402"><a href="#cb78-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-403"><a href="#cb78-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-404"><a href="#cb78-404" aria-hidden="true" tabindex="-1"></a>The full dataset is a 5 x 3 x 2 x 2 contingency table, with 60 observations on the following 5 variables.</span>
<span id="cb78-405"><a href="#cb78-405" aria-hidden="true" tabindex="-1"></a>For this question we will focus on two categorical variables from this dataset, <span class="in">`hyper`</span> and <span class="in">`urea`</span>. This forms a 2 x 2 contingency table since these variables each have two levels. </span>
<span id="cb78-406"><a href="#cb78-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-409"><a href="#cb78-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-410"><a href="#cb78-410" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the data</span></span>
<span id="cb78-411"><a href="#cb78-411" aria-hidden="true" tabindex="-1"></a>tox_2 <span class="ot">&lt;-</span> Toxaemia <span class="sc">|&gt;</span> </span>
<span id="cb78-412"><a href="#cb78-412" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(hyper, urea, Freq)</span>
<span id="cb78-413"><a href="#cb78-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-414"><a href="#cb78-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-415"><a href="#cb78-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-418"><a href="#cb78-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-419"><a href="#cb78-419" aria-hidden="true" tabindex="-1"></a><span class="co"># the tidyverse way</span></span>
<span id="cb78-420"><a href="#cb78-420" aria-hidden="true" tabindex="-1"></a>tox_display <span class="ot">&lt;-</span> tox_2 <span class="sc">|&gt;</span> </span>
<span id="cb78-421"><a href="#cb78-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> urea, </span>
<span id="cb78-422"><a href="#cb78-422" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Freq,</span>
<span id="cb78-423"><a href="#cb78-423" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fn =</span> sum) <span class="sc">|&gt;</span></span>
<span id="cb78-424"><a href="#cb78-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>( <span class="at">var =</span> <span class="st">"hyper"</span>) <span class="co"># make values of hyper column row names</span></span>
<span id="cb78-425"><a href="#cb78-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-426"><a href="#cb78-426" aria-hidden="true" tabindex="-1"></a>tox_display</span>
<span id="cb78-427"><a href="#cb78-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-428"><a href="#cb78-428" aria-hidden="true" tabindex="-1"></a><span class="co"># xtabs() </span></span>
<span id="cb78-429"><a href="#cb78-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-430"><a href="#cb78-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-431"><a href="#cb78-431" aria-hidden="true" tabindex="-1"></a>Two signs of *toxaemia*, are high blood pressure (hypertension) and high levels of protein in the urine. We want to ask if in our sample of expectant mothers in Bradford, England, is high blood pressure related to high protein levels? If these two variables are associated this may indicate the presence of toxaemia in the sample, if they are independent toxaemia may not be present. </span>
<span id="cb78-432"><a href="#cb78-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-433"><a href="#cb78-433" aria-hidden="true" tabindex="-1"></a>We can test this question using a Chi-squared test.</span>
<span id="cb78-434"><a href="#cb78-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-435"><a href="#cb78-435" aria-hidden="true" tabindex="-1"></a>The null hypothesis of the chi-squared these is that the two variables are independent and the alternative hypothesis is that the two variables are not independent.</span>
<span id="cb78-436"><a href="#cb78-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-437"><a href="#cb78-437" aria-hidden="true" tabindex="-1"></a>Our null hypothesis is that Hypertension level and the Protein urea level in expectant mothers in Bradford, England are independent. </span>
<span id="cb78-438"><a href="#cb78-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-439"><a href="#cb78-439" aria-hidden="true" tabindex="-1"></a>Our alternative hypothesis that Hypertension level and the Protein urea level in expectant mothers in Bradford, England are *not* independent. </span>
<span id="cb78-440"><a href="#cb78-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-441"><a href="#cb78-441" aria-hidden="true" tabindex="-1"></a>Set our alpha = 0.05</span>
<span id="cb78-444"><a href="#cb78-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-445"><a href="#cb78-445" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tox_display)</span>
<span id="cb78-446"><a href="#cb78-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-447"><a href="#cb78-447" aria-hidden="true" tabindex="-1"></a>Since our p-value is less than our alpha level we reject the null hypothesis and conclude that the two variables (hyper &amp; urea) are not independent. We found evidence of an association between hypertension levels and protein in urine levels in our sample of expectant mothers in in Bradford, England.</span>
<span id="cb78-448"><a href="#cb78-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-449"><a href="#cb78-449" aria-hidden="true" tabindex="-1"></a>We can see the expected counts</span>
<span id="cb78-452"><a href="#cb78-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-453"><a href="#cb78-453" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tox_display)<span class="sc">$</span>expected</span>
<span id="cb78-454"><a href="#cb78-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-455"><a href="#cb78-455" aria-hidden="true" tabindex="-1"></a><span class="co"># compared to our observed</span></span>
<span id="cb78-456"><a href="#cb78-456" aria-hidden="true" tabindex="-1"></a>tox_display</span>
<span id="cb78-457"><a href="#cb78-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-458"><a href="#cb78-458" aria-hidden="true" tabindex="-1"></a><span class="co"># total counts 13384</span></span>
<span id="cb78-459"><a href="#cb78-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-460"><a href="#cb78-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-461"><a href="#cb78-461" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.10 {-}</span></span>
<span id="cb78-462"><a href="#cb78-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-463"><a href="#cb78-463" aria-hidden="true" tabindex="-1"></a>The genetic information of an organism is stored in its Deoxyribonucleic acid (DNA). DNA is a double stranded helix made up of four different nucleotides. These nucleotides differ in which of the four bases Adenine (A), Guanine (G), Cytosine (C), or Thymine (T) they contain. Nucleotides combine to form amino acids which are the building blocks of proteins. Simply put, three nucleotides form an amino acid and the specific order of a combination dictates what amino acid is formed. A simple pattern that we may want to detect in a DNA sequence is that of the nucleotide at position <span class="in">`i+1`</span> based on the nucleotide at position <span class="in">`i`</span>. The nucleotide positional data collected by a researcher in a particular case is given in the following table:</span>
<span id="cb78-464"><a href="#cb78-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-465"><a href="#cb78-465" aria-hidden="true" tabindex="-1"></a>| <span class="in">`i\(i+1)`</span> | A   | C   | G   | T   |</span>
<span id="cb78-466"><a href="#cb78-466" aria-hidden="true" tabindex="-1"></a>|-----------|-----|-----|-----|-----|</span>
<span id="cb78-467"><a href="#cb78-467" aria-hidden="true" tabindex="-1"></a>| A         | 622 | 316 | 328 | 536 |</span>
<span id="cb78-468"><a href="#cb78-468" aria-hidden="true" tabindex="-1"></a>| C         | 428 | 262 | 204 | 306 |</span>
<span id="cb78-469"><a href="#cb78-469" aria-hidden="true" tabindex="-1"></a>| G         | 354 | 294 | 174 | 266 |</span>
<span id="cb78-470"><a href="#cb78-470" aria-hidden="true" tabindex="-1"></a>| T         | 396 | 330 | 382 | 648 |</span>
<span id="cb78-471"><a href="#cb78-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-472"><a href="#cb78-472" aria-hidden="true" tabindex="-1"></a>Perform a test of association and then obtain the symmetric plot.</span>
<span id="cb78-473"><a href="#cb78-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-476"><a href="#cb78-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-477"><a href="#cb78-477" aria-hidden="true" tabindex="-1"></a>tabledata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-478"><a href="#cb78-478" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">622</span>, <span class="dv">428</span>, <span class="dv">354</span>, <span class="dv">396</span>),</span>
<span id="cb78-479"><a href="#cb78-479" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">316</span>, <span class="dv">262</span>, <span class="dv">294</span>, <span class="dv">330</span>),</span>
<span id="cb78-480"><a href="#cb78-480" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="fu">c</span>(<span class="dv">328</span>, <span class="dv">204</span>, <span class="dv">174</span>, <span class="dv">382</span>),</span>
<span id="cb78-481"><a href="#cb78-481" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> <span class="fu">c</span>(<span class="dv">536</span>, <span class="dv">306</span>, <span class="dv">266</span>, <span class="dv">648</span>), </span>
<span id="cb78-482"><a href="#cb78-482" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>)</span>
<span id="cb78-483"><a href="#cb78-483" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-484"><a href="#cb78-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-485"><a href="#cb78-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-488"><a href="#cb78-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-489"><a href="#cb78-489" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata)<span class="sc">$</span>exp</span>
<span id="cb78-490"><a href="#cb78-490" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata)</span>
<span id="cb78-491"><a href="#cb78-491" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tabledata, <span class="at">simulate.p.value =</span> T)</span>
<span id="cb78-492"><a href="#cb78-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-493"><a href="#cb78-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-494"><a href="#cb78-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-497"><a href="#cb78-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-498"><a href="#cb78-498" aria-hidden="true" tabindex="-1"></a><span class="co"># if there is an association we can examine patterns </span></span>
<span id="cb78-499"><a href="#cb78-499" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb78-500"><a href="#cb78-500" aria-hidden="true" tabindex="-1"></a><span class="fu">corresp</span>(tabledata)</span>
<span id="cb78-501"><a href="#cb78-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-502"><a href="#cb78-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-503"><a href="#cb78-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-506"><a href="#cb78-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-507"><a href="#cb78-507" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">corresp</span>(tabledata, <span class="at">nf=</span><span class="dv">2</span>))</span>
<span id="cb78-508"><a href="#cb78-508" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)</span>
<span id="cb78-509"><a href="#cb78-509" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb78-510"><a href="#cb78-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-511"><a href="#cb78-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-514"><a href="#cb78-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-515"><a href="#cb78-515" aria-hidden="true" tabindex="-1"></a><span class="co">#or</span></span>
<span id="cb78-516"><a href="#cb78-516" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb78-517"><a href="#cb78-517" aria-hidden="true" tabindex="-1"></a><span class="fu">CA</span>(tabledata)</span>
<span id="cb78-518"><a href="#cb78-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-519"><a href="#cb78-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-520"><a href="#cb78-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-521"><a href="#cb78-521" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data `diamonds`</span></span>
<span id="cb78-522"><a href="#cb78-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-523"><a href="#cb78-523" aria-hidden="true" tabindex="-1"></a>The <span class="in">`diamonds`</span> dataset contains the prices and other attributes of almost 54,000 diamonds. Use <span class="in">`?diamonds`</span> to see information for each variable.</span>
<span id="cb78-524"><a href="#cb78-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-525"><a href="#cb78-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-528"><a href="#cb78-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-529"><a href="#cb78-529" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"diamonds"</span>)</span>
<span id="cb78-530"><a href="#cb78-530" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds)</span>
<span id="cb78-531"><a href="#cb78-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-532"><a href="#cb78-532" aria-hidden="true" tabindex="-1"></a><span class="do">## Some EDA plots</span></span>
<span id="cb78-533"><a href="#cb78-533" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>cut)</span>
<span id="cb78-534"><a href="#cb78-534" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>cut))</span>
<span id="cb78-535"><a href="#cb78-535" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>cut))<span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>clarity)</span>
<span id="cb78-536"><a href="#cb78-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-537"><a href="#cb78-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-538"><a href="#cb78-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-539"><a href="#cb78-539" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 5.11 {-}</span></span>
<span id="cb78-540"><a href="#cb78-540" aria-hidden="true" tabindex="-1"></a>We are interested in whether there is an association between cut and color. Perform a test of association and then obtain the symmetric plot. Write your hypotheses, perform the test, make a decision based on the results of the test, and report a conclusion in context.</span>
<span id="cb78-541"><a href="#cb78-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-542"><a href="#cb78-542" aria-hidden="true" tabindex="-1"></a>::: {#answer}</span>
<span id="cb78-543"><a href="#cb78-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-546"><a href="#cb78-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-547"><a href="#cb78-547" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span>
<span id="cb78-548"><a href="#cb78-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-549"><a href="#cb78-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-550"><a href="#cb78-550" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-551"><a href="#cb78-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-552"><a href="#cb78-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-553"><a href="#cb78-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-554"><a href="#cb78-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-555"><a href="#cb78-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-556"><a href="#cb78-556" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>More R code examples are  <span class="co">[</span><span class="ot">here</span><span class="co">](../exercises/Chap5more.R)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>