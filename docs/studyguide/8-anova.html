<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>161250 Data Analysis - Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../studyguide/7-multiple.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">161250 Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../studyguide/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Study Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/ws01.html" rel="" target="">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Extra Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-code">    
        <li>
    <a class="dropdown-item" href="../exercises/Chap2more.R" rel="" target="">
 <span class="dropdown-text">Ex2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap3more.R" rel="" target="">
 <span class="dropdown-text">Ex3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap4more.R" rel="" target="">
 <span class="dropdown-text">Ex4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap5more.R" rel="" target="">
 <span class="dropdown-text">Ex5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap6more.R" rel="" target="">
 <span class="dropdown-text">Ex6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap7more.R" rel="" target="">
 <span class="dropdown-text">Ex7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap8more.R" rel="" target="">
 <span class="dropdown-text">Ex8</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../studyguide/index.html">Study Guide</a></li><li class="breadcrumb-item"><a href="../studyguide/8-anova.html">Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../studyguide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Study Guide</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/1-data-collection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Data Collection and Quality Issues</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/2-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Exploratory Data Analysis (EDA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/3-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Probability Concepts and Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/4-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Statistical Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/5-tabulated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Tabulated Counts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/6-single.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Models with a Single Continuous Predictor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/7-multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7: Models with Multiple Continuous Predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/8-anova.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-analysis-of-variance-anova" id="toc-introduction-to-analysis-of-variance-anova" class="nav-link active" data-scroll-target="#introduction-to-analysis-of-variance-anova">Introduction to Analysis of Variance (ANOVA)</a></li>
  <li><a href="#one-way-anova" id="toc-one-way-anova" class="nav-link" data-scroll-target="#one-way-anova">One Way ANOVA</a></li>
  <li><a href="#assumptions-and-transformations" id="toc-assumptions-and-transformations" class="nav-link" data-scroll-target="#assumptions-and-transformations">Assumptions and Transformations</a></li>
  <li><a href="#two-way-anova" id="toc-two-way-anova" class="nav-link" data-scroll-target="#two-way-anova">Two-Way ANOVA</a></li>
  <li><a href="#two-way-anova-with-interaction" id="toc-two-way-anova-with-interaction" class="nav-link" data-scroll-target="#two-way-anova-with-interaction">Two Way ANOVA with Interaction</a></li>
  <li><a href="#indicator-variables" id="toc-indicator-variables" class="nav-link" data-scroll-target="#indicator-variables">Indicator Variables</a>
  <ul class="collapse">
  <li><a href="#another-example" id="toc-another-example" class="nav-link" data-scroll-target="#another-example">Another example</a></li>
  </ul></li>
  <li><a href="#analysis-of-covariance-ancova" id="toc-analysis-of-covariance-ancova" class="nav-link" data-scroll-target="#analysis-of-covariance-ancova">Analysis of Covariance (ANCOVA)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="8-anova.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p>“<em>To consult a statistician after an experiment is finished is often merely to ask him to conduct a post mortem examination. He can perhaps say what the experiment died of.</em>” – Sir RA Fisher</p>
</blockquote>
<section id="introduction-to-analysis-of-variance-anova" class="level1">
<h1>Introduction to Analysis of Variance (ANOVA)</h1>
<p>We consider <strong>ANOVA models</strong> for data which have, in many cases, been collected using experimental designs. The model provides a quantitative assessment of the treatment effects. The first model we shall consider is the <strong>One-Way ANOVA</strong> model. The data for these models are used when only one set of treatments is to be compared. Here the set of treatments is called a factor and the various treatments are referred to as the factor levels.</p>
<p>A One-Way ANOVA model is expressed in terms of an overall effect (the overall response mean) and a treatment effect (the average effect for a particular treatment or level on the response variable). The model has the form</p>
<p><strong>fit = overall effect + treatment effect</strong>.</p>
<p>The second model we shall consider later is a Two-Way Model. The experiments used to produce these data may be from two sets of treatments (that is, two factors). Again we refer to the treatments for each factor as the levels for each factor. We shall assume that the data are fully balanced in that the same number of observations is obtained for each combination of factor levels. For instance, if factor 1 has 3 levels and factor 2 has 2 levels then the total number of observations must be a multiple of 6.</p>
<p>The computer output for an ANOVA often includes the mean response for each combination of factor levels. These means are often represented as a table with the rows corresponding to the levels of the first factor and the columns corresponding to the levels of the second factor. For convenience we shall refer to the levels of factor 1 as the <code>rows</code> and we shall refer to the levels of factor 2 as the <code>columns</code>. There are two possible Two-Way ANOVA models. The first model assumes that the effects of factors 1 and 2 are independent. The appropriate model is expressed in terms of the overall effect (overall mean), the row effect and the column effect. That is</p>
<p><strong>fit = overall effect + row effect + column effect</strong>.</p>
<p>The second Two-Way ANOVA allows for an <strong>interaction</strong> between the row and column effects. That is</p>
<p><strong>fit = overall effect + row effect + column effect + interaction effect</strong>.</p>
<p>Finally we shall consider an Analysis of Covariance (ANCOVA) model. In these experiments paired (<span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>) measurements are obtained for each observation. <span class="math inline">\(X\)</span> is the explanatory variable and <span class="math inline">\(Y\)</span> is the response variable. When there is only one experimental factor the following model is applied,</p>
<p><strong>fit = overall effect + treatment effect +</strong> <span class="math inline">\(X\)</span>-effect.</p>
<p>ANCOVA models are, in essence, a mixture of regression and ANOVA models. For all the above models</p>
<p><strong>observed = fitted + residual</strong>.</p>
<p>The residuals are used to test the adequacy of the model fitted as in regression.</p>
</section>
<section id="one-way-anova" class="level1">
<h1>One Way ANOVA</h1>
<p>As part of a multi-lab study, four fabrics were tested for flammability at the National Bureau of Standards. The burn times in seconds were recorded after a paper tab was ignited on the hem of each fabric. The experimental data are presented below (<a href="#tbl-fabricdata">Table&nbsp;1</a>; taken from p.496 of <span class="citation" data-cites="bhattacharyya1977">Bhattacharyya and Johnson (<a href="#ref-bhattacharyya1977" role="doc-biblioref">1977</a>)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/fabric.RData"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"fabric.RData"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"fabric.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dtf <span class="ot">&lt;-</span> fabric <span class="sc">|&gt;</span> <span class="fu">unstack</span>(burntime <span class="sc">~</span> Fabric)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dtf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-fabricdata" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Fabric Burntime data</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Fabric.1</th>
<th style="text-align: right;">Fabric.2</th>
<th style="text-align: right;">Fabric.3</th>
<th style="text-align: right;">Fabric.4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">11.2</td>
<td style="text-align: right;">11.8</td>
<td style="text-align: right;">14.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">16.2</td>
<td style="text-align: right;">11.4</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">10.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.5</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">12.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">17.4</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">10.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">10.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that the response variable <span class="math inline">\(Y\)</span> is quantitative in that they are measurements of burn times in seconds. The five measurements for each fabric are assumed to be a random sample for all possible burn times for that fabric so that the five readings are true replications.</p>
<p>In this example, each of the four fabrics is replicated the same number of times, namely five, so the experiment is said to be “balanced”. The approaches explained in this section on One-Way ANOVA can easily be extended to unbalanced experiments. This is not the case for Two-Way ANOVA.</p>
<p>Using the same approach as in Chapter 4, we could compare any two fabrics by a <span class="math inline">\(t\)</span>-test or by considering the confidence interval for the difference in means. With 4 fabrics, there are 6 comparisons which could be made (Fabric 1 vs.&nbsp;Fabric 2 etc.).</p>
<p>How should we proceed? Should we test each of these 6 differences in means? Unfortunately, there is a problem in this procedure. One tends to find too many significant differences between means. There are two reasons for this:</p>
<ol type="1">
<li><p>The comparisons are not independent. If one fabric mean happened to be unduly large by chance, every comparison involving that mean would tend to yield a significant (say, at the 5% level) difference with each of the other means.</p></li>
<li><p>For one comparison, the 95% confidence level (5% level of the <span class="math inline">\(t\)</span>-test) would yield a significant difference between the means in about 5% of samples of these two fabrics <strong>even if the fabrics responded equally to the flammability test.</strong> The more comparisons that are made on pairs of fabrics, the more likely it is that sooner or later some of the difference will appear significant at the 5% level, even when there is no difference between the fabrics. This is true for any statistical test and not just <span class="math inline">\(t\)</span>-tests. If a number of tests are carried out on the same set of data, eventually some false significant results will be obtained. It has been suggested that if you torture data enough, it will confess, whether or not it is guilty.</p></li>
</ol>
<p>One way out of this dilemma is to carry out a single test, an <span class="math inline">\(F\)</span>-test, which can be thought of as giving an average value of the comparisons between treatments. The way it does this should become clear in the next few sections.</p>
<p>The burn times are plotted in <a href="#fig-fabricstrip">Figure&nbsp;1</a> in which the scale on the horizontal axis indicates the number of the fabric. The times for fabrics 2 and 4 appear fairly similar to the times for fabric 3. But the burn times for fabric 1 appear to be higher.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Fabric, <span class="at">y =</span> burntime) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(burntime)), <span class="at">alpha =</span> .<span class="dv">7</span>)  <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">7</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">mean</span>(fabric<span class="sc">$</span>burntime) <span class="sc">+</span> <span class="fl">0.3</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Overall mean"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha=</span>.<span class="dv">7</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fabricstrip" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-fabricstrip-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Burn time vs fabric Id</figcaption>
</figure>
</div>
</div>
</div>
<p>Let <span class="math inline">\(y_{ij}\)</span> be the <span class="math inline">\(j^{th}\)</span> observed value in the <span class="math inline">\(i^{th}\)</span> treatment (fabric type in the above example); <span class="math inline">\(\bar{y}_{i}\)</span> be the mean of the <span class="math inline">\(i^{th}\)</span> treatment; <span class="math inline">\(\bar{y}\)</span> be the overall mean of all the observations; <span class="math inline">\(k\)</span> is the total number of treatments being compared. As usual the observed data can be modelled by</p>
<p>observed = fit + residual.</p>
<p>However, the appropriate model for the fit is different for these data. For a treatment <span class="math inline">\(i\)</span> observation</p>
<p>fit =<span class="math inline">\(\bar{y}_{i}\)</span>, the mean of the <span class="math inline">\(i^{th}\)</span> treatment</p>
<p>or, adding and subtracting <span class="math inline">\(\bar{y}\)</span> ,</p>
<p>fit =<span class="math inline">\(\bar{y} + (\bar{y}_{i} - \bar{y})\)</span> =overall mean + treatment effect</p>
<p>Clearly, residual = observed - fit; so the residual for <span class="math inline">\(y_{ij}\)</span> is equal to</p>
<p>residual = <span class="math inline">\(y_{ij}-(\bar{y} + (\bar{y}_{i}- \bar{y})) = y_{ij} - \bar{y}_{i}\)</span></p>
<p>Since observed = fit + residual, we have <span class="math display">\[y_{ij} = \bar{y} + (\bar{y}_{i} -\bar{y}) + (y_{ij} - \bar{y}_{i} )\]</span></p>
<p>observed = overall mean + treatment effect + residual.</p>
<p>That is <span class="math display">\[y_{ij} = m + t_{i} + e_{ij}\]</span> where the three terms on the right are:</p>
<p><span class="math inline">\(m\)</span> =: the overall mean, <span class="math inline">\(\bar{y}\)</span>,</p>
<p><span class="math inline">\(t_{i}\)</span> =: the treatment effect, <strong>adjusted</strong> for the mean. i.e.&nbsp;(<span class="math inline">\(\bar{y}_{i} -\bar{y}\)</span>),</p>
<p><span class="math inline">\(e_{ij}\)</span> =: the residual or error, (<span class="math inline">\(y_{ij}\)</span>- <span class="math inline">\(\bar{y}_{i}\)</span>). See <a href="#fig-6-3">Figure&nbsp;2</a> (produced manually) for an illustration of the treatment effect for the fabric data.</p>
<div id="fig-6-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/6-3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Explanation of factor effects</figcaption>
</figure>
</div>
<p>From the above model we obtain the equation <span class="math display">\[(y_{ij}-\bar{y}) = (\bar{y}_{i}-\bar{y}) + (y_{ij}- \bar{y}_{i} ).\]</span> It can be shown that the sums of squares follow from this equation if each term is squared and then summed over <strong>all</strong> the values in the sample. Note, the summation is over both <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[\sum _{i,j}\left(y_{ij} -\bar{y}\right)^{2}   = \sum _{i,j}\left(\bar{y}_{i} -\bar{y}\right)^{2}   + \sum _{i,j}\left(y_{ij} -\bar{y}_{i} \right)^{2}\]</span></p>
<p>That is, SS TOTAL = SS FACTOR + SS ERROR.</p>
<p>Mean squares (MeanSq or MS) are obtained by dividing the sums of squares (SS) by their respective degrees of freedom (df), as shown below:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">SS</th>
<th style="text-align: left;">df</th>
<th style="text-align: center;">MeanSq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FACTOR</td>
<td style="text-align: left;">k-1</td>
<td style="text-align: center;">FACTOR SS/(n-1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ERROR</td>
<td style="text-align: left;">n-k</td>
<td style="text-align: center;">ERROR SS/(n-k</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TOTAL</td>
<td style="text-align: left;">n-1</td>
<td style="text-align: center;">TOTAL SS/(n-1)</td>
</tr>
</tbody>
</table>
<p>Finally, the <span class="math inline">\(F\)</span> statistic for the FACTOR is obtained by dividing the FACTOR MeanSq by the ERROR MeanSq. The associated degrees of freedom are <span class="math inline">\(k-1\)</span> for the numerator and <span class="math inline">\(n-k\)</span> for the denominator. We display the SS, MS in the form of a table called the one-way ANOVA table.</p>
<p>For fabric data, the one-way ANOVA <code>R</code> output is shown below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>oneway.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oneway.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Fabric       3 120.50   40.17   13.89 0.000102 ***
Residuals   16  46.26    2.89                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>If there is no real difference between the fabrics, we would expect the <span class="math inline">\(F\)</span> Statistic to be about 1. If there is a real difference, we would expect the <span class="math inline">\(F\)</span> statistics to be larger than 1. From tables, the 95th percentile of the <span class="math inline">\(F\)</span> statistic with 3 and 16 degrees of freedom is 3.24. As our value of 13.89 is more than this, the <span class="math inline">\(F\)</span> statistic is significant at the 5% level. This is also confirmed by the <span class="math inline">\(p\)</span>-value, which is 0.000. So there is a significant difference between the mean burning times of the fabrics. This obviously doesn’t mean that <strong>all</strong> the fabrics differ significantly from each other. It means that there is a significant difference for <strong>at least</strong> one pair of fabrics.</p>
<p>The individual confidence intervals for the fabric means may be obtained using the pooled error estimate S of 1.7 (the square root of MS Error of 2.891). For example, the confidence interval for the mean burn time of fabric 1 is <span class="math inline">\(mean \pm t_{error~df, 0.975}\times S\)</span> or <span class="math inline">\(16.78\pm 2.12\times 1.7\)</span> or (15.17, 18.39).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(burntime),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(burntime),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci =</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> se</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Fabric, <span class="at">y =</span> mean, <span class="at">group =</span> <span class="fu">factor</span>(<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> ci, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> mean <span class="sc">+</span> ci), </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> .<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ciplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-ciplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: CIs using pooled SD</figcaption>
</figure>
</div>
</div>
</div>
<p>The 95% confidence intervals shown in <a href="#fig-ciplot">Figure&nbsp;3</a> indicate that fabric 1 differs significantly from the other three fabrics. Note that each CI in the above figure has individual Type I error rate, which makes the overall comparison difficult.</p>
<p>For comparing many treatments, we may perform multiple comparison tests. The following <code>R</code> output shows the adjusted confidence intervals for the difference in fabric means.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(oneway.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = burntime ~ Fabric, data = fabric)

$Fabric
                   diff      lwr      upr     p adj
Fabric 2-Fabric 1 -5.02 -8.09676 -1.94324 0.0013227
Fabric 3-Fabric 1 -6.54 -9.61676 -3.46324 0.0000851
Fabric 4-Fabric 1 -4.80 -7.87676 -1.72324 0.0019981
Fabric 3-Fabric 2 -1.52 -4.59676  1.55676 0.5094118
Fabric 4-Fabric 2  0.22 -2.85676  3.29676 0.9968426
Fabric 4-Fabric 3  1.74 -1.33676  4.81676 0.3968476</code></pre>
</div>
</div>
<p>This adjustment in constructing the confidence interval for the difference in the treatment means was proposed by Tukey (known as the Tukey’s Honest Significant Difference (HSD)). The idea behind the multiple comparison test proposed Tukey (or by others such as Duncan) is that the error rate is controlled for the family of interval as against individual intervals. We will rely on the software programs to perform such treatment comparisons and obtain plots for multiple comparison; see <a href="#fig-hsdplot">Figure&nbsp;4</a>. Note that we used the <code>par()</code> function because the Y-axis labels are bit long.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="dv">9</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(oneway.model), <span class="at">las=</span><span class="dv">1</span> , <span class="at">col=</span><span class="st">"brown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hsdplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-hsdplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Tukey HSD plot</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="assumptions-and-transformations" class="level1">
<h1>Assumptions and Transformations</h1>
<p>For the one way ANOVA, it is assumed that the burn time variances for each treatment are the same. Although we can never be sure whether assumptions are valid, we can look for indications that the assumptions may not be realistic.</p>
<p>The sample standard deviations of the treatment groups could be plotted against the sample means of the treatment groups. For the fabric example the means and standard deviations of the fabrics are given below.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">summary</th>
<th style="text-align: left;">Fabric 1</th>
<th style="text-align: left;">Fabric 2</th>
<th style="text-align: right;">Fabric 3</th>
<th style="text-align: right;">Fabric 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mean <span class="math inline">\(\bar {y}_i\)</span></td>
<td style="text-align: left;">16.78</td>
<td style="text-align: left;">11.76</td>
<td style="text-align: right;">10.24</td>
<td style="text-align: right;">11.98</td>
</tr>
<tr class="even">
<td style="text-align: left;">Standard deviation <span class="math inline">\(S_i\)</span></td>
<td style="text-align: left;">1.167</td>
<td style="text-align: left;">2.330</td>
<td style="text-align: right;">1.144</td>
<td style="text-align: right;">1.862</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(burntime),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(burntime)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> sd, <span class="at">group =</span> <span class="fu">factor</span>(<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-meansd" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-meansd-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: SD vs mean for four fabrics</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot of SD vs.&nbsp;mean is shown in <a href="#fig-meansd">Figure&nbsp;5</a>. With only four fabrics in the sample, it is difficult to make any definitive claim. If the assumptions were valid, we would expect the four points to fall approximately along a horizontal band indicating constant standard deviations, and hence variances, regardless of the means of the groups. <a href="#fig-meansd">Figure&nbsp;5</a> suggests that this is the case, so the assumption of equal variances appears to be valid.</p>
<p>A formal test for equal variances may also be performed. In <strong>Bartlett’s test</strong>, the null hypothesis of equal variances is tested. This test requires the response variable to be normally distributed where as the alternative test known as the <strong>Levene’s test</strong> is applicable for any continuous distribution. The <span class="math inline">\(p\)</span>-value for the Bartlett’s test for the fabric data is 0.447. This suggests that the null hypothesis of equal variances for the four fabric burn times be accepted.</p>
<div class="cell" data-warnings="false">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bartlett.test</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bartlett test of homogeneity of variances

data:  burntime by Fabric
Bartlett's K-squared = 2.6606, df = 3, p-value = 0.447</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  3  0.1788 0.9092
      16               </code></pre>
</div>
</div>
<p>If the standard deviations seem to be increasing with the means, a transformation such as the square root or logarithm could be tried. The comments of chapter 4 also apply to the one way ANOVA. However, before performing such a data transformation it is important that the data be checked for outliers. Outliers may inflate the standard deviation for one or more treatments. Such outliers should be checked for accuracy. Even when there is no obvious reason for an outlier, it is probably best to delete such a value if it is obvious that this value is causing a major distortion of the data. This will make our data unbalanced, but that does not matter for one way ANOVA.</p>
<p>The <span class="math inline">\(F\)</span> statistic is based on the null hypothesis that there is no difference (in the population) between treatment means. As we have noted before, a large value of <span class="math inline">\(F\)</span> would indicate that the null hypothesis is not valid and that differences between treatments do exist. However, if the variances for the different treatments vary considerably, then this test is no longer valid.</p>
</section>
<section id="two-way-anova" class="level1">
<h1>Two-Way ANOVA</h1>
<p>We discuss <strong>two-way ANOVA</strong> model using the following example. The strength of concrete (<span class="math inline">\(Y\)</span>, measured in MPa) is affected by the type of aggregate (stone, a blocking variable) and the type of cement (the treatment factor) used. An experiment was conducted in order to investigate the effect of aggregate and cement on concrete strength. In all other respects the concrete was the same. That is, same mixing ratios, the same water and the same mixing procedure was used. Ignoring any interaction between aggregate and cement the following model is to be fitted to the data:</p>
<p>fitted = overall effect + aggregate effect + cement effect.</p>
<p>A single testing was done for each cement and each aggregate, producing the balanced set of results shown in <a href="#tbl-concretedata">Table&nbsp;2</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>concrete <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/concrete.txt"</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_types =</span> <span class="st">"dff"</span>) <span class="co"># double, factor, factor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-concretedata" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;2: Concrete strength data</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Strength</th>
<th style="text-align: left;">Cement</th>
<th style="text-align: left;">Aggregate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">34</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In <a href="#fig-6-8">Figure&nbsp;6</a>, the computation of row (cement) and column (Aggregate) effects is explained. Clearly the rows correspond to the four cements and the columns correspond to the three aggregates.</p>
<div id="fig-6-8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/6-8.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Explanation of row and column factor effects</figcaption>
</figure>
</div>
<p>The <strong>row effect</strong> is taken as the additional row effect after the overall value 14.42 has been fitted. Similarly the <strong>column effect</strong> is taken as the additional column effect after the overall value has been fitted. Note the following points:</p>
<p>a.: Overall value is the overall mean, 14.42.</p>
<p>b.: The row effect for Row 1 is <span class="math inline">\(12-14.42 = -2.42\)</span>. In other words, the row effect is the row mean minus the overall mean. The column effects are calculated similarly.</p>
<p>c.: The row effects add to zero, although in practice, as in this example, there is some rounding error. Likewise, the column effects add to zero. If the data were not balanced the effects would not necessarily add to zero.</p>
<p>d.: In each cell, fitted values and residuals could be calculated. For example, for cell (1, 1), we obtain the fitted value as <span class="math inline">\(14.42 + (-2.42) + (-8.92) = 3.08\)</span>. Hence, residual = observed-fitted <span class="math inline">\(= 4-3.08 = 0.92\)</span>.</p>
<p><strong>ANOVA</strong> tables are a tidy way of writing down the sums of squares, degrees of freedom and mean squares. We are basically concerned with the variation in the dependent variable about its mean and the amount of this variation explained by the explanatory variables, which in this case are the row and column effects. In the SS column in the ANOVA table we break down the total variation according to its source, namely ROWS, COLUMNS and ERROR.</p>
<div id="fig-6-9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/6-9.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Formation of ANOVA table</figcaption>
</figure>
</div>
<p>In the ANOVA table, (given as <a href="#fig-6-9">Figure&nbsp;7</a>) the number of rows is denoted by <span class="math inline">\(r\)</span> and the number of columns is denoted by <span class="math inline">\(c\)</span>. The Error degrees of freedom are obtained by subtracting the ROW and COLUMN degrees of freedom from the total degrees of freedom. The mean squares are obtained by dividing the sums of squares by their respective degrees of freedom. Note that 118.27 (Mean Square corresponding to Total) is the variance of the original observations.</p>
<p>The <code>R</code> output for the two-way ANOVA fit is given below. The entries relating to TOTAL are not displayed in <code>R</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>additive.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(Strength <span class="sc">~</span> Cement <span class="sc">+</span> Aggregate, <span class="at">data =</span> concrete)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(additive.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Cement       3   34.9    11.6    1.46    0.317    
Aggregate    2 1218.2   609.1   76.40 5.39e-05 ***
Residuals    6   47.8     8.0                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Clearly a large variance (MS) for the rows (<code>Cement</code>) would suggest a significant difference between the <code>Cement</code>-group means and a large variance (MS) for the columns (<code>Aggregate</code>) would suggest a significant difference between the <code>Aggregate</code>-group means.</p>
<p>To test whether a factor has a significant influence, we calculate the <span class="math inline">\(F\)</span> test statistic. As before, this statistic is the ratio of two mean squares. Hence, to test whether the rows have the same means in the population (i.e., there’s no “row effect”), the <span class="math inline">\(F\)</span> statistic is <span class="math display">\[F = \frac{\text{Row MS}}{\text{Error MS}}\]</span> with the corresponding numerator and denominator degrees of freedom. Likewise, to test whether the columns have the same means in the population (i.e., there’s no “coumn effect”), the <span class="math inline">\(F\)</span> statistic is <span class="math display">\[F = \frac{\text{Column MS}}{\text{Error MS}}\]</span> with the corresponding numerator and denominator degrees of freedom.</p>
<p>To test the significance of the <code>Cement</code> effect, <span class="math display">\[F = \frac{11.64}{7.97} = 1.5\]</span> with 3 and 6 d.f. Not significant. To test the significance of the <code>Aggregate</code> effect, <span class="math display">\[F = \frac{609.08}{7.97}= 76.4\]</span> with 2 and 6 d.f. Very significant.</p>
<p>These results wouldn’t be surprising to us had we explored the mean concrete strength for the 3 levels of <code>Aggregate</code> and 4 levels of <code>Cement</code> as shown in <a href="#fig-main2">Figure&nbsp;8</a>, which are connected by a line, is known as the <strong>main effects</strong> plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> concrete <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Cement) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Strength)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Mean, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Cement) <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cement"</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Cement"</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(concrete<span class="sc">$</span>Strength), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">5</span>,<span class="dv">30</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> concrete <span class="sc">|&gt;</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Aggregate) <span class="sc">|&gt;</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Strength)) <span class="sc">|&gt;</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Mean, </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Aggregate) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Aggregate"</span>) <span class="sc">+</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Aggregate"</span>) <span class="sc">+</span> </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(concrete<span class="sc">$</span>Strength), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">5</span>,<span class="dv">30</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-main2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-main2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Main effects plots</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="two-way-anova-with-interaction" class="level1">
<h1>Two Way ANOVA with Interaction</h1>
<p><span class="citation" data-cites="Brook">Brook and Arnold (<a href="#ref-Brook" role="doc-biblioref">1985</a>)</span> provided the following data from a milk mixing time experiment.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>paddle <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Speed =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">150</span>, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">150</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diameter =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>               <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">MixTime =</span> <span class="fu">c</span>(<span class="dv">1490</span>,<span class="dv">780</span>,<span class="dv">825</span>,<span class="dv">575</span>,<span class="dv">385</span>,<span class="dv">315</span>,<span class="dv">195</span>,<span class="dv">117</span>,<span class="dv">225</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1100</span>,<span class="dv">620</span>,<span class="dv">690</span>,<span class="dv">480</span>,<span class="dv">385</span>,<span class="dv">400</span>,<span class="dv">230</span>,<span class="dv">190</span>,<span class="dv">145</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>paddle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 3
   Speed Diameter MixTime
   &lt;fct&gt; &lt;fct&gt;      &lt;dbl&gt;
 1 70    90          1490
 2 70    120          780
 3 70    150          825
 4 110   90           575
 5 110   120          385
 6 110   150          315
 7 150   90           195
 8 150   120          117
 9 150   150          225
10 70    90          1100
11 70    120          620
12 70    150          690
13 110   90           480
14 110   120          385
15 110   150          400
16 150   90           230
17 150   120          190
18 150   150          145</code></pre>
</div>
</div>
<p>When whole milk is left standing in a vat, the cream rises to the top, making sampling difficult. A rotating paddle can be used to mix the milk, but too much mixing can damage it. The aim of the experiment was to see how paddle size and speed of rotation affect the optimum mixing time. There were two independent runs at three levels of both speed and paddle size. The data are set out in a two way table in which the rows and columns relate to different speeds and diameters of the paddle. Again, we have balanced data in that the same number of measurements occur in each cell of the table. The experimental data may be treated as separate one way ANOVAs for the Rotational Speed or Paddle Diameter as shown below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed, <span class="at">data =</span> paddle) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
Speed        2 1680304  840152   21.72 3.72e-05 ***
Residuals   15  580184   38679                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(MixTime <span class="sc">~</span> Diameter, <span class="at">data =</span> paddle) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df  Sum Sq Mean Sq F value Pr(&gt;F)
Diameter     2  261871  130936   0.983  0.397
Residuals   15 1998618  133241               </code></pre>
</div>
</div>
<p>Clearly, the rotational speed has more influence than diameter of paddle on optimum mixture time (<span class="math inline">\(p = 0.000\)</span> for Rotational Speed while <span class="math inline">\(p = 0.397\)</span> for Paddle Diameter). Note that the true effect of Paddle Diameter may be masked due to the overestimate of the Error under the (incorrect) one-way ANOVA model. The mean mixing time is obviously higher for a Rotational Speed of 70 rpm, whereas Paddle Diameter appears to have a little effect on the mixing time (see <a href="#fig-mainmixtime">Figure&nbsp;9</a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Speed) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(MixTime)) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> Speed) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Speed"</span>) <span class="sc">+</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Speed"</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(paddle<span class="sc">$</span>MixTime), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">150</span>,<span class="dv">1000</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Diameter) <span class="sc">|&gt;</span> </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(MixTime)) <span class="sc">|&gt;</span> </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> Diameter) <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Diameter"</span>) <span class="sc">+</span> </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Diameter"</span>) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(paddle<span class="sc">$</span>MixTime), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">150</span>,<span class="dv">1000</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-mainmixtime" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-mainmixtime-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Main effects plots</figcaption>
</figure>
</div>
</div>
</div>
<p>The <code>visreg</code> package is useful for automatically plotting linear models, including ANOVA.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>aovs <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed, <span class="at">data =</span> paddle)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>aovd <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> aovs <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">gg=</span>T) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">10</span>,<span class="dv">1200</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> aovd <span class="sc">|&gt;</span> </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">gg=</span>T) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">10</span>,<span class="dv">1200</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).
Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="8-anova_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Whether the effect of Speed on mixing time is <strong>independent</strong> of the paddle diameter or not cannot be explored using the above plot. We can explore interactions graphically using <strong>interaction plots</strong>, as shown in <a href="#fig-intplot1">Figure&nbsp;10</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pmeans <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Speed, Diameter) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MixTime =</span> <span class="fu">mean</span>(MixTime))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> pmeans <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Speed, MixTime)) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">group =</span> Diameter, <span class="at">color =</span> Diameter)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> Diameter))<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set1"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> pmeans <span class="sc">|&gt;</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Diameter, MixTime)) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">group =</span> Speed, <span class="at">color =</span> Speed)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> Speed)) <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">nrow=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-intplot1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-intplot1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Speed*Diameter interaction plot</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-intplot1">Figure&nbsp;10</a>, the mean mixing times have been plotted and connected for all factor level combinations. In the first plot, we’ve put <code>Speed</code> on the x-axis and coloured the points and lines by <code>Diameter</code>, and then swapped the roles. The lines in the interaction plots are not parallel. This suggests that the effect of rotational speed is determined, to some extent, by the effect of paddle diameter (and vice versa). In other words, the effect of rotational speed on mixing time is not the same for the various levels of paddle diameter.</p>
<p>These interaction plots suggest that we should allow for an interaction term in our Two-Way ANOVA model.</p>
<p>A <em>two-way ANOVA interaction model</em> is of the form</p>
<p>fit = overall mean + row effect + column effect + (row<span class="math inline">\(\times\)</span>column effect).</p>
<p>This model has been fitted to mixing times using <code>R</code> below. Note the syntax <code>*</code> which fits both the interaction and main effect terms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>aovdsx <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed <span class="sc">*</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aovdsx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
Speed           2 1680304  840152  67.174 3.89e-06 ***
Diameter        2  261871  130936  10.469  0.00448 ** 
Speed:Diameter  4  205749   51437   4.113  0.03635 *  
Residuals       9  112565   12507                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>With this model object, we can make interaction plots automatically using <code>visreg</code> (<a href="#fig-intplot1b">Figure&nbsp;11</a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(aovdsx, <span class="st">"Speed"</span>, <span class="at">by =</span> <span class="st">"Diameter"</span>, <span class="at">gg=</span>T) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-intplot1b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-intplot1b-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Speed * Diameter interaction plot from visreg</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the interaction effect is tested by comparing the <strong>interaction</strong> (i.e.&nbsp;Speed<span class="math inline">\(\times\)</span>Diameter) MS against the residual (i.e.&nbsp;Error) MS using an <span class="math inline">\(F\)</span> statistic with 4 and 9 degrees of freedom (i.e.&nbsp;<span class="math inline">\(F\)</span> = 4.11). This <span class="math inline">\(F\)</span>-value exceeds the tabulated value 3.63 at the 5% level, so that this interaction effect is significant at the 5% level (also note that the corresponding <span class="math inline">\(p\)</span>-value is smaller than 0.05). In other words, there is evidence that the row effects (i.e.&nbsp;<em>Speed effects</em>) are NOT constant over columns (i.e.&nbsp;<em>Diameters</em>), or the column effects are not constant over rows.</p>
<p>The degrees of freedom, d.f., for the numerator, 4, is the product of 2 times 2.</p>
<p>d.f.(rows<span class="math inline">\(\times\)</span>columns) = d.f.(rows)<span class="math inline">\(\times\)</span> d.f.(columns)</p>
<p>The error degrees of freedom are obtained by subtraction. That is</p>
<p>d.f.(Error) = d.f.(Total)-d.f.(rows)-d.f.(column)-d.f.(rows<span class="math inline">\(\times\)</span>columns) <span class="math inline">\(= (n-1)-(r-1)-(c-1)-(r-1)\times (c-1)= 17- 2-2-4 = 9.\)</span></p>
<p>If it could be assumed that the interaction between rows and columns was not large, an <strong>additive (non-interaction)</strong> model could be fitted, namely</p>
<p>observed = fit + residual = (overall mean + row effect + column effect) + e.</p>
<p>Consider the additive ANOVA model fitted below. Note the syntax <code>+</code> which fits only the main effect terms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>aovds <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed <span class="sc">+</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aovds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
Speed        2 1680304  840152  34.312 6.51e-06 ***
Diameter     2  261871  130936   5.347   0.0202 *  
Residuals   13  318313   24486                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Notice that the degrees of freedom for the error term in the additive model is the sum of the d.f. for error and interaction. Similarly,</p>
<p>SS (Error) of Additive Model = SS (Interaction) + SS (Error) of Interaction Model.</p>
<p>Notice that if there was only <strong>ONE</strong> observation in each cell, it would not be possible to test for the significance of an interaction. This is the case with the two-way ANOVA we considered in the previous section (see concrete strength ANOVA output).</p>
<p>The mixtime experimental setup is known as a factorial design where the factor levels are crossed to form the treatments. The treatments are usually completely randomised. When factor levels are quantitative, we can also fit a regression model. The set levels of Speed and Diameter are quantitative. So we can regress the mixing time on the speed and diameter levels. The advantage with this approach is that we will be able to fit a <em>response surface</em> of mixing time so that we can look for optimum settings on some cost or practical grounds. <a href="#fig-rsmplot">Figure&nbsp;12</a> shows the contour plot of the regression (response) surface of mixing time. This plot suggests that both speed and diameter must be set at higher levels in general to reduce the mixing time. But we can choose practically convenient settings such as higher speed but smaller diameter. The curvature in the contour plot is due to the interaction effect but it tends to be smaller at higher speeds. The text by <span class="citation" data-cites="box2005statistics">Box, Hunter, and Hunter (<a href="#ref-box2005statistics" role="doc-biblioref">2005</a>)</span> contains many examples on using experimental designs for response surface optimisation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg2d</span>(aovdsx, <span class="st">"Speed"</span>, <span class="st">"Diameter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rsmplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-rsmplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: 2d contour visreg plot of mixing time</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="indicator-variables" class="level1">
<h1>Indicator Variables</h1>
<p>Indicator variable (also known as a dummy or binary variable) is one whose possible values are either 1 or zero. A value of 1 means a particular attribute or characteristic is present and a value of zero means the absence. For example, we may define indicator variables for males and females. Consider- Indicator variable for the male category <span class="math display">\[\begin{array}{cccc}
I_{\text {male}} &amp; = &amp; 1 &amp; \text{for males}\\
&amp; &amp; 0&amp; \text{for females}
\end{array}\]</span></p>
<p>Indicator variable for the female category <span class="math display">\[\begin{array}{cccc}
I_{\text{female}} &amp; = &amp; 1 &amp; \text{for females}\\
&amp; &amp; 0&amp; \text{for males}
\end{array}\]</span></p>
<p>In order identify the gender category, we either need either <span class="math inline">\(I_{male}\)</span> or <span class="math inline">\(I_{female}\)</span> and not both. This is because for the two gender categories, we have only a single degree of freedom. Using indicator variables, we will be able to include categorical predictors in a regression model. It is also possible to approach the ANOVA test for equality of means through linear regression.</p>
<p>Consider the fabric burn time data discussed earlier. For the four fabric types, we define the following four indicator variables,</p>
<p><span class="math display">\[\begin{array}{cccc}
I_1 &amp; = &amp; 1 &amp; \text{for Fabric 1}\\
&amp; &amp; 0&amp; \text{for Fabric 2, 3 and 4}
\end{array}\]</span> <span class="math display">\[\begin{array}{cccc}
I_2 &amp; = &amp; 1 &amp; \text{for Fabric 2}\\
&amp; &amp; 0&amp; \text{for Fabric 1, 3 and 4}
\end{array}\]</span> <span class="math display">\[\begin{array}{cccc}
I_3 &amp; = &amp; 1 &amp; \text{for Fabric 3}\\
&amp; &amp; 0&amp; \text{for Fabric 1, 2 and 4}
\end{array}\]</span> <span class="math display">\[\begin{array}{cccc}
I_4 &amp; = &amp; 1 &amp; \text{for Fabric 4}\\
&amp; &amp; 0&amp; \text{for Fabric 1, 2 and 3}
\end{array}\]</span></p>
<p>Note that we need only any three of the above indicator variables to identify the fabric category. For example, with <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_2\)</span>, and <span class="math inline">\(I_3\)</span> variables, fabric 4 is identified when <span class="math inline">\(I_1 = I_2 = I_3 = 0\)</span>. See <a href="#tbl-invartab">Table&nbsp;3</a>.</p>
<p>Let us regress the burn times on the indicator variables <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_2\)</span> and <span class="math inline">\(I_3\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fabric <span class="ot">&lt;-</span> fabric <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(burntime, Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 1"</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 2"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 3"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">I4 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 4"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>fabric</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-invartab" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3: Indicators of Fabrics</caption>
<thead>
<tr class="header">
<th style="text-align: right;">burntime</th>
<th style="text-align: left;">Fabric</th>
<th style="text-align: right;">I1</th>
<th style="text-align: right;">I2</th>
<th style="text-align: right;">I3</th>
<th style="text-align: right;">I4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">17.8</td>
<td style="text-align: left;">Fabric 1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">16.2</td>
<td style="text-align: left;">Fabric 1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17.5</td>
<td style="text-align: left;">Fabric 1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">17.4</td>
<td style="text-align: left;">Fabric 1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15.0</td>
<td style="text-align: left;">Fabric 1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">11.2</td>
<td style="text-align: left;">Fabric 2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11.4</td>
<td style="text-align: left;">Fabric 2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">15.8</td>
<td style="text-align: left;">Fabric 2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.0</td>
<td style="text-align: left;">Fabric 2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10.4</td>
<td style="text-align: left;">Fabric 2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11.8</td>
<td style="text-align: left;">Fabric 3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">11.0</td>
<td style="text-align: left;">Fabric 3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.0</td>
<td style="text-align: left;">Fabric 3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.2</td>
<td style="text-align: left;">Fabric 3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9.2</td>
<td style="text-align: left;">Fabric 3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">14.9</td>
<td style="text-align: left;">Fabric 4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.8</td>
<td style="text-align: left;">Fabric 4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">12.8</td>
<td style="text-align: left;">Fabric 4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.7</td>
<td style="text-align: left;">Fabric 4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">10.7</td>
<td style="text-align: left;">Fabric 4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(burntime <span class="sc">~</span> I1 <span class="sc">+</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> fabric)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = burntime ~ I1 + I2 + I3, data = fabric)

Residuals:
   Min     1Q Median     3Q    Max 
-1.780 -1.205 -0.460  0.775  4.040 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  11.9800     0.7604  15.754 3.65e-11 ***
I1            4.8000     1.0754   4.463 0.000392 ***
I2           -0.2200     1.0754  -0.205 0.840485    
I3           -1.7400     1.0754  -1.618 0.125206    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.7 on 16 degrees of freedom
Multiple R-squared:  0.7226,    Adjusted R-squared:  0.6706 
F-statistic: 13.89 on 3 and 16 DF,  p-value: 0.0001016</code></pre>
</div>
</div>
<p>The following points are to be noted on the above regression model:</p>
<ol type="1">
<li><p>The <span class="math inline">\(y\)</span>-intercept 11.98 is the mean burn time of the fourth fabric (i.e.&nbsp;the mean response for the omitted predictor category).</p></li>
<li><p>The mean burn time of fabrics 1, 2 and 3 can be found from the fitted model. For fabric 1, <span class="math inline">\(I_1\)</span> =1, <span class="math inline">\(I_2\)</span>=0, and <span class="math inline">\(I_3\)</span> =0. Substituting these values in the fitted model, we get <span class="math inline">\(11.98 + 4.80\times 1 - 0.22\times 0 - 1.74\times 0 = 12+4.8 = 16.78\)</span>, which is mean burn time of fabric 1. For fabric 2, the mean burn time is <span class="math inline">\(11.98 + 4.80\times 0 - 0.22\times 1 - 1.74\times 0 = 11.76\)</span>. For fabric 3, the mean burn time is <span class="math inline">\(11.98 + 4.80\times 0 - 0.22\times 0 - 1.74\times 1 = 10.24\)</span>. In other words, the fitted coefficient of an indicator variable is the difference between the response means of the category indicated by the variable and the ‘base’ category (indicated by the omitted indicator variable).</p></li>
<li><p>The significance of the slope coefficients implies a significant difference in means. For example, the coefficient of the indicator variable <span class="math inline">\(I_1\)</span> is highly significant. This means that the mean burn time of fabric 1 is significantly different from the mean burn time of fabric 4. Note that this is not the case when fabrics 2 and 3 are compared with fabric 4.</p></li>
<li><p>In the above output, a multiple comparison of means is made keeping fabric 4 as the base. A comparison of the mean burn time of fabrics 2 &amp; 3 is not possible with the above regression. We need to omit either <span class="math inline">\(I_2\)</span> or <span class="math inline">\(I_3\)</span> and fit a regression of burn time on the predictors <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_3\)</span>, and <span class="math inline">\(I_4\)</span> or <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_2\)</span>, and <span class="math inline">\(I_4\)</span> for such a comparison.</p></li>
</ol>
<p>The ANOVA of the regression model is the same as the one-way ANOVA fit (compare F, mean squares etc.)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: burntime
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
I1         1 111.521 111.521 38.5718 1.248e-05 ***
I2         1   1.408   1.408  0.4871    0.4952    
I3         1   7.569   7.569  2.6179    0.1252    
Residuals 16  46.260   2.891                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<section id="another-example" class="level2">
<h2 class="anchored" data-anchor-id="another-example">Another example</h2>
<p>Consider the pine tree data discussed earlier. Let us model the Top circumference (numerical response) using Area variable (which is categorical). A plot of the raw data and mean circumference along with the associated 95% confidence intervals are shown in <a href="#fig-errplot">Figure&nbsp;13</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/pinetree.RData"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"pinetree.RData"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"pinetree.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pinetree <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Area, <span class="at">y =</span> Top, <span class="at">color =</span> Area) <span class="sc">+</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.3</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">+</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_normal"</span>, </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"errorbar"</span>, </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">width =</span> <span class="fl">0.075</span>, </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.3</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>               ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-errplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-errplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Interval Plot</figcaption>
</figure>
</div>
</div>
</div>
<p>For the three different areas of the forest, we define the following three indicator variables,</p>
<p><span class="math display">\[\begin{array}{cccc}
I_1 &amp; = &amp; 1 &amp; \text{for Area 1}\\
&amp; &amp; 0&amp; \text{for Areas 2, and 3}
\end{array}\]</span> <span class="math display">\[\begin{array}{cccc}
I_2 &amp; = &amp; 1 &amp; \text{for Area 2}\\
&amp; &amp; 0&amp; \text{for Areas 1, and 3}
\end{array}\]</span> <span class="math display">\[\begin{array}{cccc}
I_3 &amp; = &amp; 1 &amp; \text{for Area 3}\\
&amp; &amp; 0&amp; \text{for Areas 1, and 2}
\end{array}\]</span></p>
<p>Note that we need only any three of the above indicator variables to identify the Area category. For example, with <span class="math inline">\(I_1\)</span> and <span class="math inline">\(I_2\)</span> variables, Area 3 is identified when <span class="math inline">\(I_1 = I_2 = 0\)</span>.</p>
<p>Let us regress the pine tree Top circumference on the indicator variables <span class="math inline">\(I_2\)</span> and <span class="math inline">\(I_3\)</span> using the following <code>R</code> codes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pinetree1 <span class="ot">&lt;-</span> pinetree <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Area, Top) <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"2"</span>), </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"3"</span>) )</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> pinetree1)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>pinetree1 <span class="ot">&lt;-</span> pinetree <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Top, Area) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"2"</span>), </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"3"</span>) )</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> pinetree1)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-indicat" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;4: Regression of Top Circumference on Area Indicator Variables</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">20.025</td>
<td style="text-align: right;">1.11375</td>
<td style="text-align: right;">17.979805</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">I2</td>
<td style="text-align: right;">-1.955</td>
<td style="text-align: right;">1.57508</td>
<td style="text-align: right;">-1.241207</td>
<td style="text-align: right;">0.2196132</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I3</td>
<td style="text-align: right;">-5.925</td>
<td style="text-align: right;">1.57508</td>
<td style="text-align: right;">-3.761714</td>
<td style="text-align: right;">0.0004002</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The following points are to be noted on the regression model shown in <a href="#tbl-indicat">Table&nbsp;4</a>:</p>
<ol type="1">
<li><p>The <span class="math inline">\(y\)</span>-intercept 20.025 is the mean Top circumference for Area 1 (i.e.&nbsp;the mean response for the omitted predictor category).</p></li>
<li><p>The mean Top circumference 2 and 3 can be found from the fitted model. For Area 2, <span class="math inline">\(I_1\)</span> =0, <span class="math inline">\(I_2\)</span>=1, and <span class="math inline">\(I_3\)</span> =0. Substituting these values in the fitted model, we get <span class="math inline">\(20.025 -1.955 \times 1 -5.925 \times 0 = 20.025-1.955 = 18.07\)</span>, which is mean Top circumference for Area 1. For Area 3, the mean Top circumference for Area 3 is <span class="math inline">\(20.025 -1.955 \times 0 -5.925 \times 1 = 20.025= 14.1\)</span>. In other words, the fitted coefficient of an indicator variable is the difference between the response means of the category indicated by the variable and the ‘base’ category (indicated by the omitted indicator variable).</p></li>
<li><p>The significance of the slope coefficients implies a significant difference in means. For example, the coefficient of the indicator variable <span class="math inline">\(I_2\)</span> is highly significant. This means that the mean Top circumference for Area 2 is significantly different from the mean Top circumference for Area 1. The negative sign of the coefficient means that Area 2 mean is significantly lower when compared Area 1 mean. The same is true when Area 3 is compared with Area 1.</p></li>
<li><p>In the above output, a multiple comparison of means is made keeping Area 1 as the base. A comparison of the mean Top circumference for Areas 2 &amp; 3 is not possible with the above regression. We need to omit either <span class="math inline">\(I_2\)</span> or <span class="math inline">\(I_3\)</span> and fit a regression for such a comparison.</p></li>
</ol>
<p>In practice, you will NOT be creating any indicator variables to perform the analysis and <code>R</code> does it for us when we use the <code>lm()</code> function but we have to make sure that categorical factors are stored as factors, not numerical variables.</p>
<p>The ANOVA of the regression model shown in <a href="#tbl-indanova">Table&nbsp;5</a> has a highly significant F value which means that at least one Area is different in terms of mean Top circumference.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Top <span class="sc">~</span> Area, <span class="at">data=</span>pinetree) <span class="sc">|&gt;</span> <span class="fu">anova</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-indanova" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;5: Regression ANOVA</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Area</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">364.5903</td>
<td style="text-align: right;">182.29517</td>
<td style="text-align: right;">7.348015</td>
<td style="text-align: right;">0.0014482</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">1414.0995</td>
<td style="text-align: right;">24.80876</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-of-covariance-ancova" class="level1">
<h1>Analysis of Covariance (ANCOVA)</h1>
<p>Indicator variables are particular useful when both a dependent variable and an independent variable are measured. One would like to use regression to show the relationship between the dependent or response variable and the explanatory variable (covariate) separately for each factor level. However, both the slope and the intercept may differ for the various factor levels. What sort of model does one fit to such data? Consider the Restaurant Sales Data presented in the first four columns of <a href="#tbl-Restaurant">Table&nbsp;6</a>. This dataset is from <span class="citation" data-cites="Neter">Neter and Whitmore (<a href="#ref-Neter" role="doc-biblioref">1993</a>)</span>.</p>
<p>A study for a chain of fast-food restaurants examined the relationship between restaurant sales (<span class="math inline">\(Y\)</span>, in thousands of dollars) and the number of households in the restaurant’s trading area (<span class="math inline">\(X\)</span>, in thousands) and location of restaurant (Highway, shopping Mall, Street).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>restaurant <span class="ot">&lt;-</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_table</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/restaurant.txt"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_types =</span> <span class="st">"fddf"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Restaurant =</span> <span class="fu">factor</span>(Restaurant),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">I1 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Mall"</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Street"</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Highway"</span>),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">I1.X =</span> I1 <span class="sc">*</span> Households,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2.X =</span> I2 <span class="sc">*</span> Households)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>restaurant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-Restaurant" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;6: Restaurant Sales Data</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Restaurant</th>
<th style="text-align: right;">Sales</th>
<th style="text-align: right;">Households</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">I1</th>
<th style="text-align: right;">I2</th>
<th style="text-align: right;">I3</th>
<th style="text-align: right;">I1.X</th>
<th style="text-align: right;">I2.X</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">135.27</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">72.74</td>
<td style="text-align: right;">93</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">114.95</td>
<td style="text-align: right;">128</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">102.93</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">131.77</td>
<td style="text-align: right;">158</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: right;">160.91</td>
<td style="text-align: right;">183</td>
<td style="text-align: left;">Highway</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: right;">179.86</td>
<td style="text-align: right;">178</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: right;">220.14</td>
<td style="text-align: right;">215</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">215</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: right;">179.64</td>
<td style="text-align: right;">172</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">172</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: right;">185.92</td>
<td style="text-align: right;">197</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: right;">207.82</td>
<td style="text-align: right;">207</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: right;">113.51</td>
<td style="text-align: right;">95</td>
<td style="text-align: left;">Mall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: right;">203.98</td>
<td style="text-align: right;">224</td>
<td style="text-align: left;">Street</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">224</td>
</tr>
<tr class="even">
<td style="text-align: left;">14</td>
<td style="text-align: right;">174.48</td>
<td style="text-align: right;">199</td>
<td style="text-align: left;">Street</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">199</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: right;">220.43</td>
<td style="text-align: right;">240</td>
<td style="text-align: left;">Street</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">240</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: right;">93.19</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">Street</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><a href="#tbl-Restaurant">Table&nbsp;6</a> also shows the indicator variables for the Location factor. Just two indicator variables (say <span class="math inline">\(I_1\)</span> and <span class="math inline">\(I_2\)</span>) are needed in order to define the three different locations uniquely. In order to permit a separate line for each location we need a model of the following form</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 I_1 + \beta_2 I_2 + (\beta_3 + \beta_4 I_1 + \beta_5 I_2)X\]</span></p>
<p>This model provides a separate model for each location as well as allows for the interaction between the location of the restaurant and the number of households through the slope coefficients.</p>
<p>For Highway locations, <span class="math inline">\(I_1\)</span> and <span class="math inline">\(I_2\)</span> are both equal to zero. Hence the model simplifies to <span class="math inline">\(Y = \beta_0 + (\beta_3)X\)</span>. For Mall locations, <span class="math inline">\(I_1\)</span> is equal to one and <span class="math inline">\(I_2\)</span> is equal to zero. So the model becomes <span class="math inline">\(Y = (\beta_0 + \beta_1 ) + (\beta_3 + \beta_4)X\)</span>. For Street locations, <span class="math inline">\(I_1\)</span> is equal to zero and <span class="math inline">\(I_2\)</span> is equal to one. So the model becomes <span class="math inline">\(Y = (\beta_0 + \beta_2 ) + (\beta_3 + \beta_5)X\)</span>.</p>
<p>The newly created product variables <span class="math inline">\(I_1.X=I_1\times X\)</span> and <span class="math inline">\(I_2.X=I_2\times X\)</span> shown in <a href="#tbl-Restaurant">Table&nbsp;6</a> allow us to fit separate slopes for the Locations. <code>R</code> does not require creation of data for the interaction terms <span class="math inline">\(I_1\)</span><span class="math inline">\(\times X\)</span> and <span class="math inline">\(I_2\)</span><span class="math inline">\(\times X\)</span> and it does internally. The regression of Sales <span class="math inline">\((Y)\)</span> on Households <span class="math inline">\((X)\)</span>, <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_2\)</span>, <span class="math inline">\(I_1\times X\)</span> and <span class="math inline">\(I_2\times X\)</span> is shown in <a href="#tbl-anovatab">Table&nbsp;7</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ancova.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> Households <span class="sc">+</span> I1 <span class="sc">+</span> I2 <span class="sc">+</span> I1.X <span class="sc">+</span> I2.X,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>restaurant)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(ancova.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-anovatab" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7: Analysis of Covariance (ANCOVA)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-6.203</td>
<td style="text-align: right;">11.818</td>
<td style="text-align: right;">-0.525</td>
<td style="text-align: right;">0.611</td>
</tr>
<tr class="even">
<td style="text-align: left;">Households</td>
<td style="text-align: right;">0.909</td>
<td style="text-align: right;">0.083</td>
<td style="text-align: right;">10.906</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I1</td>
<td style="text-align: right;">39.223</td>
<td style="text-align: right;">16.451</td>
<td style="text-align: right;">2.384</td>
<td style="text-align: right;">0.038</td>
</tr>
<tr class="even">
<td style="text-align: left;">I2</td>
<td style="text-align: right;">8.036</td>
<td style="text-align: right;">16.273</td>
<td style="text-align: right;">0.494</td>
<td style="text-align: right;">0.632</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I1.X</td>
<td style="text-align: right;">-0.074</td>
<td style="text-align: right;">0.104</td>
<td style="text-align: right;">-0.710</td>
<td style="text-align: right;">0.494</td>
</tr>
<tr class="even">
<td style="text-align: left;">I2.X</td>
<td style="text-align: right;">-0.012</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">-0.120</td>
<td style="text-align: right;">0.907</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This <code>R</code> output suggests that the coefficients for <span class="math inline">\(I_2\)</span>, <span class="math inline">\(I_1\times X\)</span> and <span class="math inline">\(I_2\times X\)</span> are not significantly different from zero. This suggests that a simpler model can be fitted to these data omitting the category indicated by <span class="math inline">\(I_2\)</span>. The significance of the <span class="math inline">\(I_1\)</span> coefficient means that the <span class="math inline">\(y\)</span>-intercept of the model for Mall location is different. The significance of the coefficients of the product variables will imply significant differences in slopes for the locations but this is not the case here. In general, a stepwise regression is needed to obtain a simpler model having the best subset of predictors (rather than judging from the multiple regression model given here).</p>
<p>The final or simpler model suggested after step-wise analysis (results not shown) is:</p>
<p><span class="math inline">\(Y = -3.298 + 0.906 X + 23.8\times I_1\)</span>.</p>
<p>Because <span class="math inline">\(I_2\)</span> does not appear in this equation, it means that the same regression line can be used to relate sales to number of households for the Highway and Street Locations. The fact that <span class="math inline">\(I_1\)</span> is included in the final model but <span class="math inline">\(I_1\)</span><span class="math inline">\(\times X\)</span> is excluded means that the line for Malls has a different intercept but the same slope as the Highway/Street Line.</p>
<p><span class="math inline">\(I_1\)</span>=0 for both Highway and Street locations so the fitted values for Highway/Street locations is,</p>
<p><span class="math inline">\(Y = -3.298 + 0.906 X\)</span>.</p>
<p><span class="math inline">\(I_1\)</span>=1 for Mall locations so the fitted model for Mall locations is,</p>
<p><span class="math inline">\(Y = (-3.298 + 23.81) + (0.906-0.074)X = 20.512 + 0.832X\)</span>.</p>
<p>These two lines are plotted in <a href="#fig-ancovaplot">Figure&nbsp;14</a>. The top line is (obviously) the fitted model for Mall locations and the bottom one for Highway and Street locations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>restaurant <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Mall location</span><span class="st">`</span> <span class="ot">=</span> Location <span class="sc">==</span> <span class="st">"Mall"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Sales, <span class="at">x =</span> Households, <span class="at">linetype =</span> <span class="st">`</span><span class="at">Mall location</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Location)) <span class="sc">+</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ancovaplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="8-anova_files/figure-html/fig-ancovaplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Plot of Fitted Lines</figcaption>
</figure>
</div>
</div>
</div>
<p>In practice, you will NOT be creating any indicator variables to perform the analysis of covariance and <code>R</code> does it for us when we use the <code>lm()</code> with the syntax <code>*</code> which stands for interaction. Try-</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> First <span class="sc">*</span> Area, <span class="at">data =</span> pinetree)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl) <span class="co"># also summary(mdl)  or anova(mdl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>Various ANOVA models have been considered in this chapter. The goodness of fit is indicated by the <span class="math inline">\(R\)</span>-Squared value or <span class="math inline">\(F\)</span> statistic. Most of the ANOVA examples given in this chapter are based on experimental data but ANOVA models can also be fitted to survey data, provided that the observations represent a random sample. When the observations are time series or other data forms chosen in a non-random fashion, the assumptions of these models may not be satisfied. In particular it is unlikely that the residuals will be independent, following no clear pattern. It is important that such assumptions be checked; otherwise the results of these analyses may be misleading. It is also important that the residual variances are reasonably similar for all treatment levels. If this is not the case, some transformation of the response variable may be required in order to ensure that the ANOVA <span class="math inline">\(F\)</span> tests are valid.</p>
<p>Indicator variables can be used to perform ANOVA using regression. However, it is more common to use indicator variables when one wants to use both a categorical factor and a continuous measurement variable <span class="math inline">\(X\)</span> to model the <span class="math inline">\(Y\)</span> responses. Such an analysis is called an ANCOVA and the model fitted using regression may consist of a separate model for each treatment.</p>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bhattacharyya1977" class="csl-entry" role="listitem">
Bhattacharyya, G. K., and R. A. Johnson. 1977. <em>Statistical Concepts and Methods</em>. NY: Wiley.
</div>
<div id="ref-box2005statistics" class="csl-entry" role="listitem">
Box, G. E. P., J. S. Hunter, and W. G. Hunter. 2005. <em>Statistics for Experimenters: Design, Innovation, and Discovery</em>. Wiley Series in Probability and Statistics. Wiley-Interscience.
</div>
<div id="ref-Brook" class="csl-entry" role="listitem">
Brook, R. J., and G. C. Arnold. 1985. <em>Applied Regression Analysis and Experimental Design</em>. NY: Marcel Dekker.
</div>
<div id="ref-Neter" class="csl-entry" role="listitem">
Neter, Wasserman W., J., and G. A. Whitmore. 1993. <em>Applied Statistics</em>. Boston: Allyn; Bacon.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../studyguide/7-multiple.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Chapter 7: Models with Multiple Continuous Predictors</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb52" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "*To consult a statistician after an experiment is finished is often merely to ask him to conduct a post mortem examination. He can perhaps say what the experiment died of.*"</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; – Sir RA Fisher</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction to Analysis of Variance (ANOVA)</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>We consider **ANOVA models** for data which have, in many cases, been collected using experimental designs. The model provides a quantitative assessment of the treatment effects. The first model we shall consider is the **One-Way ANOVA** model. The data for these models are used when only one set of treatments is to be compared. Here the set of treatments is called a factor and the various treatments are referred to as the factor levels.</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>A One-Way ANOVA model is expressed in terms of an overall effect (the overall response mean) and a treatment effect (the average effect for a particular treatment or level on the response variable). The model has the form</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>**fit = overall effect + treatment effect**.</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>The second model we shall consider later is a Two-Way Model. The experiments used to produce these data may be from two sets of treatments (that is, two factors). Again we refer to the treatments for each factor as the levels for each factor. We shall assume that the data are fully balanced in that the same number of observations is obtained for each combination of factor levels. For instance, if factor 1 has 3 levels and factor 2 has 2 levels then the total number of observations must be a multiple of 6.</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>The computer output for an ANOVA often includes the mean response for each combination of factor levels. These means are often represented as a table with the rows corresponding to the levels of the first factor and the columns corresponding to the levels of the second factor. For convenience we shall refer to the levels of factor 1 as the <span class="in">`rows`</span> and we shall refer to the levels of factor 2 as the <span class="in">`columns`</span>. There are two possible Two-Way ANOVA models. The first model assumes that the effects of factors 1 and 2 are independent. The appropriate model is expressed in terms of the overall effect (overall mean), the row effect and the column effect. That is</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>**fit = overall effect + row effect + column effect**.</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>The second Two-Way ANOVA allows for an **interaction** between the row and column effects. That is</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>**fit = overall effect + row effect + column effect + interaction effect**.</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>Finally we shall consider an Analysis of Covariance (ANCOVA) model. In these experiments paired ($X$, $Y$) measurements are obtained for each observation. $X$ is the explanatory variable and $Y$ is the response variable. When there is only one experimental factor the following model is applied,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>**fit = overall effect + treatment effect +** $X$-effect.</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>ANCOVA models are, in essence, a mixture of regression and ANOVA models. For all the above models</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>**observed = fitted + residual**.</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>The residuals are used to test the adequacy of the model fitted as in regression.</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="fu"># One Way ANOVA</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>As part of a multi-lab study, four fabrics were tested for flammability at the National Bureau of Standards. The burn times in seconds were recorded after a paper tab was ignited on the hem of each fabric. The experimental data are presented below (@tbl-fabricdata; taken from p.496 of @bhattacharyya1977.</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/fabric.RData"</span>,</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"fabric.RData"</span>)</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"fabric.RData"</span>)</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>dtf <span class="ot">&lt;-</span> fabric <span class="sc">|&gt;</span> <span class="fu">unstack</span>(burntime <span class="sc">~</span> Fabric)</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>dtf</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-fabricdata</span></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Fabric Burntime data"</span></span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dtf) </span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>Note that the response variable $Y$ is quantitative in that they are measurements of burn times in seconds. The five measurements for each fabric are assumed to be a random sample for all possible burn times for that fabric so that the five readings are true replications.</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>In this example, each of the four fabrics is replicated the same number of times, namely five, so the experiment is said to be "balanced". The approaches explained in this section on One-Way ANOVA can easily be extended to unbalanced experiments. This is not the case for Two-Way ANOVA.</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>Using the same approach as in Chapter 4, we could compare any two fabrics by a $t$-test or by considering the confidence interval for the difference in means. With 4 fabrics, there are 6 comparisons which could be made (Fabric 1 vs. Fabric 2 etc.).</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a>How should we proceed? Should we test each of these 6 differences in means? Unfortunately, there is a problem in this procedure. One tends to find too many significant differences between means. There are two reasons for this:</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The comparisons are not independent. If one fabric mean happened to be unduly large by chance, every comparison involving that mean would tend to yield a significant (say, at the 5% level) difference with each of the other means.</span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>For one comparison, the 95% confidence level (5% level of the $t$-test) would yield a significant difference between the means in about 5% of samples of these two fabrics **even if the fabrics responded equally to the flammability test.** The more comparisons that are made on pairs of fabrics, the more likely it is that sooner or later some of the difference will appear significant at the 5% level, even when there is no difference between the fabrics. This is true for any statistical test and not just $t$-tests. If a number of tests are carried out on the same set of data, eventually some false significant results will be obtained. It has been suggested that if you torture data enough, it will confess, whether or not it is guilty.</span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a>One way out of this dilemma is to carry out a single test, an $F$-test, which can be thought of as giving an average value of the comparisons between treatments. The way it does this should become clear in the next few sections.</span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a>The burn times are plotted in @fig-fabricstrip in which the scale on the horizontal axis indicates the number of the fabric. The times for fabrics 2 and 4 appear fairly similar to the times for fabric 3. But the burn times for fabric 1 appear to be higher.</span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-fabricstrip</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Burn time vs fabric Id"</span></span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Fabric, <span class="at">y =</span> burntime) <span class="sc">+</span></span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(burntime)), <span class="at">alpha =</span> .<span class="dv">7</span>)  <span class="sc">+</span> </span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">7</span>,</span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">mean</span>(fabric<span class="sc">$</span>burntime) <span class="sc">+</span> <span class="fl">0.3</span>,</span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Overall mean"</span>,</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha=</span>.<span class="dv">7</span></span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a>           ) </span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a>Let $y_{ij}$ be the $j^{th}$ observed value in the $i^{th}$ treatment (fabric type in the above example); $\bar{y}_{i}$ be the mean of the $i^{th}$ treatment; $\bar{y}$ be the overall mean of all the observations; $k$ is the total number of treatments being compared. As usual the observed data can be modelled by</span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a>observed = fit + residual.</span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>However, the appropriate model for the fit is different for these data. For a treatment $i$ observation</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>fit =$\bar{y}_{i}$, the mean of the $i^{th}$ treatment</span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a>or, adding and subtracting $\bar{y}$ ,</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a>fit =$\bar{y} + (\bar{y}_{i} - \bar{y})$ =overall mean + treatment effect</span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a>Clearly, residual = observed - fit; so the residual for $y_{ij}$ is equal to</span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a>residual = $y_{ij}-(\bar{y} + (\bar{y}_{i}- \bar{y})) = y_{ij} - \bar{y}_{i}$</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>Since observed = fit + residual, we have $$y_{ij} = \bar{y} + (\bar{y}_{i} -\bar{y}) + (y_{ij} - \bar{y}_{i} )$$</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a>observed = overall mean + treatment effect + residual.</span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a>That is $$y_{ij} = m + t_{i} + e_{ij}$$ where the three terms on the right are:</span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a>$m$ =: the overall mean, $\bar{y}$,</span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a>$t_{i}$ =: the treatment effect, **adjusted** for the mean. i.e. ($\bar{y}_{i} -\bar{y}$),</span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a>$e_{ij}$ =: the residual or error, ($y_{ij}$- $\bar{y}_{i}$). See @fig-6-3 (produced manually) for an illustration of the treatment effect for the fabric data.</span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a><span class="al">![Explanation  of factor effects](images/6-3.png)</span>{#fig-6-3}</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a>From the above model we obtain the equation $$(y_{ij}-\bar{y}) = (\bar{y}_{i}-\bar{y}) + (y_{ij}- \bar{y}_{i} ).$$ It can be shown that the sums of squares follow from this equation if each term is squared and then summed over **all** the values in the sample. Note, the summation is over both $i$ and $j$.</span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a>$$\sum _{i,j}\left(y_{ij} -\bar{y}\right)^{2}   = \sum _{i,j}\left(\bar{y}_{i} -\bar{y}\right)^{2}   + \sum _{i,j}\left(y_{ij} -\bar{y}_{i} \right)^{2}$$</span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a>That is, SS TOTAL = SS FACTOR + SS ERROR.</span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a>Mean squares (MeanSq or MS) are obtained by dividing the sums of squares (SS) by their respective degrees of freedom (df), as shown below:</span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a>| SS     | df  |     MeanSq      |</span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a>|:-------|:----|:---------------:|</span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a>| FACTOR | k-1 | FACTOR SS/(n-1) |</span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a>| ERROR  | n-k |  ERROR SS/(n-k  |</span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a>| TOTAL  | n-1 | TOTAL SS/(n-1)  |</span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a>Finally, the $F$ statistic for the FACTOR is obtained by dividing the FACTOR MeanSq by the ERROR MeanSq. The associated degrees of freedom are $k-1$ for the numerator and $n-k$ for the denominator. We display the SS, MS in the form of a table called the one-way ANOVA table.</span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a>For fabric data, the one-way ANOVA <span class="in">`R`</span> output is shown below.</span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fabricanova, echo=TRUE}</span></span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a>oneway.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oneway.model)</span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a>If there is no real difference between the fabrics, we would expect the $F$ Statistic to be about 1. If there is a real difference, we would expect the $F$ statistics to be larger than 1. From tables, the 95th percentile of the $F$ statistic with 3 and 16 degrees of freedom is 3.24. As our value of 13.89 is more than this, the $F$ statistic is significant at the 5% level. This is also confirmed by the $p$-value, which is 0.000. So there is a significant difference between the mean burning times of the fabrics. This obviously doesn't mean that **all** the fabrics differ significantly from each other. It means that there is a significant difference for **at least** one pair of fabrics.</span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a>The individual confidence intervals for the fabric means may be obtained using the pooled error estimate S of 1.7 (the square root of MS Error of 2.891). For example, the confidence interval for the mean burn time of fabric 1 is $mean \pm t_{error~df, 0.975}\times S$ or $16.78\pm 2.12\times 1.7$ or (15.17, 18.39).</span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ciplot</span></span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'CIs using pooled SD'</span></span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(burntime),</span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(burntime),</span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci =</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> se</span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Fabric, <span class="at">y =</span> mean, <span class="at">group =</span> <span class="fu">factor</span>(<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> ci, </span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> mean <span class="sc">+</span> ci), </span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> .<span class="dv">1</span>)</span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a>The 95% confidence intervals shown in @fig-ciplot indicate that fabric 1 differs significantly from the other three fabrics. Note that each CI in the above figure has individual Type I error rate, which makes the overall comparison difficult.</span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a>For comparing many treatments, we may perform multiple comparison tests. The following <span class="in">`R`</span> output shows the adjusted confidence intervals for the difference in fabric means.</span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(oneway.model)</span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>This adjustment in constructing the confidence interval for the difference in the treatment means was proposed by Tukey (known as the Tukey's Honest Significant Difference (HSD)). The idea behind the multiple comparison test proposed Tukey (or by others such as Duncan) is that the error rate is controlled for the family of interval as against individual intervals. We will rely on the software programs to perform such treatment comparisons and obtain plots for multiple comparison; see @fig-hsdplot. Note that we used the <span class="in">`par()`</span> function because the Y-axis labels are bit long.</span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hsdplot</span></span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Tukey HSD plot'</span></span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="dv">9</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(oneway.model), <span class="at">las=</span><span class="dv">1</span> , <span class="at">col=</span><span class="st">"brown"</span>)</span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a><span class="fu"># Assumptions and Transformations</span></span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a>For the one way ANOVA, it is assumed that the burn time variances for each treatment are the same. Although we can never be sure whether assumptions are valid, we can look for indications that the assumptions may not be realistic.</span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a>The sample standard deviations of the treatment groups could be plotted against the sample means of the treatment groups. For the fabric example the means and standard deviations of the fabrics are given below.</span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a>| summary                  | Fabric 1 | Fabric 2 | Fabric 3 | Fabric 4 |</span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a>|:-------------------------|:---------|:---------|---------:|---------:|</span>
<span id="cb52-233"><a href="#cb52-233" aria-hidden="true" tabindex="-1"></a>| Mean $\bar {y}_i$        | 16.78    | 11.76    |    10.24 |    11.98 |</span>
<span id="cb52-234"><a href="#cb52-234" aria-hidden="true" tabindex="-1"></a>| Standard deviation $S_i$ | 1.167    | 2.330    |    1.144 |    1.862 |</span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-meansd</span></span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'SD vs mean for four fabrics'</span></span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(burntime),</span>
<span id="cb52-247"><a href="#cb52-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(burntime)</span>
<span id="cb52-248"><a href="#cb52-248" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb52-249"><a href="#cb52-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-250"><a href="#cb52-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> sd, <span class="at">group =</span> <span class="fu">factor</span>(<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a>The plot of SD vs. mean is shown in @fig-meansd. With only four fabrics in the sample, it is difficult to make any definitive claim. If the assumptions were valid, we would expect the four points to fall approximately along a horizontal band indicating constant standard deviations, and hence variances, regardless of the means of the groups. @fig-meansd suggests that this is the case, so the assumption of equal variances appears to be valid.</span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a>A formal test for equal variances may also be performed. In **Bartlett's test**, the null hypothesis of equal variances is tested. This test requires the response variable to be normally distributed where as the alternative test known as the **Levene's test** is applicable for any continuous distribution. The $p$-value for the Bartlett's test for the fabric data is 0.447. This suggests that the null hypothesis of equal variances for the four fabric burn times be accepted.</span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, warnings=FALSE}</span></span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a><span class="fu">bartlett.test</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-261"><a href="#cb52-261" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(burntime <span class="sc">~</span> Fabric, <span class="at">data =</span> fabric)</span>
<span id="cb52-262"><a href="#cb52-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-263"><a href="#cb52-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-264"><a href="#cb52-264" aria-hidden="true" tabindex="-1"></a>If the standard deviations seem to be increasing with the means, a transformation such as the square root or logarithm could be tried. The comments of chapter 4 also apply to the one way ANOVA. However, before performing such a data transformation it is important that the data be checked for outliers. Outliers may inflate the standard deviation for one or more treatments. Such outliers should be checked for accuracy. Even when there is no obvious reason for an outlier, it is probably best to delete such a value if it is obvious that this value is causing a major distortion of the data. This will make our data unbalanced, but that does not matter for one way ANOVA.</span>
<span id="cb52-265"><a href="#cb52-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-266"><a href="#cb52-266" aria-hidden="true" tabindex="-1"></a>The $F$ statistic is based on the null hypothesis that there is no difference (in the population) between treatment means. As we have noted before, a large value of $F$ would indicate that the null hypothesis is not valid and that differences between treatments do exist. However, if the variances for the different treatments vary considerably, then this test is no longer valid.</span>
<span id="cb52-267"><a href="#cb52-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-268"><a href="#cb52-268" aria-hidden="true" tabindex="-1"></a><span class="fu"># Two-Way ANOVA</span></span>
<span id="cb52-269"><a href="#cb52-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-270"><a href="#cb52-270" aria-hidden="true" tabindex="-1"></a>We discuss **two-way ANOVA** model using the following example. The strength of concrete ($Y$, measured in MPa) is affected by the type of aggregate (stone, a blocking variable) and the type of cement (the treatment factor) used. An experiment was conducted in order to investigate the effect of aggregate and cement on concrete strength. In all other respects the concrete was the same. That is, same mixing ratios, the same water and the same mixing procedure was used. Ignoring any interaction between aggregate and cement the following model is to be fitted to the data:</span>
<span id="cb52-271"><a href="#cb52-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-272"><a href="#cb52-272" aria-hidden="true" tabindex="-1"></a>fitted = overall effect + aggregate effect + cement effect.</span>
<span id="cb52-273"><a href="#cb52-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-274"><a href="#cb52-274" aria-hidden="true" tabindex="-1"></a>A single testing was done for each cement and each aggregate, producing the balanced set of results shown in @tbl-concretedata.</span>
<span id="cb52-275"><a href="#cb52-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-278"><a href="#cb52-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-279"><a href="#cb52-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb52-280"><a href="#cb52-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-281"><a href="#cb52-281" aria-hidden="true" tabindex="-1"></a>concrete <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/concrete.txt"</span>,</span>
<span id="cb52-282"><a href="#cb52-282" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_types =</span> <span class="st">"dff"</span>) <span class="co"># double, factor, factor</span></span>
<span id="cb52-283"><a href="#cb52-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-284"><a href="#cb52-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-285"><a href="#cb52-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-288"><a href="#cb52-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-289"><a href="#cb52-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-concretedata</span></span>
<span id="cb52-290"><a href="#cb52-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Concrete strength data"</span></span>
<span id="cb52-291"><a href="#cb52-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-292"><a href="#cb52-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-293"><a href="#cb52-293" aria-hidden="true" tabindex="-1"></a>concrete <span class="sc">|&gt;</span> <span class="fu">kable</span>() </span>
<span id="cb52-294"><a href="#cb52-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-295"><a href="#cb52-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-296"><a href="#cb52-296" aria-hidden="true" tabindex="-1"></a>In @fig-6-8, the computation of row (cement) and column (Aggregate) effects is explained. Clearly the rows correspond to the four cements and the columns correspond to the three aggregates.</span>
<span id="cb52-297"><a href="#cb52-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-298"><a href="#cb52-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-299"><a href="#cb52-299" aria-hidden="true" tabindex="-1"></a><span class="al">![Explanation  of row and column factor effects](images/6-8.png)</span>{#fig-6-8}</span>
<span id="cb52-300"><a href="#cb52-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-301"><a href="#cb52-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-302"><a href="#cb52-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-303"><a href="#cb52-303" aria-hidden="true" tabindex="-1"></a>The **row effect** is taken as the additional row effect after the overall value 14.42 has been fitted. Similarly the **column effect** is taken as the additional column effect after the overall value has been fitted. Note the following points:</span>
<span id="cb52-304"><a href="#cb52-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-305"><a href="#cb52-305" aria-hidden="true" tabindex="-1"></a>a.: Overall value is the overall mean, 14.42.</span>
<span id="cb52-306"><a href="#cb52-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-307"><a href="#cb52-307" aria-hidden="true" tabindex="-1"></a>b.: The row effect for Row 1 is $12-14.42 = -2.42$. In other words, the row effect is the row mean minus the overall mean. The column effects are calculated similarly.</span>
<span id="cb52-308"><a href="#cb52-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-309"><a href="#cb52-309" aria-hidden="true" tabindex="-1"></a>c.: The row effects add to zero, although in practice, as in this example, there is some rounding error. Likewise, the column effects add to zero. If the data were not balanced the effects would not necessarily add to zero.</span>
<span id="cb52-310"><a href="#cb52-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-311"><a href="#cb52-311" aria-hidden="true" tabindex="-1"></a>d.: In each cell, fitted values and residuals could be calculated. For example, for cell (1, 1), we obtain the fitted value as $14.42 + (-2.42) + (-8.92) = 3.08$. Hence,</span>
<span id="cb52-312"><a href="#cb52-312" aria-hidden="true" tabindex="-1"></a>residual = observed-fitted $= 4-3.08 = 0.92$.</span>
<span id="cb52-313"><a href="#cb52-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-314"><a href="#cb52-314" aria-hidden="true" tabindex="-1"></a>**ANOVA** tables are a tidy way of writing down the sums of squares, degrees of freedom and mean squares. We are basically concerned with the variation in the dependent variable about its mean and the amount of this variation explained by the explanatory variables, which in this case are the row and column effects. In the SS column in the ANOVA table we break down the total variation according to its source, namely ROWS, COLUMNS and ERROR.</span>
<span id="cb52-315"><a href="#cb52-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-316"><a href="#cb52-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-317"><a href="#cb52-317" aria-hidden="true" tabindex="-1"></a><span class="al">![Formation of ANOVA table](images/6-9.png)</span>{#fig-6-9}</span>
<span id="cb52-318"><a href="#cb52-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-319"><a href="#cb52-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-320"><a href="#cb52-320" aria-hidden="true" tabindex="-1"></a>In the ANOVA table, (given as @fig-6-9) the number of rows is denoted by $r$ and the number of columns is denoted by $c$. The Error degrees of freedom are obtained by subtracting the ROW and COLUMN degrees of freedom from the total degrees of freedom. The mean squares are obtained by dividing the sums of squares by their respective degrees of freedom. Note that 118.27 (Mean Square corresponding to Total) is the variance of the original observations.</span>
<span id="cb52-321"><a href="#cb52-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-322"><a href="#cb52-322" aria-hidden="true" tabindex="-1"></a>The <span class="in">`R`</span> output for the two-way ANOVA fit is given below. The entries relating to TOTAL are not displayed in <span class="in">`R`</span>.</span>
<span id="cb52-323"><a href="#cb52-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-324"><a href="#cb52-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb52-325"><a href="#cb52-325" aria-hidden="true" tabindex="-1"></a>additive.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(Strength <span class="sc">~</span> Cement <span class="sc">+</span> Aggregate, <span class="at">data =</span> concrete)</span>
<span id="cb52-326"><a href="#cb52-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-327"><a href="#cb52-327" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(additive.model)</span>
<span id="cb52-328"><a href="#cb52-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-329"><a href="#cb52-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-330"><a href="#cb52-330" aria-hidden="true" tabindex="-1"></a>Clearly a large variance (MS) for the rows (<span class="in">`Cement`</span>) would suggest a significant difference between the <span class="in">`Cement`</span>-group means and a large variance (MS) for the columns (<span class="in">`Aggregate`</span>) would suggest a significant difference between the <span class="in">`Aggregate`</span>-group means.</span>
<span id="cb52-331"><a href="#cb52-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-332"><a href="#cb52-332" aria-hidden="true" tabindex="-1"></a>To test whether a factor has a significant influence, we calculate the $F$ test statistic. As before, this statistic is the ratio of two mean squares. Hence, to test whether the rows have the same means in the population (i.e., there's no "row effect"), the $F$ statistic is $$F = \frac{\text{Row MS}}{\text{Error MS}}$$ with the corresponding numerator and denominator degrees of freedom. Likewise, to test whether the columns have the same means in the population (i.e., there's no "coumn effect"), the $F$ statistic is $$F = \frac{\text{Column MS}}{\text{Error MS}}$$ with the corresponding numerator and denominator degrees of freedom.</span>
<span id="cb52-333"><a href="#cb52-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-334"><a href="#cb52-334" aria-hidden="true" tabindex="-1"></a>To test the significance of the <span class="in">`Cement`</span> effect, $$F = \frac{11.64}{7.97} = 1.5$$ with 3 and 6 d.f. Not significant. To test the significance of the <span class="in">`Aggregate`</span> effect, $$F = \frac{609.08}{7.97}= 76.4$$ with 2 and 6 d.f. Very significant.</span>
<span id="cb52-335"><a href="#cb52-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-336"><a href="#cb52-336" aria-hidden="true" tabindex="-1"></a>These results wouldn't be surprising to us had we explored the mean concrete strength for the 3 levels of <span class="in">`Aggregate`</span> and 4 levels of <span class="in">`Cement`</span> as shown in @fig-main2, which are connected by a line, is known as the **main effects** plot.</span>
<span id="cb52-337"><a href="#cb52-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-340"><a href="#cb52-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-341"><a href="#cb52-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-342"><a href="#cb52-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-main2</span></span>
<span id="cb52-343"><a href="#cb52-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Main effects plots'</span></span>
<span id="cb52-344"><a href="#cb52-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-345"><a href="#cb52-345" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> concrete <span class="sc">|&gt;</span> </span>
<span id="cb52-346"><a href="#cb52-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Cement) <span class="sc">|&gt;</span> </span>
<span id="cb52-347"><a href="#cb52-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Strength)) <span class="sc">|&gt;</span> </span>
<span id="cb52-348"><a href="#cb52-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-349"><a href="#cb52-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Mean, </span>
<span id="cb52-350"><a href="#cb52-350" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Cement) <span class="sc">+</span> </span>
<span id="cb52-351"><a href="#cb52-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-352"><a href="#cb52-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-353"><a href="#cb52-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cement"</span>) <span class="sc">+</span></span>
<span id="cb52-354"><a href="#cb52-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Cement"</span>) <span class="sc">+</span></span>
<span id="cb52-355"><a href="#cb52-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(concrete<span class="sc">$</span>Strength), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb52-356"><a href="#cb52-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">5</span>,<span class="dv">30</span>)</span>
<span id="cb52-357"><a href="#cb52-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-358"><a href="#cb52-358" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> concrete <span class="sc">|&gt;</span> </span>
<span id="cb52-359"><a href="#cb52-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Aggregate) <span class="sc">|&gt;</span> </span>
<span id="cb52-360"><a href="#cb52-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Strength)) <span class="sc">|&gt;</span> </span>
<span id="cb52-361"><a href="#cb52-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-362"><a href="#cb52-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Mean, </span>
<span id="cb52-363"><a href="#cb52-363" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Aggregate) <span class="sc">+</span></span>
<span id="cb52-364"><a href="#cb52-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-365"><a href="#cb52-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-366"><a href="#cb52-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Aggregate"</span>) <span class="sc">+</span></span>
<span id="cb52-367"><a href="#cb52-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Aggregate"</span>) <span class="sc">+</span> </span>
<span id="cb52-368"><a href="#cb52-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(concrete<span class="sc">$</span>Strength), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb52-369"><a href="#cb52-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">5</span>,<span class="dv">30</span>)</span>
<span id="cb52-370"><a href="#cb52-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-371"><a href="#cb52-371" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb52-372"><a href="#cb52-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-373"><a href="#cb52-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-374"><a href="#cb52-374" aria-hidden="true" tabindex="-1"></a><span class="fu"># Two Way ANOVA with Interaction</span></span>
<span id="cb52-375"><a href="#cb52-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-376"><a href="#cb52-376" aria-hidden="true" tabindex="-1"></a>@Brook provided the following data from a milk mixing time experiment.</span>
<span id="cb52-377"><a href="#cb52-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-380"><a href="#cb52-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-381"><a href="#cb52-381" aria-hidden="true" tabindex="-1"></a>paddle <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb52-382"><a href="#cb52-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">Speed =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">150</span>, </span>
<span id="cb52-383"><a href="#cb52-383" aria-hidden="true" tabindex="-1"></a>            <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">70</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">150</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb52-384"><a href="#cb52-384" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diameter =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, </span>
<span id="cb52-385"><a href="#cb52-385" aria-hidden="true" tabindex="-1"></a>               <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb52-386"><a href="#cb52-386" aria-hidden="true" tabindex="-1"></a>  <span class="at">MixTime =</span> <span class="fu">c</span>(<span class="dv">1490</span>,<span class="dv">780</span>,<span class="dv">825</span>,<span class="dv">575</span>,<span class="dv">385</span>,<span class="dv">315</span>,<span class="dv">195</span>,<span class="dv">117</span>,<span class="dv">225</span>,</span>
<span id="cb52-387"><a href="#cb52-387" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1100</span>,<span class="dv">620</span>,<span class="dv">690</span>,<span class="dv">480</span>,<span class="dv">385</span>,<span class="dv">400</span>,<span class="dv">230</span>,<span class="dv">190</span>,<span class="dv">145</span>)</span>
<span id="cb52-388"><a href="#cb52-388" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-389"><a href="#cb52-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-390"><a href="#cb52-390" aria-hidden="true" tabindex="-1"></a>paddle</span>
<span id="cb52-391"><a href="#cb52-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-392"><a href="#cb52-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-393"><a href="#cb52-393" aria-hidden="true" tabindex="-1"></a>When whole milk is left standing in a vat, the cream rises to the top, making sampling difficult. A rotating paddle can be used to mix the milk, but too much mixing can damage it. The aim of the experiment was to see how paddle size and speed of rotation affect the optimum mixing time. There were two independent runs at three levels of both speed and paddle size. The data are set out in a two way table in which the rows and columns relate to different speeds and diameters of the paddle. Again, we have balanced data in that the same number of measurements occur in each cell of the table. The experimental data may be treated as separate one way ANOVAs for the Rotational Speed or Paddle Diameter as shown below:</span>
<span id="cb52-394"><a href="#cb52-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-397"><a href="#cb52-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-398"><a href="#cb52-398" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed, <span class="at">data =</span> paddle) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb52-399"><a href="#cb52-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-400"><a href="#cb52-400" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(MixTime <span class="sc">~</span> Diameter, <span class="at">data =</span> paddle) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb52-401"><a href="#cb52-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-402"><a href="#cb52-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-403"><a href="#cb52-403" aria-hidden="true" tabindex="-1"></a>Clearly, the rotational speed has more influence than diameter of paddle on optimum mixture time ($p = 0.000$ for Rotational Speed while $p = 0.397$ for Paddle Diameter). Note that the true effect of Paddle Diameter may be masked due to the overestimate of the Error under the (incorrect) one-way ANOVA model. The mean mixing time is obviously higher for a Rotational Speed of 70 rpm, whereas Paddle Diameter appears to have a little effect on the mixing time (see @fig-mainmixtime).</span>
<span id="cb52-404"><a href="#cb52-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-407"><a href="#cb52-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-408"><a href="#cb52-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mainmixtime</span></span>
<span id="cb52-409"><a href="#cb52-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Main effects plots'</span></span>
<span id="cb52-410"><a href="#cb52-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-411"><a href="#cb52-411" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb52-412"><a href="#cb52-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Speed) <span class="sc">|&gt;</span> </span>
<span id="cb52-413"><a href="#cb52-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(MixTime)) <span class="sc">|&gt;</span> </span>
<span id="cb52-414"><a href="#cb52-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-415"><a href="#cb52-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> Speed) <span class="sc">+</span></span>
<span id="cb52-416"><a href="#cb52-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-417"><a href="#cb52-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-418"><a href="#cb52-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Speed"</span>) <span class="sc">+</span> </span>
<span id="cb52-419"><a href="#cb52-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Speed"</span>) <span class="sc">+</span></span>
<span id="cb52-420"><a href="#cb52-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(paddle<span class="sc">$</span>MixTime), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb52-421"><a href="#cb52-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">150</span>,<span class="dv">1000</span>)</span>
<span id="cb52-422"><a href="#cb52-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-423"><a href="#cb52-423" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb52-424"><a href="#cb52-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Diameter) <span class="sc">|&gt;</span> </span>
<span id="cb52-425"><a href="#cb52-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(MixTime)) <span class="sc">|&gt;</span> </span>
<span id="cb52-426"><a href="#cb52-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-427"><a href="#cb52-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> Diameter) <span class="sc">+</span></span>
<span id="cb52-428"><a href="#cb52-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-429"><a href="#cb52-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-430"><a href="#cb52-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Diameter"</span>) <span class="sc">+</span> </span>
<span id="cb52-431"><a href="#cb52-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effects plot of Diameter"</span>) <span class="sc">+</span></span>
<span id="cb52-432"><a href="#cb52-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(paddle<span class="sc">$</span>MixTime), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb52-433"><a href="#cb52-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">150</span>,<span class="dv">1000</span>)</span>
<span id="cb52-434"><a href="#cb52-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-435"><a href="#cb52-435" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb52-436"><a href="#cb52-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-437"><a href="#cb52-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-438"><a href="#cb52-438" aria-hidden="true" tabindex="-1"></a>The <span class="in">`visreg`</span> package is useful for automatically plotting linear models, including ANOVA.</span>
<span id="cb52-439"><a href="#cb52-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-442"><a href="#cb52-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-443"><a href="#cb52-443" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb52-444"><a href="#cb52-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-445"><a href="#cb52-445" aria-hidden="true" tabindex="-1"></a>aovs <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed, <span class="at">data =</span> paddle)</span>
<span id="cb52-446"><a href="#cb52-446" aria-hidden="true" tabindex="-1"></a>aovd <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb52-447"><a href="#cb52-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-448"><a href="#cb52-448" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> aovs <span class="sc">|&gt;</span> </span>
<span id="cb52-449"><a href="#cb52-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">gg=</span>T) <span class="sc">+</span></span>
<span id="cb52-450"><a href="#cb52-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">10</span>,<span class="dv">1200</span>)</span>
<span id="cb52-451"><a href="#cb52-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-452"><a href="#cb52-452" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> aovd <span class="sc">|&gt;</span> </span>
<span id="cb52-453"><a href="#cb52-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">gg=</span>T) <span class="sc">+</span></span>
<span id="cb52-454"><a href="#cb52-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">10</span>,<span class="dv">1200</span>)</span>
<span id="cb52-455"><a href="#cb52-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-456"><a href="#cb52-456" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb52-457"><a href="#cb52-457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-458"><a href="#cb52-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-459"><a href="#cb52-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-460"><a href="#cb52-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-461"><a href="#cb52-461" aria-hidden="true" tabindex="-1"></a>Whether the effect of Speed on mixing time is **independent** of the paddle diameter or not cannot be explored using the above plot. We can explore interactions graphically using **interaction plots**, as shown in @fig-intplot1.</span>
<span id="cb52-462"><a href="#cb52-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-465"><a href="#cb52-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-466"><a href="#cb52-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-467"><a href="#cb52-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb52-468"><a href="#cb52-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-intplot1</span></span>
<span id="cb52-469"><a href="#cb52-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Speed*Diameter interaction plot'</span></span>
<span id="cb52-470"><a href="#cb52-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb52-471"><a href="#cb52-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-472"><a href="#cb52-472" aria-hidden="true" tabindex="-1"></a>pmeans <span class="ot">&lt;-</span> paddle <span class="sc">|&gt;</span> </span>
<span id="cb52-473"><a href="#cb52-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Speed, Diameter) <span class="sc">|&gt;</span> </span>
<span id="cb52-474"><a href="#cb52-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MixTime =</span> <span class="fu">mean</span>(MixTime))</span>
<span id="cb52-475"><a href="#cb52-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-476"><a href="#cb52-476" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> pmeans <span class="sc">|&gt;</span> </span>
<span id="cb52-477"><a href="#cb52-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Speed, MixTime)) <span class="sc">+</span></span>
<span id="cb52-478"><a href="#cb52-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">group =</span> Diameter, <span class="at">color =</span> Diameter)) <span class="sc">+</span></span>
<span id="cb52-479"><a href="#cb52-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> Diameter))<span class="sc">+</span></span>
<span id="cb52-480"><a href="#cb52-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set1"</span>)</span>
<span id="cb52-481"><a href="#cb52-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-482"><a href="#cb52-482" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> pmeans <span class="sc">|&gt;</span> </span>
<span id="cb52-483"><a href="#cb52-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Diameter, MixTime)) <span class="sc">+</span></span>
<span id="cb52-484"><a href="#cb52-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">group =</span> Speed, <span class="at">color =</span> Speed)) <span class="sc">+</span></span>
<span id="cb52-485"><a href="#cb52-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> Speed)) <span class="sc">+</span></span>
<span id="cb52-486"><a href="#cb52-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb52-487"><a href="#cb52-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-488"><a href="#cb52-488" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb52-489"><a href="#cb52-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-490"><a href="#cb52-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-491"><a href="#cb52-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-492"><a href="#cb52-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-493"><a href="#cb52-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-494"><a href="#cb52-494" aria-hidden="true" tabindex="-1"></a>In @fig-intplot1, the mean mixing times have been plotted and connected for all factor level combinations. In the first plot, we've put <span class="in">`Speed`</span> on the x-axis and coloured the points and lines by <span class="in">`Diameter`</span>, and then swapped the roles. The lines in the interaction plots are not parallel. This suggests that the effect of rotational speed is determined, to some extent, by the effect of paddle diameter (and vice versa). In other words, the effect of rotational speed on mixing time is not the same for the various levels of paddle diameter. </span>
<span id="cb52-495"><a href="#cb52-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-496"><a href="#cb52-496" aria-hidden="true" tabindex="-1"></a>These interaction plots suggest that we should allow for an interaction term in our Two-Way ANOVA model. </span>
<span id="cb52-497"><a href="#cb52-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-498"><a href="#cb52-498" aria-hidden="true" tabindex="-1"></a>A *two-way ANOVA interaction model* is of the form</span>
<span id="cb52-499"><a href="#cb52-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-500"><a href="#cb52-500" aria-hidden="true" tabindex="-1"></a>fit = overall mean + row effect + column effect + (row$\times$column effect).</span>
<span id="cb52-501"><a href="#cb52-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-502"><a href="#cb52-502" aria-hidden="true" tabindex="-1"></a>This model has been fitted to mixing times using <span class="in">`R`</span> below. Note the syntax <span class="in">`*`</span> which fits both the interaction and main effect terms.</span>
<span id="cb52-503"><a href="#cb52-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-506"><a href="#cb52-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-507"><a href="#cb52-507" aria-hidden="true" tabindex="-1"></a>aovdsx <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed <span class="sc">*</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb52-508"><a href="#cb52-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-509"><a href="#cb52-509" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aovdsx)</span>
<span id="cb52-510"><a href="#cb52-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-511"><a href="#cb52-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-512"><a href="#cb52-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-513"><a href="#cb52-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-514"><a href="#cb52-514" aria-hidden="true" tabindex="-1"></a>With this model object, we can make interaction plots automatically using <span class="in">`visreg`</span> (@fig-intplot1b).</span>
<span id="cb52-515"><a href="#cb52-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-516"><a href="#cb52-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-519"><a href="#cb52-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-520"><a href="#cb52-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-521"><a href="#cb52-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-intplot1b</span></span>
<span id="cb52-522"><a href="#cb52-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Speed * Diameter interaction plot from visreg'</span></span>
<span id="cb52-523"><a href="#cb52-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-524"><a href="#cb52-524" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(aovdsx, <span class="st">"Speed"</span>, <span class="at">by =</span> <span class="st">"Diameter"</span>, <span class="at">gg=</span>T) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb52-525"><a href="#cb52-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-526"><a href="#cb52-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-527"><a href="#cb52-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-528"><a href="#cb52-528" aria-hidden="true" tabindex="-1"></a>Note that the interaction effect is tested by comparing the **interaction** (i.e. Speed$\times$Diameter) MS against the residual (i.e. Error) MS using an $F$ statistic with 4 and 9 degrees of freedom (i.e. $F$ = 4.11). This $F$-value exceeds the tabulated value 3.63 at the 5% level, so that this interaction effect is significant at the 5% level (also note that the corresponding $p$-value is smaller than 0.05). In other words, there is evidence that the row effects (i.e. *Speed effects*) are NOT constant over columns (i.e. *Diameters*), or the column effects are not constant over rows.</span>
<span id="cb52-529"><a href="#cb52-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-530"><a href="#cb52-530" aria-hidden="true" tabindex="-1"></a>The degrees of freedom, d.f., for the numerator, 4, is the product of 2 times 2.</span>
<span id="cb52-531"><a href="#cb52-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-532"><a href="#cb52-532" aria-hidden="true" tabindex="-1"></a>d.f.(rows$\times$columns) = d.f.(rows)$\times$ d.f.(columns)</span>
<span id="cb52-533"><a href="#cb52-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-534"><a href="#cb52-534" aria-hidden="true" tabindex="-1"></a>The error degrees of freedom are obtained by subtraction. That is</span>
<span id="cb52-535"><a href="#cb52-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-536"><a href="#cb52-536" aria-hidden="true" tabindex="-1"></a>d.f.(Error) = d.f.(Total)-d.f.(rows)-d.f.(column)-d.f.(rows$\times$columns) $= (n-1)-(r-1)-(c-1)-(r-1)\times (c-1)= 17- 2-2-4 = 9.$</span>
<span id="cb52-537"><a href="#cb52-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-538"><a href="#cb52-538" aria-hidden="true" tabindex="-1"></a>If it could be assumed that the interaction between rows and columns was not large, an **additive (non-interaction)** model could be fitted, namely</span>
<span id="cb52-539"><a href="#cb52-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-540"><a href="#cb52-540" aria-hidden="true" tabindex="-1"></a>observed = fit + residual = (overall mean + row effect + column effect) + e.</span>
<span id="cb52-541"><a href="#cb52-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-542"><a href="#cb52-542" aria-hidden="true" tabindex="-1"></a>Consider the additive ANOVA model fitted below. Note the syntax <span class="in">`+`</span> which fits only the main effect terms.</span>
<span id="cb52-543"><a href="#cb52-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-544"><a href="#cb52-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-547"><a href="#cb52-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-548"><a href="#cb52-548" aria-hidden="true" tabindex="-1"></a>aovds <span class="ot">&lt;-</span> <span class="fu">aov</span>(MixTime <span class="sc">~</span> Speed <span class="sc">+</span> Diameter, <span class="at">data =</span> paddle)</span>
<span id="cb52-549"><a href="#cb52-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-550"><a href="#cb52-550" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aovds)</span>
<span id="cb52-551"><a href="#cb52-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-552"><a href="#cb52-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-553"><a href="#cb52-553" aria-hidden="true" tabindex="-1"></a>Notice that the degrees of freedom for the error term in the additive model is the sum of the d.f. for error and interaction. Similarly,</span>
<span id="cb52-554"><a href="#cb52-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-555"><a href="#cb52-555" aria-hidden="true" tabindex="-1"></a>SS (Error) of Additive Model = SS (Interaction) + SS (Error) of Interaction Model.</span>
<span id="cb52-556"><a href="#cb52-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-557"><a href="#cb52-557" aria-hidden="true" tabindex="-1"></a>Notice that if there was only **ONE** observation in each cell, it would not be possible to test for the significance of an interaction. This is the case with the two-way ANOVA we considered in the previous section (see concrete strength ANOVA output).</span>
<span id="cb52-558"><a href="#cb52-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-559"><a href="#cb52-559" aria-hidden="true" tabindex="-1"></a>The mixtime experimental setup is known as a factorial design where the factor levels are crossed to form the treatments. The treatments are usually completely randomised. When factor levels are quantitative, we can also fit a regression model. The set levels of Speed and Diameter are quantitative. So we can regress the mixing time on the speed and diameter levels. The advantage with this approach is that we will be able to fit a *response surface* of mixing time so that we can look for optimum settings on some cost or practical grounds. @fig-rsmplot shows the contour plot of the regression (response) surface of mixing time. This plot suggests that both speed and diameter must be set at higher levels in general to reduce the mixing time. But we can choose practically convenient settings such as higher speed but smaller diameter. The curvature in the contour plot is due to the interaction effect but it tends to be smaller at higher speeds. The text by @box2005statistics contains many examples on using experimental designs for response surface optimisation.</span>
<span id="cb52-560"><a href="#cb52-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-563"><a href="#cb52-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-564"><a href="#cb52-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-565"><a href="#cb52-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-rsmplot</span></span>
<span id="cb52-566"><a href="#cb52-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: '2d contour visreg plot of mixing time'</span></span>
<span id="cb52-567"><a href="#cb52-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-568"><a href="#cb52-568" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg2d</span>(aovdsx, <span class="st">"Speed"</span>, <span class="st">"Diameter"</span>)</span>
<span id="cb52-569"><a href="#cb52-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-570"><a href="#cb52-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-571"><a href="#cb52-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-572"><a href="#cb52-572" aria-hidden="true" tabindex="-1"></a><span class="fu"># Indicator Variables</span></span>
<span id="cb52-573"><a href="#cb52-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-574"><a href="#cb52-574" aria-hidden="true" tabindex="-1"></a>Indicator variable (also known as a dummy or binary variable) is one whose possible values are either 1 or zero. A value of 1 means a particular attribute or characteristic is present and a value of zero means the absence. For example, we may define indicator variables for males and females. Consider- Indicator variable for the male category $$\begin{array}{cccc}</span>
<span id="cb52-575"><a href="#cb52-575" aria-hidden="true" tabindex="-1"></a>I_{\text {male}} &amp; = &amp; 1 &amp; \text{for males}<span class="sc">\\</span></span>
<span id="cb52-576"><a href="#cb52-576" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for females}</span>
<span id="cb52-577"><a href="#cb52-577" aria-hidden="true" tabindex="-1"></a>\end{array}$$</span>
<span id="cb52-578"><a href="#cb52-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-579"><a href="#cb52-579" aria-hidden="true" tabindex="-1"></a>Indicator variable for the female category $$\begin{array}{cccc}</span>
<span id="cb52-580"><a href="#cb52-580" aria-hidden="true" tabindex="-1"></a>I_{\text{female}} &amp; = &amp; 1 &amp; \text{for females}<span class="sc">\\</span></span>
<span id="cb52-581"><a href="#cb52-581" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for males}</span>
<span id="cb52-582"><a href="#cb52-582" aria-hidden="true" tabindex="-1"></a>\end{array}$$</span>
<span id="cb52-583"><a href="#cb52-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-584"><a href="#cb52-584" aria-hidden="true" tabindex="-1"></a>In order identify the gender category, we either need either $I_{male}$ or $I_{female}$ and not both. This is because for the two gender categories, we have only a single degree of freedom. Using indicator variables, we will be able to include categorical predictors in a regression model. It is also possible to approach the ANOVA test for equality of means through linear regression.</span>
<span id="cb52-585"><a href="#cb52-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-586"><a href="#cb52-586" aria-hidden="true" tabindex="-1"></a>Consider the fabric burn time data discussed earlier. For the four fabric types, we define the following four indicator variables,</span>
<span id="cb52-587"><a href="#cb52-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-588"><a href="#cb52-588" aria-hidden="true" tabindex="-1"></a>$$\begin{array}{cccc}</span>
<span id="cb52-589"><a href="#cb52-589" aria-hidden="true" tabindex="-1"></a>I_1 &amp; = &amp; 1 &amp; \text{for Fabric 1}<span class="sc">\\</span></span>
<span id="cb52-590"><a href="#cb52-590" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Fabric 2, 3 and 4}</span>
<span id="cb52-591"><a href="#cb52-591" aria-hidden="true" tabindex="-1"></a>\end{array}$$ $$\begin{array}{cccc}</span>
<span id="cb52-592"><a href="#cb52-592" aria-hidden="true" tabindex="-1"></a>I_2 &amp; = &amp; 1 &amp; \text{for Fabric 2}<span class="sc">\\</span></span>
<span id="cb52-593"><a href="#cb52-593" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Fabric 1, 3 and 4}</span>
<span id="cb52-594"><a href="#cb52-594" aria-hidden="true" tabindex="-1"></a>\end{array}$$ $$\begin{array}{cccc}</span>
<span id="cb52-595"><a href="#cb52-595" aria-hidden="true" tabindex="-1"></a>I_3 &amp; = &amp; 1 &amp; \text{for Fabric 3}<span class="sc">\\</span></span>
<span id="cb52-596"><a href="#cb52-596" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Fabric 1, 2 and 4}</span>
<span id="cb52-597"><a href="#cb52-597" aria-hidden="true" tabindex="-1"></a>\end{array}$$ $$\begin{array}{cccc}</span>
<span id="cb52-598"><a href="#cb52-598" aria-hidden="true" tabindex="-1"></a>I_4 &amp; = &amp; 1 &amp; \text{for Fabric 4}<span class="sc">\\</span></span>
<span id="cb52-599"><a href="#cb52-599" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Fabric 1, 2 and 3}</span>
<span id="cb52-600"><a href="#cb52-600" aria-hidden="true" tabindex="-1"></a>\end{array}$$</span>
<span id="cb52-601"><a href="#cb52-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-602"><a href="#cb52-602" aria-hidden="true" tabindex="-1"></a>Note that we need only any three of the above indicator variables to identify the fabric category. For example, with $I_1$, $I_2$, and $I_3$ variables, fabric 4 is identified when $I_1 = I_2 = I_3 = 0$. See @tbl-invartab.</span>
<span id="cb52-603"><a href="#cb52-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-604"><a href="#cb52-604" aria-hidden="true" tabindex="-1"></a>Let us regress the burn times on the indicator variables $I_1$, $I_2$ and $I_3$.</span>
<span id="cb52-605"><a href="#cb52-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-608"><a href="#cb52-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-609"><a href="#cb52-609" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-610"><a href="#cb52-610" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb52-611"><a href="#cb52-611" aria-hidden="true" tabindex="-1"></a>fabric <span class="ot">&lt;-</span> fabric <span class="sc">|&gt;</span> </span>
<span id="cb52-612"><a href="#cb52-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(burntime, Fabric) <span class="sc">|&gt;</span> </span>
<span id="cb52-613"><a href="#cb52-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 1"</span>),</span>
<span id="cb52-614"><a href="#cb52-614" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 2"</span>),</span>
<span id="cb52-615"><a href="#cb52-615" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 3"</span>),</span>
<span id="cb52-616"><a href="#cb52-616" aria-hidden="true" tabindex="-1"></a>         <span class="at">I4 =</span> <span class="fu">as.numeric</span>(Fabric<span class="sc">==</span><span class="st">"Fabric 4"</span>)</span>
<span id="cb52-617"><a href="#cb52-617" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-618"><a href="#cb52-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-619"><a href="#cb52-619" aria-hidden="true" tabindex="-1"></a>fabric</span>
<span id="cb52-620"><a href="#cb52-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-621"><a href="#cb52-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-624"><a href="#cb52-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-625"><a href="#cb52-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-626"><a href="#cb52-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-invartab</span></span>
<span id="cb52-627"><a href="#cb52-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Indicators of Fabrics"</span></span>
<span id="cb52-628"><a href="#cb52-628" aria-hidden="true" tabindex="-1"></a>fabric <span class="sc">|&gt;</span> </span>
<span id="cb52-629"><a href="#cb52-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span>
<span id="cb52-630"><a href="#cb52-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-631"><a href="#cb52-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-632"><a href="#cb52-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb52-633"><a href="#cb52-633" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(burntime <span class="sc">~</span> I1 <span class="sc">+</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> fabric)</span>
<span id="cb52-634"><a href="#cb52-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-635"><a href="#cb52-635" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb52-636"><a href="#cb52-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-637"><a href="#cb52-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-638"><a href="#cb52-638" aria-hidden="true" tabindex="-1"></a>The following points are to be noted on the above regression model:</span>
<span id="cb52-639"><a href="#cb52-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-640"><a href="#cb52-640" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The $y$-intercept 11.98 is the mean burn time of the fourth fabric (i.e. the mean response for the omitted predictor category).</span>
<span id="cb52-641"><a href="#cb52-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-642"><a href="#cb52-642" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The mean burn time of fabrics 1, 2 and 3 can be found from the fitted model. For fabric 1, $I_1$ =1, $I_2$=0, and $I_3$ =0. Substituting these values in the fitted model, we get $11.98 + 4.80\times 1 - 0.22\times 0 - 1.74\times 0 = 12+4.8 = 16.78$, which is mean burn time of fabric 1. For fabric 2, the mean burn time is $11.98 + 4.80\times 0 - 0.22\times 1 - 1.74\times 0 = 11.76$. For fabric 3, the mean burn time is $11.98 + 4.80\times 0 - 0.22\times 0 - 1.74\times 1 = 10.24$. In other words, the fitted coefficient of an indicator variable is the difference between the response means of the category indicated by the variable and the 'base' category (indicated by the omitted indicator variable).</span>
<span id="cb52-643"><a href="#cb52-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-644"><a href="#cb52-644" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The significance of the slope coefficients implies a significant difference in means. For example, the coefficient of the indicator variable $I_1$ is highly significant. This means that the mean burn time of fabric 1 is significantly different from the mean burn time of fabric 4. Note that this is not the case when fabrics 2 and 3 are compared with fabric 4.</span>
<span id="cb52-645"><a href="#cb52-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-646"><a href="#cb52-646" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>In the above output, a multiple comparison of means is made keeping fabric 4 as the base. A comparison of the mean burn time of fabrics 2 &amp; 3 is not possible with the above regression. We need to omit either $I_2$ or $I_3$ and fit a regression of burn time on the predictors $I_1$, $I_3$, and $I_4$ or $I_1$, $I_2$, and $I_4$ for such a comparison.</span>
<span id="cb52-647"><a href="#cb52-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-648"><a href="#cb52-648" aria-hidden="true" tabindex="-1"></a>The ANOVA of the regression model is the same as the one-way ANOVA fit (compare F, mean squares etc.)</span>
<span id="cb52-649"><a href="#cb52-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-650"><a href="#cb52-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,echo=TRUE}</span></span>
<span id="cb52-651"><a href="#cb52-651" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mdl)</span>
<span id="cb52-652"><a href="#cb52-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-653"><a href="#cb52-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-654"><a href="#cb52-654" aria-hidden="true" tabindex="-1"></a><span class="fu">## Another example</span></span>
<span id="cb52-655"><a href="#cb52-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-656"><a href="#cb52-656" aria-hidden="true" tabindex="-1"></a>Consider the pine tree data discussed earlier. Let us model the Top circumference (numerical response) using Area variable (which is categorical). A plot of the raw data and mean circumference along with the associated 95% confidence intervals are shown in @fig-errplot.</span>
<span id="cb52-657"><a href="#cb52-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-660"><a href="#cb52-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-661"><a href="#cb52-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb52-662"><a href="#cb52-662" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb52-663"><a href="#cb52-663" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/pinetree.RData"</span>,</span>
<span id="cb52-664"><a href="#cb52-664" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"pinetree.RData"</span>)</span>
<span id="cb52-665"><a href="#cb52-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-666"><a href="#cb52-666" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"pinetree.RData"</span>)</span>
<span id="cb52-667"><a href="#cb52-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-668"><a href="#cb52-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-671"><a href="#cb52-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-672"><a href="#cb52-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-673"><a href="#cb52-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-errplot</span></span>
<span id="cb52-674"><a href="#cb52-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Interval Plot'</span></span>
<span id="cb52-675"><a href="#cb52-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-676"><a href="#cb52-676" aria-hidden="true" tabindex="-1"></a>pinetree <span class="sc">|&gt;</span> </span>
<span id="cb52-677"><a href="#cb52-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-678"><a href="#cb52-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Area, <span class="at">y =</span> Top, <span class="at">color =</span> Area) <span class="sc">+</span> </span>
<span id="cb52-679"><a href="#cb52-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb52-680"><a href="#cb52-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, </span>
<span id="cb52-681"><a href="#cb52-681" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>, </span>
<span id="cb52-682"><a href="#cb52-682" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb52-683"><a href="#cb52-683" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.3</span>)</span>
<span id="cb52-684"><a href="#cb52-684" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">+</span> </span>
<span id="cb52-685"><a href="#cb52-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_normal"</span>, </span>
<span id="cb52-686"><a href="#cb52-686" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"errorbar"</span>, </span>
<span id="cb52-687"><a href="#cb52-687" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">width =</span> <span class="fl">0.075</span>, </span>
<span id="cb52-688"><a href="#cb52-688" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.3</span>)</span>
<span id="cb52-689"><a href="#cb52-689" aria-hidden="true" tabindex="-1"></a>               ) </span>
<span id="cb52-690"><a href="#cb52-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-691"><a href="#cb52-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-692"><a href="#cb52-692" aria-hidden="true" tabindex="-1"></a>For the three different areas of the forest, we define the following three indicator variables,</span>
<span id="cb52-693"><a href="#cb52-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-694"><a href="#cb52-694" aria-hidden="true" tabindex="-1"></a>$$\begin{array}{cccc}</span>
<span id="cb52-695"><a href="#cb52-695" aria-hidden="true" tabindex="-1"></a>I_1 &amp; = &amp; 1 &amp; \text{for Area 1}<span class="sc">\\</span></span>
<span id="cb52-696"><a href="#cb52-696" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Areas 2, and 3}</span>
<span id="cb52-697"><a href="#cb52-697" aria-hidden="true" tabindex="-1"></a>\end{array}$$ $$\begin{array}{cccc}</span>
<span id="cb52-698"><a href="#cb52-698" aria-hidden="true" tabindex="-1"></a>I_2 &amp; = &amp; 1 &amp; \text{for Area 2}<span class="sc">\\</span></span>
<span id="cb52-699"><a href="#cb52-699" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Areas 1, and 3}</span>
<span id="cb52-700"><a href="#cb52-700" aria-hidden="true" tabindex="-1"></a>\end{array}$$ $$\begin{array}{cccc}</span>
<span id="cb52-701"><a href="#cb52-701" aria-hidden="true" tabindex="-1"></a>I_3 &amp; = &amp; 1 &amp; \text{for Area 3}<span class="sc">\\</span></span>
<span id="cb52-702"><a href="#cb52-702" aria-hidden="true" tabindex="-1"></a> &amp; &amp; 0&amp; \text{for Areas 1, and 2}</span>
<span id="cb52-703"><a href="#cb52-703" aria-hidden="true" tabindex="-1"></a>\end{array}$$</span>
<span id="cb52-704"><a href="#cb52-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-705"><a href="#cb52-705" aria-hidden="true" tabindex="-1"></a>Note that we need only any three of the above indicator variables to identify the Area category. For example, with $I_1$ and $I_2$ variables, Area 3 is identified when $I_1 = I_2 = 0$.</span>
<span id="cb52-706"><a href="#cb52-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-707"><a href="#cb52-707" aria-hidden="true" tabindex="-1"></a>Let us regress the pine tree Top circumference on the indicator variables $I_2$ and $I_3$ using the following <span class="in">`R`</span> codes.</span>
<span id="cb52-708"><a href="#cb52-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-709"><a href="#cb52-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, results='hide'}</span></span>
<span id="cb52-710"><a href="#cb52-710" aria-hidden="true" tabindex="-1"></a>pinetree1 <span class="ot">&lt;-</span> pinetree <span class="sc">|&gt;</span> </span>
<span id="cb52-711"><a href="#cb52-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Area, Top) <span class="sc">|&gt;</span> </span>
<span id="cb52-712"><a href="#cb52-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb52-713"><a href="#cb52-713" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"2"</span>), </span>
<span id="cb52-714"><a href="#cb52-714" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"3"</span>) )</span>
<span id="cb52-715"><a href="#cb52-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-716"><a href="#cb52-716" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> pinetree1)</span>
<span id="cb52-717"><a href="#cb52-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-718"><a href="#cb52-718" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb52-719"><a href="#cb52-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-720"><a href="#cb52-720" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl)</span>
<span id="cb52-721"><a href="#cb52-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-722"><a href="#cb52-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-723"><a href="#cb52-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-724"><a href="#cb52-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-727"><a href="#cb52-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-728"><a href="#cb52-728" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb52-729"><a href="#cb52-729" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb52-730"><a href="#cb52-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-731"><a href="#cb52-731" aria-hidden="true" tabindex="-1"></a>pinetree1 <span class="ot">&lt;-</span> pinetree <span class="sc">|&gt;</span> </span>
<span id="cb52-732"><a href="#cb52-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Top, Area) <span class="sc">|&gt;</span> </span>
<span id="cb52-733"><a href="#cb52-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I1 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb52-734"><a href="#cb52-734" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"2"</span>), </span>
<span id="cb52-735"><a href="#cb52-735" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Area <span class="sc">==</span> <span class="st">"3"</span>) )</span>
<span id="cb52-736"><a href="#cb52-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-737"><a href="#cb52-737" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> I2 <span class="sc">+</span> I3, <span class="at">data =</span> pinetree1)</span>
<span id="cb52-738"><a href="#cb52-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-739"><a href="#cb52-739" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl)</span>
<span id="cb52-740"><a href="#cb52-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-741"><a href="#cb52-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-742"><a href="#cb52-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-745"><a href="#cb52-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-746"><a href="#cb52-746" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-747"><a href="#cb52-747" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-indicat</span></span>
<span id="cb52-748"><a href="#cb52-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'Regression of Top Circumference on Area Indicator Variables'</span></span>
<span id="cb52-749"><a href="#cb52-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-750"><a href="#cb52-750" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl) <span class="sc">|&gt;</span> </span>
<span id="cb52-751"><a href="#cb52-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span>
<span id="cb52-752"><a href="#cb52-752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-753"><a href="#cb52-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-754"><a href="#cb52-754" aria-hidden="true" tabindex="-1"></a>The following points are to be noted on the regression model shown in @tbl-indicat:</span>
<span id="cb52-755"><a href="#cb52-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-756"><a href="#cb52-756" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The $y$-intercept 20.025 is the mean Top circumference for Area 1 (i.e. the mean response for the omitted predictor category).</span>
<span id="cb52-757"><a href="#cb52-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-758"><a href="#cb52-758" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The mean Top circumference 2 and 3 can be found from the fitted model. For Area 2, $I_1$ =0, $I_2$=1, and $I_3$ =0. Substituting these values in the fitted model, we get $20.025 -1.955 \times 1 -5.925 \times 0 = 20.025-1.955 = 18.07$, which is mean Top circumference for Area 1. For Area 3, the mean Top circumference for Area 3 is $20.025 -1.955 \times 0 -5.925 \times 1 = 20.025= 14.1$. In other words, the fitted coefficient of an indicator variable is the difference between the response means of the category indicated by the variable and the 'base' category (indicated by the omitted indicator variable).</span>
<span id="cb52-759"><a href="#cb52-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-760"><a href="#cb52-760" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The significance of the slope coefficients implies a significant difference in means. For example, the coefficient of the indicator variable $I_2$ is highly significant. This means that the mean Top circumference for Area 2 is significantly different from the mean Top circumference for Area 1. The negative sign of the coefficient means that Area 2 mean is significantly lower when compared Area 1 mean. The same is true when Area 3 is compared with Area 1.</span>
<span id="cb52-761"><a href="#cb52-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-762"><a href="#cb52-762" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>In the above output, a multiple comparison of means is made keeping Area 1 as the base. A comparison of the mean Top circumference for Areas 2 &amp; 3 is not possible with the above regression. We need to omit either $I_2$ or $I_3$ and fit a regression for such a comparison.</span>
<span id="cb52-763"><a href="#cb52-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-764"><a href="#cb52-764" aria-hidden="true" tabindex="-1"></a>In practice, you will NOT be creating any indicator variables to perform the analysis and <span class="in">`R`</span> does it for us when we use the <span class="in">`lm()`</span> function but we have to make sure that categorical factors are stored as factors, not numerical variables. </span>
<span id="cb52-765"><a href="#cb52-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-766"><a href="#cb52-766" aria-hidden="true" tabindex="-1"></a>The ANOVA of the regression model shown in @tbl-indanova has a highly significant F value which means that at least one Area is different in terms of mean Top circumference.</span>
<span id="cb52-767"><a href="#cb52-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-768"><a href="#cb52-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, results='hide'}</span></span>
<span id="cb52-769"><a href="#cb52-769" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Top <span class="sc">~</span> Area, <span class="at">data=</span>pinetree) <span class="sc">|&gt;</span> <span class="fu">anova</span>()</span>
<span id="cb52-770"><a href="#cb52-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-771"><a href="#cb52-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-774"><a href="#cb52-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-775"><a href="#cb52-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-776"><a href="#cb52-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-indanova</span></span>
<span id="cb52-777"><a href="#cb52-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'Regression ANOVA'</span></span>
<span id="cb52-778"><a href="#cb52-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-779"><a href="#cb52-779" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Top <span class="sc">~</span> Area, <span class="at">data=</span>pinetree) <span class="sc">|&gt;</span> </span>
<span id="cb52-780"><a href="#cb52-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anova</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-781"><a href="#cb52-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span>
<span id="cb52-782"><a href="#cb52-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-783"><a href="#cb52-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-784"><a href="#cb52-784" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analysis of Covariance (ANCOVA)</span></span>
<span id="cb52-785"><a href="#cb52-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-786"><a href="#cb52-786" aria-hidden="true" tabindex="-1"></a>Indicator variables are particular useful when both a dependent variable and an independent variable are measured. One would like to use regression to show the relationship between the dependent or response variable and the explanatory variable (covariate) separately for each factor level. However, both the slope and the intercept may differ for the various factor levels. What sort of model does one fit to such data? Consider the Restaurant Sales Data presented in the first four columns of @tbl-Restaurant. This dataset is from @Neter.</span>
<span id="cb52-787"><a href="#cb52-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-788"><a href="#cb52-788" aria-hidden="true" tabindex="-1"></a>A study for a chain of fast-food restaurants examined the relationship between restaurant sales ($Y$, in thousands of dollars) and the number of households in the restaurant's trading area ($X$, in thousands) and location of restaurant (Highway, shopping Mall, Street).</span>
<span id="cb52-789"><a href="#cb52-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-790"><a href="#cb52-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-793"><a href="#cb52-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-794"><a href="#cb52-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb52-795"><a href="#cb52-795" aria-hidden="true" tabindex="-1"></a>restaurant <span class="ot">&lt;-</span> </span>
<span id="cb52-796"><a href="#cb52-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_table</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/restaurant.txt"</span>,</span>
<span id="cb52-797"><a href="#cb52-797" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_types =</span> <span class="st">"fddf"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-798"><a href="#cb52-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Restaurant =</span> <span class="fu">factor</span>(Restaurant),</span>
<span id="cb52-799"><a href="#cb52-799" aria-hidden="true" tabindex="-1"></a>         <span class="at">I1 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Mall"</span>),</span>
<span id="cb52-800"><a href="#cb52-800" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Street"</span>),</span>
<span id="cb52-801"><a href="#cb52-801" aria-hidden="true" tabindex="-1"></a>         <span class="at">I3 =</span> <span class="fu">as.numeric</span>(Location<span class="sc">==</span><span class="st">"Highway"</span>),</span>
<span id="cb52-802"><a href="#cb52-802" aria-hidden="true" tabindex="-1"></a>         <span class="at">I1.X =</span> I1 <span class="sc">*</span> Households,</span>
<span id="cb52-803"><a href="#cb52-803" aria-hidden="true" tabindex="-1"></a>         <span class="at">I2.X =</span> I2 <span class="sc">*</span> Households)</span>
<span id="cb52-804"><a href="#cb52-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-805"><a href="#cb52-805" aria-hidden="true" tabindex="-1"></a>restaurant</span>
<span id="cb52-806"><a href="#cb52-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-807"><a href="#cb52-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-810"><a href="#cb52-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-811"><a href="#cb52-811" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-812"><a href="#cb52-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-Restaurant</span></span>
<span id="cb52-813"><a href="#cb52-813" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'Restaurant Sales Data'</span></span>
<span id="cb52-814"><a href="#cb52-814" aria-hidden="true" tabindex="-1"></a>restaurant <span class="sc">|&gt;</span> </span>
<span id="cb52-815"><a href="#cb52-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() </span>
<span id="cb52-816"><a href="#cb52-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-817"><a href="#cb52-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-818"><a href="#cb52-818" aria-hidden="true" tabindex="-1"></a>@tbl-Restaurant also shows the indicator variables for the Location factor. Just two indicator variables (say $I_1$ and $I_2$) are needed in order to define the three different locations uniquely. In order to permit a separate line for each location we need a model of the following form</span>
<span id="cb52-819"><a href="#cb52-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-820"><a href="#cb52-820" aria-hidden="true" tabindex="-1"></a>$$Y = \beta_0 + \beta_1 I_1 + \beta_2 I_2 + (\beta_3 + \beta_4 I_1 + \beta_5 I_2)X$$</span>
<span id="cb52-821"><a href="#cb52-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-822"><a href="#cb52-822" aria-hidden="true" tabindex="-1"></a>This model provides a separate model for each location as well as allows for the interaction between the location of the restaurant and the number of households through the slope coefficients.</span>
<span id="cb52-823"><a href="#cb52-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-824"><a href="#cb52-824" aria-hidden="true" tabindex="-1"></a>For Highway locations, $I_1$ and $I_2$ are both equal to zero. Hence the model simplifies to $Y = \beta_0 + (\beta_3)X$. For Mall locations, $I_1$ is equal to one and $I_2$ is equal to zero. So the model becomes $Y = (\beta_0 + \beta_1 ) + (\beta_3 + \beta_4)X$. For Street locations, $I_1$ is equal to zero and $I_2$ is equal to one. So the model becomes $Y = (\beta_0 + \beta_2 ) + (\beta_3 + \beta_5)X$.</span>
<span id="cb52-825"><a href="#cb52-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-826"><a href="#cb52-826" aria-hidden="true" tabindex="-1"></a>The newly created product variables $I_1.X=I_1\times X$ and $I_2.X=I_2\times X$ shown in @tbl-Restaurant allow us to fit separate slopes for the Locations. <span class="in">`R`</span> does not require creation of data for the interaction terms $I_1$$\times X$ and $I_2$$\times X$ and it does internally. The regression of Sales $(Y)$ on Households $(X)$, $I_1$, $I_2$, $I_1\times X$ and $I_2\times X$ is shown in @tbl-anovatab.</span>
<span id="cb52-827"><a href="#cb52-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-830"><a href="#cb52-830" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-831"><a href="#cb52-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb52-832"><a href="#cb52-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-833"><a href="#cb52-833" aria-hidden="true" tabindex="-1"></a>ancova.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> Households <span class="sc">+</span> I1 <span class="sc">+</span> I2 <span class="sc">+</span> I1.X <span class="sc">+</span> I2.X,</span>
<span id="cb52-834"><a href="#cb52-834" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>restaurant)</span>
<span id="cb52-835"><a href="#cb52-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-836"><a href="#cb52-836" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(ancova.model)</span>
<span id="cb52-837"><a href="#cb52-837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-838"><a href="#cb52-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-841"><a href="#cb52-841" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-842"><a href="#cb52-842" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-843"><a href="#cb52-843" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-anovatab</span></span>
<span id="cb52-844"><a href="#cb52-844" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'Analysis of Covariance (ANCOVA)'</span></span>
<span id="cb52-845"><a href="#cb52-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-846"><a href="#cb52-846" aria-hidden="true" tabindex="-1"></a>ancova.model <span class="sc">|&gt;</span> </span>
<span id="cb52-847"><a href="#cb52-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-848"><a href="#cb52-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>) </span>
<span id="cb52-849"><a href="#cb52-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-850"><a href="#cb52-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-851"><a href="#cb52-851" aria-hidden="true" tabindex="-1"></a>This <span class="in">`R`</span> output suggests that the coefficients for $I_2$, $I_1\times X$ and $I_2\times X$ are not significantly different from zero. This suggests that a simpler model can be fitted to these data omitting the category indicated by $I_2$. The significance of the $I_1$ coefficient means that the $y$-intercept of the model for Mall location is different. The significance of the coefficients of the product variables will imply significant differences in slopes for the locations but this is not the case here. In general, a stepwise regression is needed to obtain a simpler model having the best subset of predictors (rather than judging from the multiple regression model given here).</span>
<span id="cb52-852"><a href="#cb52-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-853"><a href="#cb52-853" aria-hidden="true" tabindex="-1"></a>The final or simpler model suggested after step-wise analysis (results not shown) is:</span>
<span id="cb52-854"><a href="#cb52-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-855"><a href="#cb52-855" aria-hidden="true" tabindex="-1"></a>$Y = -3.298 + 0.906 X + 23.8\times I_1$.</span>
<span id="cb52-856"><a href="#cb52-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-857"><a href="#cb52-857" aria-hidden="true" tabindex="-1"></a>Because $I_2$ does not appear in this equation, it means that the same regression line can be used to relate sales to number of households for the Highway and Street Locations. The fact that $I_1$ is included in the final model but $I_1$$\times X$ is excluded means that the line for Malls has a different intercept but the same slope as the Highway/Street Line.</span>
<span id="cb52-858"><a href="#cb52-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-859"><a href="#cb52-859" aria-hidden="true" tabindex="-1"></a>$I_1$=0 for both Highway and Street locations so the fitted values for Highway/Street locations is,</span>
<span id="cb52-860"><a href="#cb52-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-861"><a href="#cb52-861" aria-hidden="true" tabindex="-1"></a>$Y = -3.298 + 0.906 X$.</span>
<span id="cb52-862"><a href="#cb52-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-863"><a href="#cb52-863" aria-hidden="true" tabindex="-1"></a>$I_1$=1 for Mall locations so the fitted model for Mall locations is,</span>
<span id="cb52-864"><a href="#cb52-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-865"><a href="#cb52-865" aria-hidden="true" tabindex="-1"></a>$Y = (-3.298 + 23.81) + (0.906-0.074)X = 20.512 + 0.832X$.</span>
<span id="cb52-866"><a href="#cb52-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-867"><a href="#cb52-867" aria-hidden="true" tabindex="-1"></a>These two lines are plotted in @fig-ancovaplot. The top line is (obviously) the fitted model for Mall locations and the bottom one for Highway and Street locations.</span>
<span id="cb52-868"><a href="#cb52-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-871"><a href="#cb52-871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-872"><a href="#cb52-872" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ancovaplot</span></span>
<span id="cb52-873"><a href="#cb52-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Plot of Fitted Lines'</span></span>
<span id="cb52-874"><a href="#cb52-874" aria-hidden="true" tabindex="-1"></a>restaurant <span class="sc">|&gt;</span> </span>
<span id="cb52-875"><a href="#cb52-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Mall location</span><span class="st">`</span> <span class="ot">=</span> Location <span class="sc">==</span> <span class="st">"Mall"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-876"><a href="#cb52-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-877"><a href="#cb52-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Sales, <span class="at">x =</span> Households, <span class="at">linetype =</span> <span class="st">`</span><span class="at">Mall location</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb52-878"><a href="#cb52-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Location)) <span class="sc">+</span> </span>
<span id="cb52-879"><a href="#cb52-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span>
<span id="cb52-880"><a href="#cb52-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-881"><a href="#cb52-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-882"><a href="#cb52-882" aria-hidden="true" tabindex="-1"></a>In practice, you will NOT be creating any indicator variables to perform the analysis of covariance and <span class="in">`R`</span> does it for us when we use the <span class="in">`lm()`</span> with the syntax <span class="in">`*`</span> which stands for interaction. Try-</span>
<span id="cb52-883"><a href="#cb52-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-884"><a href="#cb52-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, results='hide'}</span></span>
<span id="cb52-885"><a href="#cb52-885" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(Top <span class="sc">~</span> First <span class="sc">*</span> Area, <span class="at">data =</span> pinetree)</span>
<span id="cb52-886"><a href="#cb52-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-887"><a href="#cb52-887" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mdl) <span class="co"># also summary(mdl)  or anova(mdl)</span></span>
<span id="cb52-888"><a href="#cb52-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-889"><a href="#cb52-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-890"><a href="#cb52-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-891"><a href="#cb52-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-892"><a href="#cb52-892" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary</span></span>
<span id="cb52-893"><a href="#cb52-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-894"><a href="#cb52-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-895"><a href="#cb52-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-896"><a href="#cb52-896" aria-hidden="true" tabindex="-1"></a>Various ANOVA models have been considered in this chapter. The goodness of fit is indicated by the $R$-Squared value or $F$ statistic. Most of the ANOVA examples given in this chapter are based on experimental data but ANOVA models can also be fitted to survey data, provided that the observations represent a random sample. When the observations are time series or other data forms chosen in a non-random fashion, the assumptions of these models may not be satisfied. In particular it is unlikely that the residuals will be independent, following no clear pattern. It is important that such assumptions be checked; otherwise the results of these analyses may be misleading. It is also important that the residual variances are reasonably similar for all treatment levels. If this is not the case, some transformation of the response variable may be required in order to ensure that the ANOVA $F$ tests are valid.</span>
<span id="cb52-897"><a href="#cb52-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-898"><a href="#cb52-898" aria-hidden="true" tabindex="-1"></a>Indicator variables can be used to perform ANOVA using regression. However, it is more common to use indicator variables when one wants to use both a categorical factor and a continuous measurement variable $X$ to model the $Y$ responses. Such an analysis is called an ANCOVA and the model fitted using regression may consist of a separate model for each treatment.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>